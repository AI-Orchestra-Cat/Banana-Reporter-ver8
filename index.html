<!DOCTYPE html> <html lang="ja"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> <meta name="theme-color" content="#667eea"> <meta name="apple-mobile-web-app-capable" content="yes"> <title>ãƒãƒŠãƒŠãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ v8.2 - å®Œå…¨çµ±åˆç‰ˆ</title> <style> * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; } :root { --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%); --success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); --danger: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%); --dark: #333333; --light: #f8f9fa; --border-radius: 10px; --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); } body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--primary); min-height: 100vh; overflow-x: hidden; } .container { max-width: 600px; margin: 0 auto; padding: 10px; overflow-x: hidden; } .auth-screen { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: var(--primary); } .auth-card { background: white; border-radius: 15px; padding: 30px; width: 90%; max-width: 400px; box-shadow: var(--box-shadow); } .auth-title { text-align: center; color: var(--dark); margin-bottom: 30px; font-size: 24px; } .header { text-align: center; padding: 20px 0; color: white; } .header h1 { font-size: 24px; font-weight: 700; margin-bottom: 5px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); } .subtitle { font-size: 14px; opacity: 0.9; } .form-group { margin-bottom: 20px; } .form-label { display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500; font-size: 14px; } .required { color: #dc3545; } .form-control { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; transition: all 0.3s; } .form-control:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); } .form-select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; background: white; cursor: pointer; transition: all 0.3s; } .form-select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); } .btn { display: inline-flex; align-items: center; justify-content: center; padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-decoration: none; } .btn-primary { background: var(--primary); color: white; } .btn-success { background: var(--success); color: white; } .btn-danger { background: var(--danger); color: white; } .btn-secondary { background: #6c757d; color: white; } .btn-info { background: #17a2b8; color: white; } .btn-block { width: 100%; margin-bottom: 10px; } .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); } .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; } .btn-group { display: flex; gap: 10px; margin-bottom: 20px; } .btn-group .btn { flex: 1; } .card { background: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding: 20px; margin-bottom: 20px; } .card h3 { color: var(--dark); margin-bottom: 15px; font-size: 18px; } .image-preview { min-height: 200px; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; margin-top: 20px; } .image-placeholder { color: #999; font-size: 14px; text-align: center; } .color-chart { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px; } .color-item { width: 80px; height: 80px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.2); position: relative; color: white; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); border: 3px solid transparent; } .color-item:hover { transform: scale(1.1); box-shadow: 0 4px 10px rgba(0,0,0,0.3); } .color-item.selected { border: 3px solid #007bff; box-shadow: 0 0 10px rgba(0, 123, 255, 0.5); transform: scale(1.1); } .color-number { font-size: 18px; font-weight: bold; } .color-name { font-size: 10px; margin-top: 2px; } .result-summary { background: #f8f9fa; padding: 15px; border-radius: 8px; } .result-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 5px 0; } .result-item .label { font-weight: bold; color: #666; } .result-item .value { font-weight: bold; color: #333; } .result-match { text-align: center; padding: 10px; border-radius: 5px; font-size: 18px; font-weight: bold; margin-top: 10px; } .result-match.match { background: #d4edda; color: #155724; } .result-match.mismatch { background: #f8d7da; color: #721c24; } .error-message { background: rgba(220, 53, 69, 0.1); color: #dc3545; padding: 10px; border-radius: 5px; margin-top: 10px; border: 1px solid rgba(220, 53, 69, 0.3); text-align: center; } .success-message { background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin-top: 10px; border: 1px solid #c3e6cb; text-align: center; } .hidden { display: none !important; } .banana-region-preview { margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; text-align: center; } .banana-region-preview canvas { max-width: 100%; border-radius: 4px; } .analysis-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 15px; } .stat-item { background: white; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #667eea; } .stat-value { font-size: 18px; font-weight: bold; color: #333; } .stat-label { font-size: 12px; color: #666; margin-top: 4px; } @media (max-width: 600px) { .container { padding: 5px; } .color-item { width: 60px; height: 60px; } .color-number { font-size: 14px; } .color-name { font-size: 8px; } } .settings-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 15px; } .master-section { margin-bottom: 30px; padding: 20px; background: white; border-radius: 8px; border-left: 4px solid #007bff; } .master-input-group { display: flex; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; } .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; } .tag { display: inline-block; padding: 6px 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 20px; font-size: 12px; cursor: pointer; position: relative; } .tag.product { background: linear-gradient(135deg, #e91e63, #f06292); } .tag.claim { background: linear-gradient(135deg, #03a9f4, #0288d1); } .tag .remove-btn { margin-left: 8px; background: rgba(255,255,255,0.3); border: none; border-radius: 50%; width: 20px; height: 20px; color: white; cursor: pointer; font-size: 12px; line-height: 1; } .tag .remove-btn:hover { background: rgba(255,255,255,0.5); } .color-settings-card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 15px; border-left: 4px solid; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; } .color-settings-card.green { border-left-color: #4CAF50; } .color-settings-card.yellow-green { border-left-color: #8BC34A; } .color-settings-card.yellow { border-left-color: #FFEB3B; } .color-settings-card.orange { border-left-color: #FF9800; } .color-settings-card.brown { border-left-color: #795548; } .color-info { flex: 1; } .color-info h6 { color: #333; font-size: 18px; margin-bottom: 5px; } .color-info .hsv-info { color: #666; font-size: 14px; } .judgment-rule-card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 15px; border-left: 4px solid; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; } .judgment-rule-card.color-2 { border-left-color: #2E7D32; } .judgment-rule-card.color-3 { border-left-color: #4CAF50; } .judgment-rule-card.color-4 { border-left-color: #8BC34A; } .judgment-rule-card.color-5 { border-left-color: #CDDC39; } .judgment-rule-card.color-6 { border-left-color: #FFEB3B; } .judgment-rule-card.color-7 { border-left-color: #FFC107; } .judgment-rule-card.color-8 { border-left-color: #FF9800; } .judgment-rule-card.color-9 { border-left-color: #795548; } .rule-info { flex: 1; } .rule-info h6 { color: #333; font-size: 18px; margin-bottom: 5px; } .rule-info .priority { color: #666; font-size: 12px; margin-bottom: 8px; } .rule-info .condition { color: #333; font-weight: bold; } .management-buttons { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; } @media (max-width: 768px) { .master-input-group { flex-direction: column; align-items: stretch; } .master-input-group input, .master-input-group select, .master-input-group button { width: 100% !important; margin-right: 0 !important; margin-bottom: 5px; } .management-buttons { flex-direction: column; } .management-buttons button { margin-right: 0 !important; } } </style> </head> <body> <!-- èªè¨¼ç”»é¢ --> <div class="auth-screen" id="authScreen"> <div class="auth-card"> <h2 class="auth-title">ğŸŒ ãƒãƒŠãƒŠãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ v8.2</h2> <div class="form-group"> <label class="form-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label> <input type="text" class="form-control" id="userId" value="admin" autocomplete="username"> </div> <div class="form-group"> <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label> <input type="password" class="form-control" id="password" value="" autocomplete="current-password"> </div> <button class="btn btn-primary btn-block" id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button> <div id="loginError" class="error-message hidden"></div> </div> </div> <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ --> <div class="container hidden" id="mainScreen"> <div class="header"> <h1>ğŸŒ ãƒãƒŠãƒŠãƒ¬ãƒãƒ¼ã‚¿ãƒ¼</h1> <div class="subtitle">å“è³ªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v8.2 - <span id="currentUserDisplay"></span></div> </div> <!-- ç”»åƒå…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ --> <div class="card"> <h3>ğŸ“¸ ç”»åƒå…¥åŠ›</h3> <div class="btn-group"> <button class="btn btn-primary" id="cameraBtn">ğŸ“· ã‚«ãƒ¡ãƒ©æ’®å½±</button> <button class="btn btn-secondary" id="fileBtn">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ</button> </div> <input type="file" class="form-control hidden" id="cameraInput" accept="image/*" capture="environment"> <input type="file" class="form-control hidden" id="fileInput" accept="image/*"> <div class="image-preview" id="imagePreview"> <div class="image-placeholder">ç”»åƒãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</div> </div> <!-- ãƒãƒŠãƒŠé ˜åŸŸæ¤œå‡ºçµæœ --> <div class="banana-region-preview hidden" id="bananaRegionPreview"> <h4>ğŸ¯ ãƒãƒŠãƒŠé ˜åŸŸæ¤œå‡ºçµæœ</h4> <canvas id="regionCanvas"></canvas> <div id="regionStats" class="analysis-stats"></div> </div> </div> <!-- ç›®è¦–é¸æŠã‚«ãƒ©ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ --> <div class="card"> <h3>ğŸ‘ï¸ ç›®è¦–é¸æŠ</h3> <div style="margin-bottom: 15px;"> <span><strong>é¸æŠã•ã‚ŒãŸã‚«ãƒ©ãƒ¼:</strong> <span id="selectedColorText">æœªé¸æŠ</span></span> </div> <div class="color-chart" id="colorChart"></div> <!-- è§£æå®Ÿè¡Œãƒœã‚¿ãƒ³ --> <div style="margin-top: 20px; text-align: center;"> <button class="btn btn-success" id="analyzeBtn" style="padding: 15px 30px; font-size: 18px; font-weight: bold;" disabled>ğŸ” è§£æå®Ÿè¡Œ</button> </div> </div> <!-- è§£æçµæœ --> <div class="card hidden" id="resultCard"> <h3>ğŸ“Š è§£æçµæœ</h3> <div id="resultContent"></div> </div> <!-- å•†å“æƒ…å ±å…¥åŠ› --> <div class="card"> <h3>ğŸ“ å•†å“æƒ…å ±</h3> <div class="form-group"> <label class="form-label">ãƒã‚§ãƒ¼ãƒ³å <span class="required">*</span></label> <select class="form-select" id="chainName"> <option value="">é¸æŠã—ã¦ãã ã•ã„</option> </select> </div> <div class="form-group"> <label class="form-label">åº—èˆ—å <span class="required">*</span></label> <select class="form-select" id="storeName"> <option value="">ãƒã‚§ãƒ¼ãƒ³ã‚’å…ˆã«é¸æŠã—ã¦ãã ã•ã„</option> </select> </div> <div class="form-group"> <label class="form-label">å•†å“å <span class="required">*</span></label> <select class="form-select" id="productName"> <option value="">é¸æŠã—ã¦ãã ã•ã„</option> <option value="ãƒ•ã‚£ãƒªãƒ”ãƒ³ç”£ãƒãƒŠãƒŠ">ãƒ•ã‚£ãƒªãƒ”ãƒ³ç”£ãƒãƒŠãƒŠ</option> <option value="ã‚¨ã‚¯ã‚¢ãƒ‰ãƒ«ç”£ãƒãƒŠãƒŠ">ã‚¨ã‚¯ã‚¢ãƒ‰ãƒ«ç”£ãƒãƒŠãƒŠ</option> </select> </div> <div class="form-group"> <label class="form-label">ã‚¯ãƒ¬ãƒ¼ãƒ ç¨®åˆ¥ <span class="required">*</span></label> <select class="form-select" id="claimType"> <option value="">é¸æŠã—ã¦ãã ã•ã„</option> </select> </div> <div class="form-group"> <label class="form-label">ç´å“æ—¥ <span class="required">*</span></label> <input type="date" class="form-control" id="deliveryDate"> </div> <div class="form-group"> <label class="form-label">æ’®å½±æ—¥ <span class="required">*</span></label> <input type="date" class="form-control" id="captureDate"> </div> <div class="form-group"> <label class="form-label">ã‚³ãƒ¡ãƒ³ãƒˆ</label> <textarea class="form-control" id="commentText" rows="3" placeholder="è¿½åŠ ã®æƒ…å ±ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea> </div> <!-- ã‚³ãƒ¼ãƒ‰1ã€œ3 --> <div class="form-group"> <label class="form-label"><span id="code1Label">ã‚³ãƒ¼ãƒ‰1</span></label> <input type="text" class="form-control" id="code1" placeholder="ã‚³ãƒ¼ãƒ‰1ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"> </div> <div class="form-group"> <label class="form-label"><span id="code2Label">ã‚³ãƒ¼ãƒ‰2</span></label> <input type="text" class="form-control" id="code2" placeholder="ã‚³ãƒ¼ãƒ‰2ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"> </div> <div class="form-group"> <label class="form-label"><span id="code3Label">ã‚³ãƒ¼ãƒ‰3</span></label> <input type="text" class="form-control" id="code3" placeholder="ã‚³ãƒ¼ãƒ‰3ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"> </div> </div> <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ --> <div class="card"> <button class="btn btn-success btn-block" id="exportBtn" disabled>ğŸ“Š CSVå‡ºåŠ›</button> <button class="btn btn-info btn-block" id="emailBtn" disabled>ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡</button> <button class="btn btn-danger" id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button> <button class="btn btn-secondary admin-only hidden" id="settingsBtn">âš™ï¸ è¨­å®š</button> <button class="btn btn-primary" id="logoutBtn">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button> </div> <!-- è¨­å®šç”»é¢ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰ --> <div class="card hidden" id="colorAnalysisSettings"> <h3>âš™ï¸ ãƒãƒŠãƒŠå“è³ªåˆ¤å®šã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h3> <p style="color: #666; margin-bottom: 25px;"> ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€HSVè‰²ç¯„å›²è¨­å®šã€ã‚«ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«åˆ¤å®šãƒ«ãƒ¼ãƒ«è¨­å®šã‚’è¡Œã„ã¾ã™ </p> <!-- ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç† --> <div style="margin-bottom: 30px;"> <h4 style="color: #1976d2; margin-bottom: 15px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px;" onclick="toggleMasterDataSection()"> ğŸ“Š ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç† <span id="masterDataToggle">â–¼</span> </h4> <div id="masterDataSection" class="settings-section"> <!-- ãƒã‚§ãƒ¼ãƒ³åãƒã‚¹ã‚¿ --> <div class="master-section"> <h5>ãƒã‚§ãƒ¼ãƒ³åãƒã‚¹ã‚¿</h5> <div class="master-input-group"> <input type="text" id="newChainName" placeholder="æ–°ã—ã„ãƒã‚§ãƒ¼ãƒ³åã‚’å…¥åŠ›" class="form-control" style="display: inline-block; width: 70%; margin-right: 10px;"> <button class="btn btn-primary" onclick="addChainName()" style="display: inline-block; width: 25%;">â• è¿½åŠ </button> </div> <div id="chainTags" class="tag-container"></div> </div> <!-- åº—èˆ—åãƒã‚¹ã‚¿ --> <div class="master-section"> <h5>åº—èˆ—åãƒã‚¹ã‚¿</h5> <div class="master-input-group"> <select id="chainSelect" class="form-control" style="display: inline-block; width: 30%; margin-right: 10px;"> <option value="">ãƒã‚§ãƒ¼ãƒ³ã‚’é¸æŠ</option> </select> <input type="text" id="newStoreName" placeholder="æ–°ã—ã„åº—èˆ—åã‚’å…¥åŠ›" class="form-control" style="display: inline-block; width: 35%; margin-right: 10px;"> <button class="btn btn-primary" onclick="addStoreName()" style="display: inline-block; width: 20%;">â• è¿½åŠ </button> </div> <div id="storesByChain"></div> </div> <!-- å•†å“åãƒã‚¹ã‚¿ --> <div class="master-section"> <h5>å•†å“åãƒã‚¹ã‚¿</h5> <div class="master-input-group"> <input type="text" id="newProductName" placeholder="æ–°ã—ã„å•†å“åã‚’å…¥åŠ›" class="form-control" style="display: inline-block; width: 70%; margin-right: 10px;"> <button class="btn btn-primary" onclick="addProductName()" style="display: inline-block; width: 25%;">â• è¿½åŠ </button> </div> <div id="productTags" class="tag-container"></div> </div> <!-- ã‚¯ãƒ¬ãƒ¼ãƒ ç¨®åˆ¥ãƒã‚¹ã‚¿ --> <div class="master-section"> <h5>ã‚¯ãƒ¬ãƒ¼ãƒ ç¨®åˆ¥ãƒã‚¹ã‚¿</h5> <div class="master-input-group"> <input type="text" id="newClaimType" placeholder="æ–°ã—ã„ã‚¯ãƒ¬ãƒ¼ãƒ ç¨®åˆ¥ã‚’å…¥åŠ›" class="form-control" style="display: inline-block; width: 70%; margin-right: 10px;"> <button class="btn btn-primary" onclick="addClaimType()" style="display: inline-block; width: 25%;">â• è¿½åŠ </button> </div> <div id="claimTypeTags" class="tag-container"></div> <div style="margin-top: 15px;"> <button class="btn btn-success" onclick="saveMasterData()" style="margin-right: 10px;">ğŸ’¾ ä¿å­˜</button> <button class="btn btn-warning" onclick="resetMasterDataToDefault()">ğŸ”„ åˆæœŸå€¤ã«æˆ»ã™</button> </div> </div> </div> </div> <!-- HSVè‰²ç¯„å›²è¨­å®š --> <div style="margin-bottom: 30px;"> <h4 style="color: #4CAF50; margin-bottom: 15px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px;" onclick="toggleColorSettingsSection()"> ğŸ¨ HSVè‰²ç¯„å›²è¨­å®š <span id="colorSettingsToggle">â–¼</span> </h4> <div id="colorSettingsSection" class="settings-section"> <div class="color-management-header"> <h5>ç”»åƒè§£æç”¨HSVè‰²ç¯„å›²è¨­å®š</h5> <div class="management-buttons"> <button class="btn btn-success" onclick="saveColorSettings()" style="margin-right: 10px;">ğŸ’¾ ç¾åœ¨ã®è¨­å®šã‚’ä¿å­˜</button> <button class="btn btn-info" onclick="exportColorSettingsCSV()" style="margin-right: 10px;">ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button> <button class="btn btn-secondary" onclick="importColorSettingsCSV()" style="margin-right: 10px;">ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button> <button class="btn btn-warning" onclick="resetColorSettingsToDefault()">ğŸ”„ åˆæœŸå€¤ã«æˆ»ã™</button> </div> </div> <div style="margin-top: 20px;"> <h6>ç¾åœ¨ã®HSVè‰²ç¯„å›²è¨­å®šï¼ˆ5ç¨®é¡ï¼‰</h6> <p style="color: #666; font-size: 14px; margin-bottom: 15px;"> ç”»åƒè§£æã§ä½¿ç”¨ã™ã‚‹å„è‰²ç³»çµ±ã®HSVå€¤ç¯„å›²ã‚’è¨­å®šã—ã¾ã™ï¼ˆè‰²ç›¸: 0-360Â°ã€å½©åº¦: 0-100%ã€æ˜åº¦: 0-100%ï¼‰ </p> <div id="colorSettingsCards"></div> </div> </div> </div> <!-- ã‚«ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«åˆ¤å®šãƒ«ãƒ¼ãƒ«è¨­å®š --> <div style="margin-bottom: 30px;"> <h4 style="color: #FF9800; margin-bottom: 15px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px;" onclick="toggleJudgmentRulesSection()"> âš–ï¸ ã‚«ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«åˆ¤å®šãƒ«ãƒ¼ãƒ«è¨­å®š <span id="judgmentRulesToggle">â–¼</span> </h4> <div id="judgmentRulesSection" class="settings-section"> <div class="rule-management-header"> <h5>ã‚«ãƒ©ãƒ¼åˆ¤å®šãƒ«ãƒ¼ãƒ«ç®¡ç†</h5> <div class="management-buttons" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;"> <button class="btn btn-success" onclick="saveJudgmentRules()" style="padding: 10px 20px;">ğŸ’¾ ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ«ã‚’ä¿å­˜</button> <button class="btn btn-primary" onclick="exportJudgmentRulesCSV()" style="padding: 10px 20px;">ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button> </div> <div class="management-buttons" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;"> <button class="btn btn-secondary" onclick="importJudgmentRulesCSV()" style="padding: 10px 20px;">ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button> <button class="btn btn-warning" onclick="resetJudgmentRulesToDefault()" style="padding: 10px 20px;">ğŸ”„ åˆæœŸå€¤ã«æˆ»ã™</button> </div> </div> <div style="margin-top: 20px;" id="judgmentRulesCards"></div> </div> </div> <div style="text-align: center; margin-top: 30px;"> <button class="btn btn-secondary" onclick="hideSettings()">âŒ è¨­å®šç”»é¢ã‚’é–‰ã˜ã‚‹</button> </div> </div> </div> <script> const AppState = { currentUser: null, currentImage: null, imageData: null, bananaRegion: null, visualJudgment: null, analysisResult: null, storeData: { 'Aãƒã‚§ãƒ¼ãƒ³': ['æœ¬åº—', 'æ”¯åº—1', 'æ”¯åº—2'], 'Bã‚¹ãƒˆã‚¢': ['ä¸–ç”°è°·åº—', 'æ¸‹è°·åº—', 'æ–°å®¿åº—'], 'Cãƒãƒ¼ã‚±ãƒƒãƒˆ': ['åºœä¸­åº—', 'èª¿å¸ƒåº—', 'å›½åˆ†å¯ºåº—'] }, productData: [ 'ãƒãƒŠãƒŠï¼ˆæˆ¿ï¼‰', 'ãƒãƒŠãƒŠï¼ˆå˜å“ï¼‰' ], claimTypeData: [ 'éç†Ÿ', 'ãŠã•ã‚Œãƒ»ããš', 'è…ã‚Œ', 'æœªç†Ÿ', 'ãã¶ã', 'ã‚ãŠã¶ã', 'ãã®ä»–' ], codeNames: { code1: 'ã‚³ãƒ¼ãƒ‰1', code2: 'ã‚³ãƒ¼ãƒ‰2', code3: 'ã‚³ãƒ¼ãƒ‰3' } }; let _0xaebf = { 2: { level: 2, name: "ã‚ªãƒ¼ãƒ«ã‚°ãƒªãƒ¼ãƒ³", priority: 8, conditions: [ { colorSetting: "ç·‘ç³»", operator: ">=", threshold: 60 } ] }, 3: { level: 3, name: "ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³", priority: 7, conditions: [ { colorSetting: "ç·‘ç³»", operator: ">=", threshold: 40 } ] }, 4: { level: 4, name: "ãƒãƒ¼ãƒ•ã‚°ãƒªãƒ¼ãƒ³", priority: 6, conditions: [ { colorSetting: "é»„ç·‘ç³»", operator: ">=", threshold: 40 } ] }, 5: { level: 5, name: "ã‚°ãƒªãƒ¼ãƒ³ãƒãƒƒãƒ—", priority: 5, conditions: [ { colorSetting: "é»„ç·‘ç³»", operator: ">=", threshold: 25 } ] }, 6: { level: 6, name: "ãƒ•ãƒ«ã‚¤ã‚¨ãƒ­ãƒ¼", priority: 4, conditions: [ { colorSetting: "é»„è‰²ç³»", operator: ">=", threshold: 50 } ] }, 7: { level: 7, name: "ã‚¹ã‚¿ãƒ¼", priority: 3, conditions: [ { colorSetting: "æ–‘ç‚¹ç³»", operator: ">=", threshold: 30 } ] }, 8: { level: 8, name: "ã‚«ãƒ©ãƒ¼8", priority: 2, conditions: [ { colorSetting: "æ–‘ç‚¹ç³»", operator: ">=", threshold: 15 } ] }, 9: { level: 9, name: "ã‚«ãƒ©ãƒ¼9", priority: 1, conditions: [ { colorSetting: "è¤è‰²ç³»", operator: ">=", threshold: 20 } ] } }; const ColorData = [ { level: 2, name: "ã‚ªãƒ¼ãƒ«ã‚°ãƒªãƒ¼ãƒ³", color: "#2E7D32" }, { level: 3, name: "ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³", color: "#4CAF50" }, { level: 4, name: "ãƒãƒ¼ãƒ•ã‚°ãƒªãƒ¼ãƒ³", color: "#8BC34A" }, { level: 5, name: "ã‚°ãƒªãƒ¼ãƒ³ãƒãƒƒãƒ—", color: "#CDDC39" }, { level: 6, name: "ãƒ•ãƒ«ã‚¤ã‚¨ãƒ­ãƒ¼", color: "#FFEB3B" }, { level: 7, name: "ã‚¹ã‚¿ãƒ¼", color: "#FFC107" }, { level: 8, name: "ã‚«ãƒ©ãƒ¼8", color: "#FF9800" }, { level: 9, name: "ã‚«ãƒ©ãƒ¼9", color: "#795548" } ]; const _0xc1d2 = [ { id: 'admin', passHash: '5489133e8d9d5532b01aeea41f46437a318174f3cd31ac3fe6ed5c93d519f146', role: 'admin' }, { id: 'expert', passHash: 'c85ae548b43231211698a16d6ab845875d6f679d33c73c13c8f07918f5c7bd85', role: 'expert' }, { id: 'user', passHash: '5e2f5e045c00f496d4fbfc8a7e505f3fcf2c6a5e27a73ff98f33b13ebeeba7f1', role: 'user' } ]; async function _0xf5g6(password) { const msgBuffer = new TextEncoder().encode(password); const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer); const hashArray = Array.from(new Uint8Array(hashBuffer)); return hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); } function isMobileDevice() { return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent); } function _0x2c3d(r, g, b) { r /= 255; g /= 255; b /= 255; const max = Math.max(r, g, b); const min = Math.min(r, g, b); const delta = max - min; let h = 0; if (delta !== 0) { if (max === r) h = ((g - b) / delta) % 6; else if (max === g) h = (b - r) / delta + 2; else h = (r - g) / delta + 4; } h = Math.round(h * 60); if (h < 0) h += 360; const s = max === 0 ? 0 : Math.round((delta / max) * 100); const v = Math.round(max * 100); return { h, s, v }; } function _0x1a2b(imageData) { const data = imageData.data; const width = imageData.width; const height = imageData.height; const segmentMap = new Array(width * height).fill(0); const _0x4e5f = [ { h: [45, 65], s: [30, 100], v: [20, 95] }, { h: [25, 45], s: [40, 100], v: [25, 90] }, { h: [65, 85], s: [25, 80], v: [30, 85] }, { h: [15, 35], s: [50, 100], v: [15, 70] } ]; for (let i = 0; i < data.length; i += 4) { const pixelIndex = Math.floor(i / 4); const r = data[i]; const g = data[i + 1]; const b = data[i + 2]; const a = data[i + 3]; if (a < 128) continue; const hsv = _0x2c3d(r, g, b); let isBanana = false; for (const range of _0x4e5f) { if (hsv.h >= range.h[0] && hsv.h <= range.h[1] && hsv.s >= range.s[0] && hsv.s <= range.s[1] && hsv.v >= range.v[0] && hsv.v <= range.v[1]) { isBanana = true; break; } } if (isBanana) { segmentMap[pixelIndex] = 1; } } const cleanedMap = removeNoiseFromSegmentation(segmentMap, width, height, 0.01); const bananaRegion = findLargestConnectedComponent(cleanedMap, width, height); return bananaRegion; } function removeNoiseFromSegmentation(segmentMap, width, height, threshold) { const totalPixels = width * height; const minSize = Math.floor(totalPixels * threshold); const cleaned = [...segmentMap]; const visited = new Array(totalPixels).fill(false); for (let i = 0; i < totalPixels; i++) { if (segmentMap[i] === 1 && !visited[i]) { const component = []; const stack = [i]; while (stack.length > 0) { const current = stack.pop(); if (visited[current]) continue; visited[current] = true; component.push(current); const x = current % width; const y = Math.floor(current / width); for (let dx = -1; dx <= 1; dx++) { for (let dy = -1; dy <= 1; dy++) { if (dx === 0 && dy === 0) continue; const nx = x + dx; const ny = y + dy; if (nx >= 0 && nx < width && ny >= 0 && ny < height) { const neighbor = ny * width + nx; if (segmentMap[neighbor] === 1 && !visited[neighbor]) { stack.push(neighbor); } } } } } if (component.length < minSize) { component.forEach(pixel => { cleaned[pixel] = 0; }); } } } return cleaned; } function findLargestConnectedComponent(segmentMap, width, height) { const visited = new Array(segmentMap.length).fill(false); let largestComponent = []; for (let i = 0; i < segmentMap.length; i++) { if (segmentMap[i] === 1 && !visited[i]) { const component = bfs(segmentMap, visited, i % width, Math.floor(i / width), width, height); if (component.length > largestComponent.length) { largestComponent = component; } } } return largestComponent; } function bfs(segmentMap, visited, startX, startY, width, height) { const component = []; const queue = [{ x: startX, y: startY }]; while (queue.length > 0) { const { x, y } = queue.shift(); const index = y * width + x; if (x < 0 || x >= width || y < 0 || y >= height || visited[index] || segmentMap[index] !== 1) { continue; } visited[index] = true; component.push({ x, y }); queue.push({ x: x + 1, y: y }); queue.push({ x: x - 1, y: y }); queue.push({ x: x, y: y + 1 }); queue.push({ x: x, y: y - 1 }); } return component; } async function _0xe3f4() { console.log('ğŸ” ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†é–‹å§‹'); const userId = document.getElementById('userId').value.trim(); const password = document.getElementById('password').value; console.log('å…¥åŠ›æƒ…å ±:', { userId, passwordLength: password.length }); if (!userId || !password) { showError('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; } try { console.log('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–é–‹å§‹'); const passwordHash = await _0xf5g6(password); console.log('ç”Ÿæˆã•ã‚ŒãŸãƒãƒƒã‚·ãƒ¥:', passwordHash); console.log('æœŸå¾…ã•ã‚Œã‚‹ãƒãƒƒã‚·ãƒ¥:', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾å­˜'); console.log('ãƒãƒƒã‚·ãƒ¥ä¸€è‡´ãƒã‚§ãƒƒã‚¯ä¸­...'); console.log('_0xc1d2é…åˆ—:', _0xc1d2); const user = _0xc1d2.find(u => u.id === userId && u.passHash === passwordHash); console.log('æ¤œç´¢çµæœ:', user); if (user) { AppState.currentUser = user; showMainScreen(); console.log(`âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: ${user.id} (${user.role})`); } else { console.log('âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); console.log('æ¤œç´¢æ¡ä»¶:', { userId, passwordHash }); showError('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'); } } catch (error) { showError('ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error); } } async function handleLogout() { if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) { AppState.currentUser = null; showAuthScreen(); resetForm(); } } function showMainScreen() { document.getElementById('authScreen').classList.add('hidden'); document.getElementById('mainScreen').classList.remove('hidden'); const display = document.getElementById('currentUserDisplay'); if (display && AppState.currentUser) { const roleText = getRoleDisplayText(AppState.currentUser.role); display.textContent = `${AppState.currentUser.id}ï¼ˆ${roleText}ï¼‰[ã‚ªãƒ•ãƒ©ã‚¤ãƒ³]`; } initializeColorChart(); initializeFormElements(); setupDateLimits(); updateUIByRole(); } function showAuthScreen() { document.getElementById('mainScreen').classList.add('hidden'); document.getElementById('authScreen').classList.remove('hidden'); document.getElementById('userId').value = ''; document.getElementById('password').value = ''; } function getRoleDisplayText(role) { const roleMap = { 'admin': 'ç®¡ç†è€…', 'expert': 'ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ', 'user': 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' }; return roleMap[role] || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'; } function updateUIByRole() { const isAdmin = AppState.currentUser?.role === 'admin'; const isExpert = ['admin', 'expert'].includes(AppState.currentUser?.role); document.querySelectorAll('.admin-only').forEach(el => { el.classList.toggle('hidden', !isAdmin); }); document.querySelectorAll('.expert-only').forEach(el => { el.classList.toggle('hidden', !isExpert); }); } function initializeColorChart() { const container = document.getElementById('colorChart'); if (!container) return; container.innerHTML = ''; ColorData.forEach(color => { const item = document.createElement('div'); item.className = 'color-item'; item.dataset.level = color.level; item.style.backgroundColor = color.color; item.innerHTML = ` <div class="color-number">${color.level}</div> ${color.name ? `<div class="color-name">${color.name}</div>` : ''} `; item.addEventListener('click', () => selectColor(color.level)); container.appendChild(item); }); } function selectColor(level) { document.querySelectorAll('.color-item').forEach(item => { item.classList.remove('selected'); }); const selectedItem = document.querySelector(`[data-level="${level}"]`); if (selectedItem) { selectedItem.classList.add('selected'); AppState.visualJudgment = level; const colorInfo = ColorData.find(c => c.level === level); const colorName = colorInfo ? (colorInfo.name || `ã‚«ãƒ©ãƒ¼${level}`) : `ã‚«ãƒ©ãƒ¼${level}`; document.getElementById('selectedColorText').textContent = colorName; updateAnalyzeButton(); } } function handleImageSelect(event) { const file = event.target.files?.[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { AppState.currentImage = e.target.result; displayImagePreview(e.target.result); performImageAnalysis(e.target.result); updateAnalyzeButton(); }; reader.readAsDataURL(file); event.target.value = ''; } function displayImagePreview(imageSrc) { const preview = document.getElementById('imagePreview'); if (preview) { preview.innerHTML = `<img src="${imageSrc}" style="max-width: 100%; max-height: 300px; border-radius: 8px;">`; } } function performImageAnalysis(imageSrc) { const img = new Image(); img.onload = function() { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); const MAX_SIZE = 800; let { width, height } = img; if (width > MAX_SIZE || height > MAX_SIZE) { const scale = Math.min(MAX_SIZE / width, MAX_SIZE / height); width = Math.floor(width * scale); height = Math.floor(height * scale); } canvas.width = width; canvas.height = height; ctx.drawImage(img, 0, 0, width, height); AppState.imageData = ctx.getImageData(0, 0, width, height); AppState.bananaRegion = _0x1a2b(AppState.imageData); if (AppState.currentUser?.role === 'admin') { showBananaRegionPreview(); } console.log(`âœ… ãƒãƒŠãƒŠé ˜åŸŸæ¤œå‡ºå®Œäº†: ${AppState.bananaRegion.length}ãƒ”ã‚¯ã‚»ãƒ«`); }; img.src = imageSrc; } function showBananaRegionPreview() { const preview = document.getElementById('bananaRegionPreview'); const canvas = document.getElementById('regionCanvas'); const statsContainer = document.getElementById('regionStats'); if (!preview || !canvas || !AppState.imageData || !AppState.bananaRegion) return; const ctx = canvas.getContext('2d'); canvas.width = AppState.imageData.width; canvas.height = AppState.imageData.height; ctx.putImageData(AppState.imageData, 0, 0); ctx.fillStyle = 'rgba(255, 0, 0, 0.3)'; AppState.bananaRegion.forEach(pixel => { ctx.fillRect(pixel.x, pixel.y, 1, 1); }); const totalPixels = AppState.imageData.width * AppState.imageData.height; const bananaPixels = AppState.bananaRegion.length; const coverage = ((bananaPixels / totalPixels) * 100).toFixed(1); statsContainer.innerHTML = ` <div class="stat-item"> <div class="stat-value">${bananaPixels.toLocaleString()}</div> <div class="stat-label">ãƒãƒŠãƒŠãƒ”ã‚¯ã‚»ãƒ«</div> </div> <div class="stat-item"> <div class="stat-value">${coverage}%</div> <div class="stat-label">ç”»åƒå†…å‰²åˆ</div> </div> <div class="stat-item"> <div class="stat-value">${AppState.imageData.width}Ã—${AppState.imageData.height}</div> <div class="stat-label">ç”»åƒã‚µã‚¤ã‚º</div> </div> `; preview.classList.remove('hidden'); } function updateAnalyzeButton() { const btn = document.getElementById('analyzeBtn'); if (btn) { btn.disabled = !(AppState.currentImage && AppState.visualJudgment); } } async function handleAnalyze() { if (!AppState.currentImage || !AppState.visualJudgment) { showError('ç”»åƒã‚’é¸æŠã—ã€ç›®è¦–åˆ¤å®šã‚’è¡Œã£ã¦ãã ã•ã„'); return; } const btn = document.getElementById('analyzeBtn'); const originalText = btn.textContent; btn.textContent = 'ğŸ” è§£æä¸­...'; btn.disabled = true; try { await new Promise(resolve => setTimeout(resolve, 2000)); let detectedLevel; if (AppState.bananaRegion && AppState.bananaRegion.length > 0) { detectedLevel = analyzeHSVInRegion(AppState.imageData, AppState.bananaRegion); } else { detectedLevel = Math.floor(Math.random() * 8) + 2; } AppState.analysisResult = { detectedLevel: detectedLevel, bananaRegionDetected: AppState.bananaRegion && AppState.bananaRegion.length > 0, totalPixels: AppState.imageData ? AppState.imageData.width * AppState.imageData.height : 0, bananaPixels: AppState.bananaRegion ? AppState.bananaRegion.length : 0 }; displayAnalysisResult(); enableExportButtons(); } catch (error) { console.error('è§£æã‚¨ãƒ©ãƒ¼:', error); showError('è§£æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); } finally { btn.textContent = originalText; btn.disabled = false; } } const _0x8c9d = { "ç·‘ç³»": { name: "ç·‘ç³»", hue: { min: 70, max: 150 }, saturation: { min: 40 }, brightness: { min: 20, max: 80 }, color: "#4CAF50" }, "é»„ç·‘ç³»": { name: "é»„ç·‘ç³»", hue: { min: 50, max: 100 }, saturation: { min: 25 }, brightness: { min: 40, max: 90 }, color: "#8BC34A" }, "é»„è‰²ç³»": { name: "é»„è‰²ç³»", hue: { min: 30, max: 70 }, saturation: { min: 40 }, brightness: { min: 60, max: 100 }, color: "#FFEB3B" }, "æ–‘ç‚¹ç³»": { name: "æ–‘ç‚¹ç³»", hue: { min: 20, max: 50 }, saturation: { min: 50 }, brightness: { min: 60, max: 95 }, color: "#FF9800" }, "è¤è‰²ç³»": { name: "è¤è‰²ç³»", hue: { min: 0, max: 30 }, saturation: { min: 30 }, brightness: { min: 20, max: 70 }, color: "#795548" } }; function analyzeHSVInRegion(imageData, region) { if (!region || region.length === 0) { return Math.floor(Math.random() * 8) + 2; } const trimmedRegion = trimNonBananaAreas(imageData, region); const detailedAnalysis = _0x6a7b(imageData, trimmedRegion); AppState.detailedAnalysis = detailedAnalysis; return determineFinalColorLevel(detailedAnalysis); } function trimNonBananaAreas(imageData, region) { if (!region || region.length === 0) return region; const data = imageData.data; const width = imageData.width; return region.filter(pixel => { const index = (pixel.y * width + pixel.x) * 4; const r = data[index]; const g = data[index + 1]; const b = data[index + 2]; const hsv = _0x2c3d(r, g, b); return (hsv.h >= 0 && hsv.h <= 150) && (hsv.s >= 20) && (hsv.v >= 15); }); } function _0x6a7b(imageData, region) { const analysis = {}; const data = imageData.data; const width = imageData.width; const totalPixels = region ? region.length : imageData.width * imageData.height; Object.keys(_0x8c9d).forEach(settingName => { const setting = _0x8c9d[settingName]; const matchingPixels = []; const hsvValues = []; if (region) { region.forEach(pixel => { const index = (pixel.y * width + pixel.x) * 4; const r = data[index]; const g = data[index + 1]; const b = data[index + 2]; const hsv = _0x2c3d(r, g, b); if (matchesColorSetting(hsv, setting)) { matchingPixels.push(pixel); hsvValues.push(hsv); } }); } analysis[settingName] = { pixelCount: matchingPixels.length, areaPercentage: totalPixels > 0 ? (matchingPixels.length / totalPixels) * 100 : 0, actualHSV: calculateAverageHSV(hsvValues) }; }); return analysis; } function matchesColorSetting(hsv, setting) { const h = hsv.h; const s = hsv.s; const v = hsv.v; const hueInRange = (h >= setting.hue.min && h <= setting.hue.max); const satOk = s >= setting.saturation.min; const brightOk = (!setting.brightness.max || (v >= setting.brightness.min && v <= setting.brightness.max)); return hueInRange && satOk && brightOk; } function calculateAverageHSV(hsvValues) { if (!hsvValues || hsvValues.length === 0) return null; const sum = hsvValues.reduce((acc, hsv) => { acc.h += hsv.h; acc.s += hsv.s; acc.v += hsv.v; return acc; }, { h: 0, s: 0, v: 0 }); return { hue: Math.round(sum.h / hsvValues.length), saturation: Math.round(sum.s / hsvValues.length), brightness: Math.round(sum.v / hsvValues.length) }; } function determineFinalColorLevel(detailedAnalysis) { const sortedRules = Object.values(_0xaebf).sort((a, b) => b.priority - a.priority); for (const rule of sortedRules) { let allConditionsMet = true; const conditionResults = []; for (const condition of rule.conditions) { const colorType = condition.colorSetting; const actualPercentage = detailedAnalysis[colorType]?.areaPercentage || 0; let conditionMet = false; switch (condition.operator) { case '>=': conditionMet = actualPercentage >= condition.threshold; break; case '>': conditionMet = actualPercentage > condition.threshold; break; case '<=': conditionMet = actualPercentage <= condition.threshold; break; case '<': conditionMet = actualPercentage < condition.threshold; break; case '==': case '=': conditionMet = actualPercentage === condition.threshold; break; case 'range': conditionMet = actualPercentage >= (condition.min || 0) && actualPercentage <= (condition.max || 100); break; } conditionResults.push({ colorType: colorType, actualPercentage: actualPercentage, operator: condition.operator, threshold: condition.threshold, min: condition.min, max: condition.max, met: conditionMet }); if (!conditionMet) { allConditionsMet = false; break; } } if (allConditionsMet) { console.log(`ğŸ¯ åˆ¤å®šæ¡ä»¶åˆè‡´: ã‚«ãƒ©ãƒ¼${rule.level} (${rule.name})`, conditionResults); return rule.level; } } return 6; } function displayAnalysisResult() { const card = document.getElementById('resultCard'); const content = document.getElementById('resultContent'); if (!card || !content || !AppState.analysisResult) return; const result = AppState.analysisResult; const detectedColor = ColorData.find(c => c.level === result.detectedLevel); const selectedColor = ColorData.find(c => c.level === AppState.visualJudgment); const detectedColorName = detectedColor ? (detectedColor.name || `ã‚«ãƒ©ãƒ¼${result.detectedLevel}`) : `ã‚«ãƒ©ãƒ¼${result.detectedLevel}`; const selectedColorName = selectedColor ? (selectedColor.name || `ã‚«ãƒ©ãƒ¼${AppState.visualJudgment}`) : `ã‚«ãƒ©ãƒ¼${AppState.visualJudgment}`; const isMatch = result.detectedLevel === AppState.visualJudgment; let html = ` <div class="result-summary"> <div class="result-item"> <span class="label">ğŸ¤– è‡ªå‹•è§£æ:</span> <span class="value">${detectedColorName}</span> </div> <div class="result-item"> <span class="label">ğŸ‘ï¸ ç›®è¦–åˆ¤å®š:</span> <span class="value">${selectedColorName}</span> </div> ${result.bananaRegionDetected ? ` <div class="result-item"> <span class="label">ğŸŒ ãƒãƒŠãƒŠé ˜åŸŸ:</span> <span class="value">æ¤œå‡ºæ¸ˆã¿ (${result.bananaPixels.toLocaleString()}px)</span> </div>` : ''} <div class="result-match ${isMatch ? 'match' : 'mismatch'}"> ${isMatch ? 'âœ… ä¸€è‡´' : 'âŒ ä¸ä¸€è‡´'} </div> </div> `; content.innerHTML = html; card.classList.remove('hidden'); } function enableExportButtons() { document.getElementById('exportBtn').disabled = false; document.getElementById('emailBtn').disabled = false; } function initializeFormElements() { updateChainOptions(); updateProductOptions(); updateClaimTypeOptions(); updateCodeLabels(); const chainSelect = document.getElementById('chainName'); if (chainSelect) { chainSelect.addEventListener('change', updateStoreOptions); } } function updateChainOptions() { const select = document.getElementById('chainName'); if (!select) return; select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>'; const chains = MasterData ? MasterData.chains : Object.keys(AppState.storeData); chains.forEach(chain => { const option = document.createElement('option'); option.value = chain; option.textContent = chain; select.appendChild(option); }); } function updateStoreOptions() { const chainSelect = document.getElementById('chainName'); const storeSelect = document.getElementById('storeName'); if (!chainSelect || !storeSelect) return; const selectedChain = chainSelect.value; storeSelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>'; if (selectedChain && AppState.storeData[selectedChain]) { AppState.storeData[selectedChain].forEach(store => { const option = document.createElement('option'); option.value = store; option.textContent = store; storeSelect.appendChild(option); }); } } function updateProductOptions() { const select = document.getElementById('productName'); if (!select) return; select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>'; const products = MasterData ? MasterData.products : AppState.productData; products.forEach(product => { const option = document.createElement('option'); option.value = product; option.textContent = product; select.appendChild(option); }); } function updateClaimTypeOptions() { const select = document.getElementById('claimType'); if (!select) return; select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>'; const claimTypes = MasterData ? MasterData.claimTypes : AppState.claimTypeData; claimTypes.forEach(type => { const option = document.createElement('option'); option.value = type; option.textContent = type; select.appendChild(option); }); } function updateCodeLabels() { ['code1Label', 'code2Label', 'code3Label'].forEach((labelId, index) => { const label = document.getElementById(labelId); if (label) { const codeKey = `code${index + 1}`; label.textContent = AppState.codeNames[codeKey] || `ã‚³ãƒ¼ãƒ‰${index + 1}`; } }); } function setupDateLimits() { const today = new Date().toISOString().split('T')[0]; const deliveryDate = document.getElementById('deliveryDate'); const captureDate = document.getElementById('captureDate'); if (deliveryDate) { deliveryDate.max = today; deliveryDate.value = today; } if (captureDate) { captureDate.max = today; captureDate.value = today; } } function exportAnalysisResultCSV() { if (!AppState.analysisResult) { showError('è§£æã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰CSVå‡ºåŠ›ã—ã¦ãã ã•ã„'); return; } try { const now = new Date(); const timestamp = now.toISOString().replace(/[:.]/g, '-'); const formData = { 'ãƒã‚§ãƒ¼ãƒ³å': document.getElementById('chainName')?.value || '', 'åº—èˆ—å': document.getElementById('storeName')?.value || '', 'å•†å“å': document.getElementById('productName')?.value || '', 'ã‚¯ãƒ¬ãƒ¼ãƒ ç¨®åˆ¥': document.getElementById('claimType')?.value || '', 'ç´å“æ—¥': document.getElementById('deliveryDate')?.value || '', 'æ’®å½±æ—¥': document.getElementById('captureDate')?.value || '', 'ã‚³ãƒ¡ãƒ³ãƒˆ': document.getElementById('commentText')?.value || '', [AppState.codeNames.code1]: document.getElementById('code1')?.value || '', [AppState.codeNames.code2]: document.getElementById('code2')?.value || '', [AppState.codeNames.code3]: document.getElementById('code3')?.value || '' }; const basicInfo = { 'è§£ææ—¥æ™‚': now.toLocaleString('ja-JP'), 'ç·ãƒ”ã‚¯ã‚»ãƒ«æ•°': AppState.analysisResult.totalPixels || 0, 'ç›®è¦–é¸æŠã‚«ãƒ©ãƒ¼': `ã‚«ãƒ©ãƒ¼${AppState.visualJudgment}`, 'è‡ªå‹•è§£æã‚«ãƒ©ãƒ¼': `ã‚«ãƒ©ãƒ¼${AppState.analysisResult.detectedLevel}`, 'ä¸€è‡´é …ç›®': AppState.analysisResult.detectedLevel === AppState.visualJudgment ? 'ä¸€è‡´' : 'ä¸ä¸€è‡´' }; const headers = []; const values = []; Object.entries(basicInfo).forEach(([key, value]) => { headers.push(key); values.push(value); }); Object.entries(formData).forEach(([key, value]) => { headers.push(key); values.push(value); }); if (AppState.detailedAnalysis) { const colorSettings = ['ç·‘ç³»', 'é»„ç·‘ç³»', 'é»„è‰²ç³»', 'æ–‘ç‚¹ç³»', 'è¤è‰²ç³»']; colorSettings.forEach(settingName => { const analysis = AppState.detailedAnalysis[settingName]; if (analysis) { headers.push(`${settingName}_é¢ç©å‰²åˆ(%)`); values.push(analysis.areaPercentage.toFixed(2)); headers.push(`${settingName}_ãƒ”ã‚¯ã‚»ãƒ«æ•°`); values.push(analysis.pixelCount); if (analysis.actualHSV) { headers.push(`${settingName}_å®Ÿéš›è‰²ç›¸(H)`); values.push(analysis.actualHSV.hue); headers.push(`${settingName}_å®Ÿéš›å½©åº¦(S)`); values.push(analysis.actualHSV.saturation); headers.push(`${settingName}_å®Ÿéš›æ˜åº¦(V)`); values.push(analysis.actualHSV.brightness); } else { headers.push(`${settingName}_å®Ÿéš›è‰²ç›¸(H)`); values.push(''); headers.push(`${settingName}_å®Ÿéš›å½©åº¦(S)`); values.push(''); headers.push(`${settingName}_å®Ÿéš›æ˜åº¦(V)`); values.push(''); } const colorSetting = _0x8c9d[settingName]; if (colorSetting) { headers.push(`${settingName}_è¨­å®šè‰²ç›¸ç¯„å›²`); values.push(`${colorSetting.hue.min}-${colorSetting.hue.max}`); headers.push(`${settingName}_è¨­å®šå½©åº¦æœ€å°`); values.push(colorSetting.saturation.min); headers.push(`${settingName}_è¨­å®šæ˜åº¦ç¯„å›²`); values.push(`${colorSetting.brightness.min}-${colorSetting.brightness.max}`); } } }); } const escapeCSV = (val) => { if (typeof val === 'string' && (val.includes(',') || val.includes('"') || val.includes('\n'))) { return `"${val.replace(/"/g, '""')}"`; } return val; }; const csvData = []; csvData.push(headers.join(',')); csvData.push(values.join(',')); const csvContent = '\uFEFF' + csvData.join('\n'); const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href = url; link.download = `banana_analysis_${timestamp}_${formData['ãƒã‚§ãƒ¼ãƒ³å']}_${formData['åº—èˆ—å']}_ã‚«ãƒ©ãƒ¼${AppState.analysisResult.detectedLevel}.csv`; link.click(); URL.revokeObjectURL(url); showSuccessMessage('âœ… è§£æçµæœã‚’CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ'); } catch (error) { console.error('CSVå‡ºåŠ›ã‚¨ãƒ©ãƒ¼:', error); showError('âŒ CSVå‡ºåŠ›ã«å¤±æ•—ã—ã¾ã—ãŸ'); } } function sendEmail() { if (!AppState.analysisResult) { showError('è§£æã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã—ã¦ãã ã•ã„'); return; } const chainName = document.getElementById('chainName')?.value || ''; const storeName = document.getElementById('storeName')?.value || ''; const subject = `ãƒãƒŠãƒŠå“è³ªãƒ¬ãƒãƒ¼ãƒˆ_${chainName}_${storeName}_${new Date().toISOString().slice(0, 10)}`; const body = `ãƒãƒŠãƒŠå“è³ªãƒ¬ãƒãƒ¼ãƒˆ ã€åŸºæœ¬æƒ…å ±ã€‘ ãƒã‚§ãƒ¼ãƒ³å: ${chainName} åº—èˆ—å: ${storeName} è§£ææ—¥æ™‚: ${new Date().toLocaleString()} ã€è§£æçµæœã€‘ ç›®è¦–é¸æŠ: ã‚«ãƒ©ãƒ¼${AppState.visualJudgment} è‡ªå‹•è§£æ: ã‚«ãƒ©ãƒ¼${AppState.analysisResult.detectedLevel} åˆ¤å®šçµæœ: ${AppState.analysisResult.detectedLevel === AppState.visualJudgment ? 'ä¸€è‡´' : 'ä¸ä¸€è‡´'} ãƒãƒŠãƒŠé ˜åŸŸæ¤œå‡º: ${AppState.analysisResult.bananaRegionDetected ? 'ã‚ã‚Š' : 'ãªã—'} â€»CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ç”»åƒã‚’æ·»ä»˜ã—ã¦ãã ã•ã„`; const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`; window.location.href = mailtoLink; } function resetForm() { if (confirm('å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nå…¥åŠ›å†…å®¹ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) { AppState.currentImage = null; AppState.imageData = null; AppState.bananaRegion = null; AppState.visualJudgment = null; AppState.analysisResult = null; document.getElementById('imagePreview').innerHTML = '<div class="image-placeholder">ç”»åƒãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</div>'; document.getElementById('selectedColorText').textContent = 'æœªé¸æŠ'; document.getElementById('resultCard').classList.add('hidden'); document.getElementById('bananaRegionPreview').classList.add('hidden'); ['chainName', 'storeName', 'productName', 'claimType', 'commentText', 'code1', 'code2', 'code3'].forEach(id => { const element = document.getElementById(id); if (element) element.value = ''; }); const today = new Date().toISOString().split('T')[0]; document.getElementById('deliveryDate').value = today; document.getElementById('captureDate').value = today; document.querySelectorAll('.color-item').forEach(item => { item.classList.remove('selected'); }); updateAnalyzeButton(); document.getElementById('exportBtn').disabled = true; document.getElementById('emailBtn').disabled = true; } } function showError(message) { const errorEl = document.getElementById('loginError'); if (errorEl) { errorEl.textContent = message; errorEl.classList.remove('hidden'); setTimeout(() => errorEl.classList.add('hidden'), 5000); } else { alert(message); } } function showSuccessMessage(message) { console.log(message); } function setupEventListeners() { document.getElementById('loginBtn')?.addEventListener('click', _0xe3f4); document.getElementById('userId')?.addEventListener('keypress', (e) => { if (e.key === 'Enter') _0xe3f4(); }); document.getElementById('password')?.addEventListener('keypress', (e) => { if (e.key === 'Enter') _0xe3f4(); }); document.getElementById('logoutBtn')?.addEventListener('click', handleLogout); document.getElementById('cameraBtn')?.addEventListener('click', () => { const input = document.getElementById('cameraInput'); if (input) { if (isMobileDevice()) { input.setAttribute('capture', 'environment'); } input.click(); } }); document.getElementById('fileBtn')?.addEventListener('click', () => { document.getElementById('fileInput')?.click(); }); document.getElementById('cameraInput')?.addEventListener('change', handleImageSelect); document.getElementById('fileInput')?.addEventListener('change', handleImageSelect); document.getElementById('analyzeBtn')?.addEventListener('click', handleAnalyze); document.getElementById('exportBtn')?.addEventListener('click', exportAnalysisResultCSV); document.getElementById('emailBtn')?.addEventListener('click', sendEmail); document.getElementById('resetBtn')?.addEventListener('click', resetForm); document.getElementById('settingsBtn')?.addEventListener('click', showSettings); } const MasterData = { chains: ['Aãƒã‚§ãƒ¼ãƒ³', 'Bã‚¹ãƒˆã‚¢', 'Cãƒãƒ¼ã‚±ãƒƒãƒˆ'], stores: { 'Aãƒã‚§ãƒ¼ãƒ³': ['æœ¬åº—', 'æ”¯åº—1', 'æ”¯åº—2'], 'Bã‚¹ãƒˆã‚¢': ['ä¸–ç”°è°·åº—', 'æ¸‹è°·åº—', 'æ–°å®¿åº—'], 'Cãƒãƒ¼ã‚±ãƒƒãƒˆ': ['åºœä¸­åº—', 'èª¿å¸ƒåº—', 'å›½åˆ†å¯ºåº—'] }, products: ['ãƒ•ã‚£ãƒªãƒ”ãƒ³ç”£ãƒãƒŠãƒŠ', 'ã‚¨ã‚¯ã‚¢ãƒ‰ãƒ«ç”£ãƒãƒŠãƒŠ'], claimTypes: ['ãã®ä»–', 'éç†Ÿ', 'æœªç†Ÿ', 'ãŠã•ã‚Œãƒ»å‚·', 'ãã¶ã', 'ã‚ãŠã¶ã', 'è…ã‚Œ'] }; function showSettings() { const colorSettings = document.getElementById('colorAnalysisSettings'); if (colorSettings.classList.contains('hidden')) { colorSettings.classList.remove('hidden'); initializeMasterData(); updateColorSettingsCards(); const judgmentRulesSection = document.getElementById('judgmentRulesSection'); if (judgmentRulesSection) { judgmentRulesSection.style.display = 'block'; console.log('âœ… åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºçŠ¶æ…‹ã«è¨­å®š'); } loadMasterDataFromStorage(); console.log('ğŸ”„ è¨­å®šç”»é¢è¡¨ç¤ºæ™‚ã«updateJudgmentRulesCardsã‚’å®Ÿè¡Œ'); console.log('ğŸ“‹ ç¾åœ¨ã®_0xaebf:', Object.keys(_0xaebf)); updateJudgmentRulesCards(); setTimeout(() => { updateJudgmentRulesCards(); }, 100); colorSettings.scrollIntoView({ behavior: 'smooth' }); } else { colorSettings.classList.add('hidden'); } console.log('ã‚«ãƒ©ãƒ¼åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ è¨­å®šç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ'); } function hideSettings() { const colorSettings = document.getElementById('colorAnalysisSettings'); if (colorSettings) { colorSettings.classList.add('hidden'); } console.log('ã‚«ãƒ©ãƒ¼è¨­å®šç”»é¢ã‚’éè¡¨ç¤ºã«ã—ã¾ã—ãŸ'); } function toggleMasterDataSection() { toggleSection('masterDataSection', 'masterDataToggle'); } function toggleColorSettingsSection() { toggleSection('colorSettingsSection', 'colorSettingsToggle'); } function toggleJudgmentRulesSection() { toggleSection('judgmentRulesSection', 'judgmentRulesToggle'); } function toggleSection(sectionId, toggleId) { const section = document.getElementById(sectionId); const toggle = document.getElementById(toggleId); if (section.style.display === 'none') { section.style.display = 'block'; toggle.textContent = 'â–¼'; } else { section.style.display = 'none'; toggle.textContent = 'â–¶'; } } function initializeMasterData() { updateChainTags(); updateChainSelect(); updateStoresByChain(); updateProductTags(); updateClaimTypeTags(); } function updateChainTags() { const container = document.getElementById('chainTags'); container.innerHTML = ''; MasterData.chains.forEach(chain => { const tag = createTag(chain, 'chain', () => removeChainName(chain)); container.appendChild(tag); }); } function updateChainSelect() { const select = document.getElementById('chainSelect'); select.innerHTML = '<option value="">ãƒã‚§ãƒ¼ãƒ³ã‚’é¸æŠ</option>'; MasterData.chains.forEach(chain => { const option = document.createElement('option'); option.value = chain; option.textContent = chain; select.appendChild(option); }); } function updateStoresByChain() { const container = document.getElementById('storesByChain'); container.innerHTML = ''; Object.entries(MasterData.stores).forEach(([chain, stores]) => { const chainDiv = document.createElement('div'); chainDiv.style.marginBottom = '15px'; const title = document.createElement('h6'); title.textContent = chain; title.style.color = '#FF9800'; title.style.marginBottom = '8px'; chainDiv.appendChild(title); const tagContainer = document.createElement('div'); tagContainer.className = 'tag-container'; stores.forEach(store => { const tag = createTag(store, 'store', () => removeStoreName(chain, store)); tagContainer.appendChild(tag); }); chainDiv.appendChild(tagContainer); container.appendChild(chainDiv); }); } function updateProductTags() { const container = document.getElementById('productTags'); container.innerHTML = ''; MasterData.products.forEach(product => { const tag = createTag(product, 'product', () => removeProductName(product)); container.appendChild(tag); }); } function updateClaimTypeTags() { const container = document.getElementById('claimTypeTags'); container.innerHTML = ''; MasterData.claimTypes.forEach(claimType => { const tag = createTag(claimType, 'claim', () => removeClaimType(claimType)); container.appendChild(tag); }); } function createTag(text, type, onRemove) { const tag = document.createElement('div'); tag.className = `tag ${type}`; tag.innerHTML = `${text} <button class="remove-btn" onclick="event.preventDefault(); (${onRemove.toString()})();">Ã—</button>`; return tag; } function addChainName() { const input = document.getElementById('newChainName'); const name = input.value.trim(); if (name && !MasterData.chains.includes(name)) { MasterData.chains.push(name); MasterData.stores[name] = []; updateChainTags(); updateChainSelect(); updateStoresByChain(); input.value = ''; showSuccessMessage(`ãƒã‚§ãƒ¼ãƒ³ã€Œ${name}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸ`); } } function addStoreName() { const chainSelect = document.getElementById('chainSelect'); const input = document.getElementById('newStoreName'); const chain = chainSelect.value; const store = input.value.trim(); if (chain && store && !MasterData.stores[chain].includes(store)) { MasterData.stores[chain].push(store); updateStoresByChain(); input.value = ''; showSuccessMessage(`åº—èˆ—ã€Œ${store}ã€ã‚’${chain}ã«è¿½åŠ ã—ã¾ã—ãŸ`); } } function addProductName() { const input = document.getElementById('newProductName'); const name = input.value.trim(); if (name && !MasterData.products.includes(name)) { MasterData.products.push(name); updateProductTags(); updateProductOptions(); input.value = ''; showSuccessMessage(`å•†å“ã€Œ${name}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸ`); } } function addClaimType() { const input = document.getElementById('newClaimType'); const name = input.value.trim(); if (name && !MasterData.claimTypes.includes(name)) { MasterData.claimTypes.push(name); updateClaimTypeTags(); input.value = ''; showSuccessMessage(`ã‚¯ãƒ¬ãƒ¼ãƒ ç¨®åˆ¥ã€Œ${name}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸ`); } } function removeChainName(name) { const index = MasterData.chains.indexOf(name); if (index > -1) { MasterData.chains.splice(index, 1); delete MasterData.stores[name]; updateChainTags(); updateChainSelect(); updateStoresByChain(); showSuccessMessage(`ãƒã‚§ãƒ¼ãƒ³ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`); } } function removeStoreName(chain, store) { const stores = MasterData.stores[chain]; if (stores) { const index = stores.indexOf(store); if (index > -1) { stores.splice(index, 1); updateStoresByChain(); showSuccessMessage(`åº—èˆ—ã€Œ${store}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`); } } } function removeProductName(name) { const index = MasterData.products.indexOf(name); if (index > -1) { MasterData.products.splice(index, 1); updateProductTags(); updateProductOptions(); showSuccessMessage(`å•†å“ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`); } } function removeClaimType(name) { const index = MasterData.claimTypes.indexOf(name); if (index > -1) { MasterData.claimTypes.splice(index, 1); updateClaimTypeTags(); showSuccessMessage(`ã‚¯ãƒ¬ãƒ¼ãƒ ç¨®åˆ¥ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`); } } function updateColorSettingsCards() { const container = document.getElementById('colorSettingsCards'); if (!container) return; const colorClasses = ['green', 'yellow-green', 'yellow', 'orange', 'brown']; let html = ''; Object.entries(_0x8c9d).forEach(([name, setting], index) => { const colorClass = colorClasses[index] || 'green'; html += ` <div class="color-settings-card ${colorClass}"> <div class="color-info"> <h6>${name}</h6> <div class="hsv-info"> è‰²ç›¸: ${setting.hue.min}Â°ï½${setting.hue.max}Â° | å½©åº¦: ${setting.saturation.min}%ä»¥ä¸Š | æ˜åº¦: ${setting.brightness.min}ï½${setting.brightness.max}% </div> </div> <button class="btn btn-secondary" onclick="editColorSetting('${name}')"> ğŸ”§ ç·¨é›† </button> </div> `; }); container.innerHTML = html; } function updateJudgmentRulesCards() { console.log('ğŸ”„ updateJudgmentRulesCards é–‹å§‹'); const container = document.getElementById('judgmentRulesCards'); if (!container) { console.error('âŒ judgmentRulesCards ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); return; } console.log('ğŸ“‹ _0xaebf:', _0xaebf); let html = ''; const sortedRules = Object.values(_0xaebf).sort((a, b) => a.priority - b.priority); const levelSortedRules = Object.values(_0xaebf).sort((a, b) => a.level - b.level); console.log('ğŸ“Š è¡¨ç¤ºäºˆå®šãƒ«ãƒ¼ãƒ«æ•°:', levelSortedRules.length); levelSortedRules.forEach(rule => { console.log('ğŸ¨ ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ:', rule.name, 'conditions:', rule.conditions); let conditionText = ''; if (rule.conditions && rule.conditions.length > 0) { const conditionTexts = rule.conditions.map(condition => { if (condition.operator === 'range') { return `${condition.colorSetting} ${condition.min}%ã€œ${condition.max}%`; } else { return `${condition.colorSetting} ${condition.operator} ${condition.threshold}%`; } }); conditionText = conditionTexts.join('<br> ã‹ã¤<br>'); } else { conditionText = 'æ¡ä»¶æœªè¨­å®š'; } let nameColor = '#4CAF50'; if (rule.name.includes('ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³')) { nameColor = '#8BC34A'; } else if (rule.name.includes('ãƒãƒ¼ãƒ•ã‚°ãƒªãƒ¼ãƒ³')) { nameColor = '#9CCC65'; } else if (rule.name.includes('ã‚°ãƒªãƒ¼ãƒ³ãƒãƒƒãƒ—')) { nameColor = '#CDDC39'; } else if (rule.name.includes('ãƒ•ãƒ«ã‚¤ã‚¨ãƒ­ãƒ¼')) { nameColor = '#FFEB3B'; } else if (rule.name.includes('ã‚¹ã‚¿ãƒ¼')) { nameColor = '#FFC107'; } else if (rule.level == 8) { nameColor = '#FF9800'; } else if (rule.level == 9) { nameColor = '#795548'; } html += ` <div style="background: white; border-radius: 8px; padding: 20px; margin-bottom: 15px; border-left: 4px solid ${nameColor}; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center;"> <div style="flex: 1;"> <h6 style="color: ${nameColor}; font-size: 18px; margin-bottom: 5px; font-weight: bold;"> ${rule.name} (ã‚«ãƒ©ãƒ¼${rule.level}) </h6> <div style="color: #666; font-size: 12px; margin-bottom: 8px;"> å„ªå…ˆåº¦: ${rule.priority} </div> <div style="color: #333; font-weight: bold; margin-bottom: 3px;"> åˆ¤å®šæ¡ä»¶: </div> <div style="margin-left: 20px; color: #555;"> ${conditionText} </div> </div> <button onclick="editJudgmentRule(${rule.level})" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; min-width: 80px; display: flex; align-items: center; justify-content: center; gap: 5px;"> ğŸ”§ ç·¨é›† </button> </div> `; }); console.log('âœ… ç”Ÿæˆã•ã‚ŒãŸHTMLé•·:', html.length); console.log('ğŸ¨ HTMLå†…å®¹ (æœ€åˆã®500æ–‡å­—):', html.substring(0, 500)); container.innerHTML = html; console.log('âœ… updateJudgmentRulesCards å®Œäº†'); } function exportColorSettingsCSV() { console.log('ğŸ“¤ è‰²è¨­å®šCSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆé–‹å§‹'); const headers = ['è¨­å®šå', 'è‰²ç›¸æœ€å°', 'è‰²ç›¸æœ€å¤§', 'å½©åº¦æœ€å°', 'æ˜åº¦æœ€å°', 'æ˜åº¦æœ€å¤§']; const csvData = [headers.join(',')]; Object.entries(_0x8c9d).forEach(([settingName, setting]) => { const row = [ settingName, setting.hue.min, setting.hue.max, setting.saturation.min, setting.brightness.min, setting.brightness.max ]; csvData.push(row.join(',')); }); console.log('ğŸ“‹ CSVãƒ‡ãƒ¼ã‚¿:', csvData); const csvContent = '\uFEFF' + csvData.join('\n'); const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href = url; link.download = `banana_color_settings_${new Date().toISOString().slice(0, 10)}.csv`; console.log('ğŸ’¾ CSVãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹:', link.download); link.click(); URL.revokeObjectURL(url); showSuccessMessage('âœ… è‰²è¨­å®šã‚’CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ'); console.log('âœ… è‰²è¨­å®šCSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†'); } function exportJudgmentRulesCSV() { console.log('ğŸ“¤ åˆ¤å®šãƒ«ãƒ¼ãƒ«CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆé–‹å§‹'); const headers = ['ã‚«ãƒ©ãƒ¼', 'ã‚«ãƒ©ãƒ¼å', 'å„ªå…ˆåº¦', 'è‰²è¨­å®š', 'æ¼”ç®—å­', 'é–¾å€¤', 'ç¯„å›²æœ€å°', 'ç¯„å›²æœ€å¤§']; const csvData = [headers.join(',')]; Object.values(_0xaebf) .sort((a, b) => a.level - b.level) .forEach(rule => { console.log('ğŸ“‹ CSVãƒ«ãƒ¼ãƒ«å‡¦ç†:', rule.name, 'conditions:', rule.conditions); const conditions = rule.conditions || []; if (conditions.length === 0) { csvData.push([ `ã‚«ãƒ©ãƒ¼${rule.level}`, rule.name, rule.priority.toString(), 'æ¡ä»¶æœªè¨­å®š', '', '', '', '' ].join(',')); } else { conditions.forEach((condition, index) => { const row = [ `ã‚«ãƒ©ãƒ¼${rule.level}`, index === 0 ? rule.name : '', index === 0 ? rule.priority.toString() : '', condition.colorSetting, condition.operator, condition.threshold || '', condition.min || '', condition.max || '' ]; csvData.push(row.join(',')); }); } }); const csvContent = '\uFEFF' + csvData.join('\n'); const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href = url; link.download = `banana_judgment_rules_${new Date().toISOString().slice(0, 10)}.csv`; link.click(); URL.revokeObjectURL(url); showSuccessMessage('âœ… åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚’CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ'); } function saveMasterData() { try { console.log('ğŸ“¤ ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜é–‹å§‹:', MasterData); localStorage.setItem('bananaReporter_masterData', JSON.stringify(MasterData)); AppState.storeData = { ...MasterData.stores }; AppState.productData = [...MasterData.products]; AppState.claimTypeData = [...MasterData.claimTypes]; console.log('ğŸ“ AppStateæ›´æ–°å®Œäº†:', { stores: AppState.storeData, products: AppState.productData, claimTypes: AppState.claimTypeData }); updateChainOptions(); updateProductOptions(); updateClaimTypeOptions(); console.log('âœ… é¸æŠè‚¢æ›´æ–°å®Œäº†'); showSuccessMessage('ğŸ’¾ ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã€é¸æŠè‚¢ã«åæ˜ ã—ã¾ã—ãŸ'); console.log('ğŸ” ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ç¢ºèª:', localStorage.getItem('bananaReporter_masterData')); } catch (error) { console.error('âŒ ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error); showError('ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message); } } function resetMasterDataToDefault() { if (confirm('ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) { MasterData.chains = ['Aãƒã‚§ãƒ¼ãƒ³', 'Bã‚¹ãƒˆã‚¢', 'Cãƒãƒ¼ã‚±ãƒƒãƒˆ']; MasterData.stores = { 'Aãƒã‚§ãƒ¼ãƒ³': ['æœ¬åº—', 'æ”¯åº—1', 'æ”¯åº—2'], 'Bã‚¹ãƒˆã‚¢': ['ä¸–ç”°è°·åº—', 'æ¸‹è°·åº—', 'æ–°å®¿åº—'], 'Cãƒãƒ¼ã‚±ãƒƒãƒˆ': ['åºœä¸­åº—', 'èª¿å¸ƒåº—', 'å›½åˆ†å¯ºåº—'] }; MasterData.products = ['ãƒ•ã‚£ãƒªãƒ”ãƒ³ç”£ãƒãƒŠãƒŠ', 'ã‚¨ã‚¯ã‚¢ãƒ‰ãƒ«ç”£ãƒãƒŠãƒŠ']; MasterData.claimTypes = ['ãã®ä»–', 'éç†Ÿ', 'æœªç†Ÿ', 'ãŠã•ã‚Œãƒ»å‚·', 'ãã¶ã', 'ã‚ãŠã¶ã', 'è…ã‚Œ']; initializeMasterData(); showSuccessMessage('âœ… ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã—ãŸ'); } } function saveColorSettings() { localStorage.setItem('bananaReporter_colorSettings', JSON.stringify(_0x8c9d)); showSuccessMessage('ğŸ’¾ è‰²è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ'); } function saveJudgmentRules() { try { localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); console.log('ğŸ“ å…¨åˆ¤å®šãƒ«ãƒ¼ãƒ«ä¿å­˜å®Œäº†:', _0xaebf); showSuccessMessage('ğŸ’¾ åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ'); } catch (error) { console.error('åˆ¤å®šãƒ«ãƒ¼ãƒ«ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error); showError('åˆ¤å®šãƒ«ãƒ¼ãƒ«ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ'); } } function editColorSetting(name) { const setting = _0x8c9d[name]; if (!setting) return; const colorEditModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="colorSettingModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%;"> <h3 style="margin-bottom: 20px; color: ${setting.color};">${name} ã®è¨­å®šç·¨é›†</h3> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">è‰²ç›¸ç¯„å›²ï¼ˆHï¼‰:</label> <div style="margin-top: 5px;"> <input type="number" id="hueMin" value="${setting.hue.min}" min="0" max="360" style="width: 80px; padding: 4px;"> Â°ã€œ <input type="number" id="hueMax" value="${setting.hue.max}" min="0" max="360" style="width: 80px; padding: 4px; margin-left: 5px;"> Â° </div> </div> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">å½©åº¦æœ€å°ï¼ˆSï¼‰:</label> <div style="margin-top: 5px;"> <input type="number" id="satMin" value="${setting.saturation.min}" min="0" max="100" style="width: 80px; padding: 4px;"> %ä»¥ä¸Š </div> </div> <div style="margin-bottom: 20px;"> <label style="font-weight: bold;">æ˜åº¦ç¯„å›²ï¼ˆVï¼‰:</label> <div style="margin-top: 5px;"> <input type="number" id="brightMin" value="${setting.brightness.min}" min="0" max="100" style="width: 80px; padding: 4px;"> %ã€œ <input type="number" id="brightMax" value="${setting.brightness.max}" min="0" max="100" style="width: 80px; padding: 4px; margin-left: 5px;"> % </div> </div> <div style="text-align: right;"> <button onclick="closeColorModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button onclick="saveColorSetting('${name}')" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px;">ä¿å­˜</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', colorEditModalHtml); } function closeColorModal() { const modal = document.getElementById('colorSettingModal'); if (modal) { modal.remove(); } } function closeColorSettingModal() { const modal = document.getElementById('colorSettingModal'); if (modal) { modal.remove(); } } function saveColorSettingChanges(colorType) { const hueMin = parseInt(document.getElementById('hueMin').value); const hueMax = parseInt(document.getElementById('hueMax').value); const satMin = parseInt(document.getElementById('satMin').value); const lightMin = parseInt(document.getElementById('lightMin').value); const lightMax = parseInt(document.getElementById('lightMax').value); if (hueMin < 0 || hueMin > 360 || hueMax < 0 || hueMax > 360 || hueMin > hueMax) { alert('è‰²ç›¸ã®ç¯„å›²ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆ0-360åº¦ã€æœ€å°å€¤ â‰¤ æœ€å¤§å€¤ï¼‰'); return; } if (satMin < 0 || satMin > 100) { alert('å½©åº¦æœ€å°å€¤ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆ0-100%ï¼‰'); return; } if (lightMin < 0 || lightMin > 100 || lightMax < 0 || lightMax > 100 || lightMin > lightMax) { alert('æ˜åº¦ã®ç¯„å›²ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆ0-100%ã€æœ€å°å€¤ â‰¤ æœ€å¤§å€¤ï¼‰'); return; } COLOR_SETTINGS[colorType] = { hueMin: hueMin, hueMax: hueMax, satMin: satMin, lightMin: lightMin, lightMax: lightMax }; localStorage.setItem('COLOR_SETTINGS', JSON.stringify(COLOR_SETTINGS)); closeColorSettingModal(); updateColorSettingsCards(); console.log(`${colorType} ã®è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸ:`, COLOR_SETTINGS[colorType]); } function saveColorSetting(name) { const hueMin = parseInt(document.getElementById('hueMin').value) || _0x8c9d[name].hue.min; const hueMax = parseInt(document.getElementById('hueMax').value) || _0x8c9d[name].hue.max; const satMin = parseInt(document.getElementById('satMin').value) || _0x8c9d[name].saturation.min; const brightMin = parseInt(document.getElementById('brightMin').value) || _0x8c9d[name].brightness.min; const brightMax = parseInt(document.getElementById('brightMax').value) || _0x8c9d[name].brightness.max; if (hueMin < 0 || hueMin > 360 || hueMax < 0 || hueMax > 360 || hueMin > hueMax) { showError('è‰²ç›¸ã®ç¯„å›²ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆ0-360åº¦ã€æœ€å°å€¤ â‰¤ æœ€å¤§å€¤ï¼‰'); return; } if (satMin < 0 || satMin > 100) { showError('å½©åº¦æœ€å°å€¤ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆ0-100%ï¼‰'); return; } if (brightMin < 0 || brightMin > 100 || brightMax < 0 || brightMax > 100 || brightMin > brightMax) { showError('æ˜åº¦ã®ç¯„å›²ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆ0-100%ã€æœ€å°å€¤ â‰¤ æœ€å¤§å€¤ï¼‰'); return; } _0x8c9d[name].hue.min = hueMin; _0x8c9d[name].hue.max = hueMax; _0x8c9d[name].saturation.min = satMin; _0x8c9d[name].brightness.min = brightMin; _0x8c9d[name].brightness.max = brightMax; closeColorModal(); updateColorSettingsCards(); showSuccessMessage(`âœ… ${name}ã®è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸ`); } function editJudgmentRule(level) { console.log('ğŸ”§ editJudgmentRuleå‘¼ã³å‡ºã—:', level); const rule = _0xaebf[level]; console.log('ğŸ“‹ ãƒ«ãƒ¼ãƒ«æƒ…å ±:', rule); if (!rule) { console.error('âŒ ãƒ«ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', level); return; } console.log('ğŸ“‹ rule.conditions:', rule.conditions); const condition = (rule.conditions && rule.conditions[0]) || { colorSetting: 'ç·‘ç³»', operator: '>=', threshold: 50 }; console.log('ğŸ¯ ä½¿ç”¨ã™ã‚‹æ¡ä»¶:', condition); const simpleJudgmentModalHtml = ` <div onclick="closeJudgmentRuleModal()" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="judgmentRuleModal"> <div onclick="event.stopPropagation()" style="background: white; padding: 20px; border-radius: 12px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto; position: relative;"> <!-- é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ --> <button onclick="closeJudgmentRuleModal()" style="position: absolute; top: 10px; right: 10px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;"> âœ• </button> <h3 style="margin-bottom: 20px; color: #4CAF50; font-size: 18px; padding-right: 40px;">${rule.name} (ã‚«ãƒ©ãƒ¼${level}) ã®åˆ¤å®šãƒ«ãƒ¼ãƒ«ç·¨é›†</h3> <div style="margin-bottom: 25px;"> <label style="font-weight: bold; display: block; margin-bottom: 8px;">å„ªå…ˆåº¦:</label> <input type="number" id="priority_${level}" value="${rule.priority}" style="padding: 8px; width: 100px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;" min="1" max="10"> <div style="color: #666; font-size: 12px; margin-top: 5px;">æ•°å€¤ãŒå°ã•ã„ã»ã©å„ªå…ˆã•ã‚Œã‚‹</div> </div> <div style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 8px;"> <h4 style="margin-bottom: 15px; font-size: 16px;">åˆ¤å®šæ¡ä»¶</h4> <div class="conditions-container"> <div class="condition-item" id="condition_0" style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #e0e0e0; margin-bottom: 15px;"> <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;"> <div style="font-weight: bold; color: #333;">æ¡ä»¶ 1</div> <button onclick="removeCondition(0)" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; ${rule.conditions && rule.conditions.length <= 1 ? 'display: none;' : ''}"> âœ• å‰Šé™¤ </button> </div> <div style="margin-bottom: 15px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">è‰²è¨­å®š:</label> <select id="colorSetting_0" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <option value="ç·‘ç³»" ${condition.colorSetting === 'ç·‘ç³»' ? 'selected' : ''}>ç·‘ç³»</option> <option value="é»„ç·‘ç³»" ${condition.colorSetting === 'é»„ç·‘ç³»' ? 'selected' : ''}>é»„ç·‘ç³»</option> <option value="é»„è‰²ç³»" ${condition.colorSetting === 'é»„è‰²ç³»' ? 'selected' : ''}>é»„è‰²ç³»</option> <option value="æ–‘ç‚¹ç³»" ${condition.colorSetting === 'æ–‘ç‚¹ç³»' ? 'selected' : ''}>æ–‘ç‚¹ç³»</option> <option value="è¤è‰²ç³»" ${condition.colorSetting === 'è¤è‰²ç³»' ? 'selected' : ''}>è¤è‰²ç³»</option> </select> </div> <div style="margin-bottom: 15px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">æ¼”ç®—å­:</label> <select id="operator_0" onchange="toggleRangeInputsForCondition(0)" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <option value=">=" ${condition.operator === '>=' ? 'selected' : ''}>ä»¥ä¸Š (>=)</option> <option value="<=" ${condition.operator === '<=' ? 'selected' : ''}>ä»¥ä¸‹ (<=)</option> <option value=">" ${condition.operator === '>' ? 'selected' : ''}>ã‚ˆã‚Šå¤§ãã„ (>)</option> <option value="<" ${condition.operator === '<' ? 'selected' : ''}>ã‚ˆã‚Šå°ã•ã„ (<)</option> <option value="range" ${condition.operator === 'range' ? 'selected' : ''}>ç¯„å›² (ç¯„å›²å†…)</option> </select> </div> <div id="thresholdInput_0" style="margin-bottom: 10px; ${condition.operator === 'range' ? 'display: none;' : ''}"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">é–¾å€¤(%):</label> <input type="number" id="threshold_0" value="${condition.threshold}" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> </div> <div id="rangeInputs_0" style="margin-bottom: 10px; ${condition.operator === 'range' ? '' : 'display: none;'}"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">ç¯„å›²(%):</label> <div style="display: flex; align-items: center; gap: 8px;"> <input type="number" id="rangeMin_0" value="${condition.min || 0}" style="padding: 8px; width: 80px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> <span>%ã€œ</span> <input type="number" id="rangeMax_0" value="${condition.max || 100}" style="padding: 8px; width: 80px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> <span>%</span> </div> </div> </div> </div> <button onclick="addSimpleCondition(${level})" style="margin-top: 15px; background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;"> â• æ¡ä»¶ã‚’è¿½åŠ  </button> </div> <div style="display: flex; gap: 10px; justify-content: center;"> <button onclick="saveSimpleJudgmentRule(${level})" style="background: #28a745; color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;"> ğŸ’¾ ä¿å­˜ </button> <button onclick="closeJudgmentRuleModal()" style="background: #6c757d; color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;"> âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ« </button> </div> </div> </div> `; console.log('ğŸ­ ãƒ¢ãƒ¼ãƒ€ãƒ«HTMLç”Ÿæˆå®Œäº†'); document.body.insertAdjacentHTML('beforeend', simpleJudgmentModalHtml); console.log('âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’DOMã«è¿½åŠ ã—ã¾ã—ãŸ'); return; let conditionsHtml = ''; rule.conditions.forEach((condition, index) => { conditionsHtml += ` <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"> <div style="margin-bottom: 10px; font-weight: bold;">æ¡ä»¶ ${index + 1}</div> <div style="margin-bottom: 10px;"> <label>è‰²è¨­å®š:</label> <select id="colorSetting_${level}_${index}" style="margin-left: 10px; padding: 4px;"> <option value="ç·‘ç³»" ${condition.colorSetting === 'ç·‘ç³»' ? 'selected' : ''}>ç·‘ç³»</option> <option value="é»„ç·‘ç³»" ${condition.colorSetting === 'é»„ç·‘ç³»' ? 'selected' : ''}>é»„ç·‘ç³»</option> <option value="é»„è‰²ç³»" ${condition.colorSetting === 'é»„è‰²ç³»' ? 'selected' : ''}>é»„è‰²ç³»</option> <option value="æ–‘ç‚¹ç³»" ${condition.colorSetting === 'æ–‘ç‚¹ç³»' ? 'selected' : ''}>æ–‘ç‚¹ç³»</option> <option value="è¤è‰²ç³»" ${condition.colorSetting === 'è¤è‰²ç³»' ? 'selected' : ''}>è¤è‰²ç³»</option> </select> </div> <div style="margin-bottom: 10px;"> <label>æ¼”ç®—å­:</label> <select id="operator_${level}_${index}" style="margin-left: 10px; padding: 4px;" onchange="toggleRangeInputs(${level}, ${index})"> <option value=">=" ${condition.operator === '>=' ? 'selected' : ''}>ä»¥ä¸Š (>=)</option> <option value="<=" ${condition.operator === '<=' ? 'selected' : ''}>ä»¥ä¸‹ (<=)</option> <option value=">" ${condition.operator === '>' ? 'selected' : ''}>ã‚ˆã‚Šå¤§ãã„ (>)</option> <option value="<" ${condition.operator === '<' ? 'selected' : ''}>ã‚ˆã‚Šå°ã•ã„ (<)</option> <option value="==" ${condition.operator === '==' ? 'selected' : ''}>ç­‰ã—ã„ (==)</option> <option value="range" ${condition.operator === 'range' ? 'selected' : ''}>ç¯„å›²å†… (range)</option> </select> </div> <div id="thresholdInput_${level}_${index}" style="margin-bottom: 10px; ${condition.operator === 'range' ? 'display: none;' : ''}"> <label>é–¾å€¤(%):</label> <input type="number" id="threshold_${level}_${index}" value="${condition.threshold || 50}" style="margin-left: 10px; padding: 4px; width: 80px;" min="0" max="100"> </div> <div id="rangeInputs_${level}_${index}" style="margin-bottom: 10px; ${condition.operator === 'range' ? '' : 'display: none;'}"> <label>ç¯„å›²:</label> <input type="number" id="rangeMin_${level}_${index}" value="${condition.min || 0}" style="margin-left: 10px; padding: 4px; width: 60px;" min="0" max="100"> %ã€œ <input type="number" id="rangeMax_${level}_${index}" value="${condition.max || 100}" style="margin-left: 5px; padding: 4px; width: 60px;" min="0" max="100"> % </div> <button onclick="removeCondition(${level}, ${index})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">æ¡ä»¶å‰Šé™¤</button> </div> `; }); const judgmentModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="judgmentRuleModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto;"> <h3 style="margin-bottom: 20px; color: #1976d2;">ã‚«ãƒ©ãƒ¼${level} (${rule.name}) ã®ç·¨é›†</h3> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">å„ªå…ˆåº¦:</label> <input type="number" id="priority_${level}" value="${rule.priority}" style="margin-left: 10px; padding: 4px; width: 80px;" min="1" max="10"> </div> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">ã‚«ãƒ©ãƒ¼å:</label> <input type="text" id="ruleName_${level}" value="${rule.name}" style="margin-left: 10px; padding: 4px; width: 200px;"> </div> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">åˆ¤å®šæ¡ä»¶:</label> <div id="conditionsContainer_${level}" style="margin-top: 10px;"> ${conditionsHtml} </div> <button onclick="addCondition(${level})" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 4px; margin-top: 10px;">æ¡ä»¶è¿½åŠ </button> </div> <div style="text-align: right;"> <button onclick="closeJudgmentRuleModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> <button onclick="saveJudgmentRule(${level})" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px;">ä¿å­˜</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', judgmentModalHtml); } function closeJudgmentRuleModal() { const modal = document.getElementById('judgmentRuleModal'); if (modal) { modal.remove(); } } function toggleRangeInputs() { toggleRangeInputsForCondition(0); } function toggleRangeInputsForCondition(conditionIndex) { const operator = document.getElementById(`operator_${conditionIndex}`); const thresholdInput = document.getElementById(`thresholdInput_${conditionIndex}`); const rangeInputs = document.getElementById(`rangeInputs_${conditionIndex}`); if (!operator || !thresholdInput || !rangeInputs) return; if (operator.value === 'range') { thresholdInput.style.display = 'none'; rangeInputs.style.display = 'block'; } else { thresholdInput.style.display = 'block'; rangeInputs.style.display = 'none'; } } function removeCondition(conditionIndex) { const conditionElement = document.getElementById(`condition_${conditionIndex}`); if (conditionElement) { const conditionsContainer = document.querySelector('.conditions-container'); const totalConditions = conditionsContainer.children.length; if (totalConditions <= 1) { alert('æœ€ä½1ã¤ã®æ¡ä»¶ã¯å¿…è¦ã§ã™ã€‚'); return; } conditionElement.remove(); console.log('âœ… æ¡ä»¶ã‚’å‰Šé™¤ã—ã¾ã—ãŸ:', conditionIndex); renumberConditions(); } } function renumberConditions() { const conditionsContainer = document.querySelector('.conditions-container'); const conditionItems = conditionsContainer.children; Array.from(conditionItems).forEach((item, index) => { const titleElement = item.querySelector('div:first-child div:first-child'); if (titleElement) { titleElement.textContent = `æ¡ä»¶ ${index + 1}`; } const deleteButton = item.querySelector('button[onclick*="removeCondition"]'); if (deleteButton) { if (conditionItems.length <= 1) { deleteButton.style.display = 'none'; } else { deleteButton.style.display = 'block'; } } }); console.log(`ğŸ“‹ æ¡ä»¶ç•ªå·ã‚’æŒ¯ã‚Šç›´ã—ã¾ã—ãŸã€‚ç¾åœ¨ã®æ¡ä»¶æ•°: ${conditionItems.length}`); } function saveJudgmentRule(level) { const priority = parseInt(document.getElementById(`priority_${level}`).value) || 1; const name = document.getElementById(`ruleName_${level}`).value.trim() || `ã‚«ãƒ©ãƒ¼${level}`; const conditionsContainer = document.querySelector('.conditions-container'); const conditionItems = conditionsContainer ? conditionsContainer.querySelectorAll('.condition-item') : []; const newConditions = []; console.log(`ğŸ” æ¡ä»¶åé›†é–‹å§‹ - æ¡ä»¶æ•°: ${conditionItems.length}`); conditionItems.forEach((item, index) => { const conditionId = item.id.replace('condition_', ''); const colorSetting = document.getElementById(`colorSetting_${conditionId}`)?.value; const operator = document.getElementById(`operator_${conditionId}`)?.value; console.log(`ğŸ” æ¡ä»¶${index + 1} - ID: ${conditionId}, è‰²è¨­å®š: ${colorSetting}, æ¼”ç®—å­: ${operator}`); if (!colorSetting || !operator) { console.warn(`âš ï¸ æ¡ä»¶${index + 1}ã‚’ã‚¹ã‚­ãƒƒãƒ— - è‰²è¨­å®šã¾ãŸã¯ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒæœªè¨­å®š`); return; } const condition = { colorSetting: colorSetting, operator: operator }; if (operator === 'range') { const minInput = document.getElementById(`rangeMin_${conditionId}`); const maxInput = document.getElementById(`rangeMax_${conditionId}`); condition.min = parseFloat(minInput?.value) || 0; condition.max = parseFloat(maxInput?.value) || 100; console.log(`ğŸ“Š ç¯„å›²æ¡ä»¶ - æœ€å°: ${condition.min}%, æœ€å¤§: ${condition.max}%`); } else { const thresholdInput = document.getElementById(`threshold_${conditionId}`); condition.threshold = parseFloat(thresholdInput?.value) || 0; console.log(`ğŸ“Š é–¾å€¤æ¡ä»¶ - å€¤: ${condition.threshold}%`); } newConditions.push(condition); console.log(`âœ… æ¡ä»¶${index + 1}ã‚’è¿½åŠ :`, condition); }); if (priority < 1 || priority > 10) { showError('å„ªå…ˆåº¦ã¯1-10ã®ç¯„å›²ã§è¨­å®šã—ã¦ãã ã•ã„'); return; } if (name.length === 0) { showError('ã‚«ãƒ©ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; } if (newConditions.length === 0) { showError('æœ€ä½1ã¤ã®æ¡ä»¶ã‚’è¨­å®šã—ã¦ãã ã•ã„'); return; } _0xaebf[level] = { level: level, name: name, priority: priority, conditions: newConditions }; try { localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); console.log(`ğŸ“ ã‚«ãƒ©ãƒ¼${level}ãƒ«ãƒ¼ãƒ«æ›´æ–°ä¿å­˜:`, _0xaebf[level]); } catch (error) { console.error('åˆ¤å®šãƒ«ãƒ¼ãƒ«ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error); showError('åˆ¤å®šãƒ«ãƒ¼ãƒ«ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ'); return; } closeJudgmentRuleModal(); updateJudgmentRulesCards(); setTimeout(() => { updateJudgmentRulesCards(); console.log('ğŸ”„ é…å»¶ç”»é¢æ›´æ–°å®Œäº†'); }, 200); showSuccessMessage(`âœ… ã‚«ãƒ©ãƒ¼${level} (${name}) ã®ãƒ«ãƒ¼ãƒ«ã‚’æ›´æ–°ãƒ»ä¿å­˜ã—ã¾ã—ãŸ`); } function toggleRangeInputs(level, index) { const operator = document.getElementById(`operator_${level}_${index}`).value; const thresholdInput = document.getElementById(`thresholdInput_${level}_${index}`); const rangeInputs = document.getElementById(`rangeInputs_${level}_${index}`); if (operator === 'range') { thresholdInput.style.display = 'none'; rangeInputs.style.display = 'block'; } else { thresholdInput.style.display = 'block'; rangeInputs.style.display = 'none'; } } function addCondition(level) { const rule = _0xaebf[level]; const newIndex = rule.conditions.length; const conditionHtml = ` <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"> <div style="margin-bottom: 10px; font-weight: bold;">æ¡ä»¶ ${newIndex + 1}</div> <div style="margin-bottom: 10px;"> <label>è‰²è¨­å®š:</label> <select id="colorSetting_${level}_${newIndex}" style="margin-left: 10px; padding: 4px;"> <option value="ç·‘ç³»">ç·‘ç³»</option> <option value="é»„ç·‘ç³»">é»„ç·‘ç³»</option> <option value="é»„è‰²ç³»">é»„è‰²ç³»</option> <option value="æ–‘ç‚¹ç³»">æ–‘ç‚¹ç³»</option> <option value="è¤è‰²ç³»">è¤è‰²ç³»</option> </select> </div> <div style="margin-bottom: 10px;"> <label>æ¼”ç®—å­:</label> <select id="operator_${level}_${newIndex}" style="margin-left: 10px; padding: 4px;" onchange="toggleRangeInputs(${level}, ${newIndex})"> <option value=">=">ä»¥ä¸Š (>=)</option> <option value="<=">ä»¥ä¸‹ (<=)</option> <option value=">">ã‚ˆã‚Šå¤§ãã„ (>)</option> <option value="<">ã‚ˆã‚Šå°ã•ã„ (<)</option> <option value="==">ç­‰ã—ã„ (==)</option> <option value="range">ç¯„å›²å†… (range)</option> </select> </div> <div id="thresholdInput_${level}_${newIndex}" style="margin-bottom: 10px;"> <label>é–¾å€¤(%):</label> <input type="number" id="threshold_${level}_${newIndex}" value="50" style="margin-left: 10px; padding: 4px; width: 80px;" min="0" max="100"> </div> <div id="rangeInputs_${level}_${newIndex}" style="margin-bottom: 10px; display: none;"> <label>ç¯„å›²:</label> <input type="number" id="rangeMin_${level}_${newIndex}" value="0" style="margin-left: 10px; padding: 4px; width: 60px;" min="0" max="100"> %ã€œ <input type="number" id="rangeMax_${level}_${newIndex}" value="100" style="margin-left: 5px; padding: 4px; width: 60px;" min="0" max="100"> % </div> <button onclick="removeCondition(${level}, ${newIndex})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">æ¡ä»¶å‰Šé™¤</button> </div> `; const container = document.getElementById(`conditionsContainer_${level}`); container.insertAdjacentHTML('beforeend', conditionHtml); rule.conditions.push({ colorSetting: "ç·‘ç³»", operator: ">=", threshold: 50 }); } function importColorSettingsCSV() { const input = document.createElement('input'); input.type = 'file'; input.accept = '.csv'; input.onchange = function(e) { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const csv = e.target.result; const lines = csv.split('\n'); if (lines.length < 2) { showError('CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ï¼‰'); return; } const headers = lines[0].split(',').map(h => h.trim()); if (!headers.includes('è¨­å®šå') || !headers.includes('è‰²ç›¸æœ€å°') || !headers.includes('è‰²ç›¸æœ€å¤§') || !headers.includes('å½©åº¦æœ€å°') || !headers.includes('æ˜åº¦æœ€å°') || !headers.includes('æ˜åº¦æœ€å¤§')) { showError('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆå¿…è¦ãªåˆ—ï¼šè¨­å®šåã€è‰²ç›¸æœ€å°ã€è‰²ç›¸æœ€å¤§ã€å½©åº¦æœ€å°ã€æ˜åº¦æœ€å°ã€æ˜åº¦æœ€å¤§ï¼‰'); return; } let importCount = 0; for (let i = 1; i < lines.length; i++) { const line = lines[i].trim(); if (!line) continue; const values = line.split(',').map(v => v.trim()); if (values.length < headers.length) continue; const settingName = values[headers.indexOf('è¨­å®šå')]; const hueMin = values[headers.indexOf('è‰²ç›¸æœ€å°')]; const hueMax = values[headers.indexOf('è‰²ç›¸æœ€å¤§')]; const satMin = values[headers.indexOf('å½©åº¦æœ€å°')]; const brightMin = values[headers.indexOf('æ˜åº¦æœ€å°')]; const brightMax = values[headers.indexOf('æ˜åº¦æœ€å¤§')]; if (!_0x8c9d[settingName]) continue; try { const hueMinValue = parseInt(hueMin); const hueMaxValue = parseInt(hueMax); const satMinValue = parseInt(satMin); const brightMinValue = parseInt(brightMin); const brightMaxValue = parseInt(brightMax); if (!isNaN(hueMinValue) && !isNaN(hueMaxValue)) { _0x8c9d[settingName].hue.min = hueMinValue; _0x8c9d[settingName].hue.max = hueMaxValue; } if (!isNaN(satMinValue)) { _0x8c9d[settingName].saturation.min = satMinValue; } if (!isNaN(brightMinValue) && !isNaN(brightMaxValue)) { _0x8c9d[settingName].brightness.min = brightMinValue; _0x8c9d[settingName].brightness.max = brightMaxValue; } importCount++; } catch (error) { console.error(`è‰²è¨­å®šã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ (${settingName}):`, error); } } if (importCount > 0) { localStorage.setItem('bananaReporter_colorSettings', JSON.stringify(_0x8c9d)); updateColorSettingsCards(); showSuccessMessage(`âœ… è‰²è¨­å®šã‚’CSVã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ (${importCount}ä»¶)`); console.log('ğŸ“¥ è‰²è¨­å®šã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†:', _0x8c9d); } else { showError('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ'); } } catch (error) { console.error('CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error); showError('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'); } }; reader.readAsText(file); }; input.click(); } function importJudgmentRulesCSV() { console.log('ğŸ“¥ åˆ¤å®šãƒ«ãƒ¼ãƒ«CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆé–‹å§‹'); const input = document.createElement('input'); input.type = 'file'; input.accept = '.csv'; input.onchange = function(e) { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const csv = e.target.result; const lines = csv.split('\n'); if (lines.length < 2) { showError('CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ï¼‰'); return; } const headers = lines[0].split(',').map(h => h.trim()); if (!headers.includes('ã‚«ãƒ©ãƒ¼') || !headers.includes('ã‚«ãƒ©ãƒ¼å') || !headers.includes('å„ªå…ˆåº¦') || !headers.includes('è‰²è¨­å®š') || !headers.includes('æ¼”ç®—å­') || !headers.includes('é–¾å€¤')) { showError('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆå¿…è¦ãªåˆ—ï¼šã‚«ãƒ©ãƒ¼ã€ã‚«ãƒ©ãƒ¼åã€å„ªå…ˆåº¦ã€è‰²è¨­å®šã€æ¼”ç®—å­ã€é–¾å€¤ï¼‰'); return; } let importCount = 0; const tempRules = {}; console.log('ğŸ“¥ CSVè§£æé–‹å§‹ - ç·è¡Œæ•°:', lines.length); for (let i = 1; i < lines.length; i++) { const line = lines[i].trim(); if (!line) continue; const values = line.split(',').map(v => v.trim()); if (values.length < headers.length) continue; const colorLevel = values[headers.indexOf('ã‚«ãƒ©ãƒ¼')]; const colorName = values[headers.indexOf('ã‚«ãƒ©ãƒ¼å')]; const priority = values[headers.indexOf('å„ªå…ˆåº¦')]; const colorType = values[headers.indexOf('è‰²è¨­å®š')]; const operator = values[headers.indexOf('æ¼”ç®—å­')]; const threshold = values[headers.indexOf('é–¾å€¤')]; const rangeMin = values[headers.indexOf('ç¯„å›²æœ€å°')]; const rangeMax = values[headers.indexOf('ç¯„å›²æœ€å¤§')]; console.log(`ğŸ“‹ è¡Œ${i}: ã‚«ãƒ©ãƒ¼=${colorLevel}, åå‰=${colorName}, å„ªå…ˆåº¦=${priority}, è‰²è¨­å®š=${colorType}`); const levelMatch = colorLevel.match(/(\d+)/); if (!levelMatch) { console.warn(`âš ï¸ è¡Œ${i}: ã‚«ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«è§£æå¤±æ•— - ${colorLevel}`); continue; } const level = parseInt(levelMatch[1]); if (level < 2 || level > 9) { console.warn(`âš ï¸ è¡Œ${i}: ã‚«ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«ç¯„å›²å¤– - ${level}`); continue; } if (!colorType || !operator) { console.warn(`âš ï¸ è¡Œ${i}: è‰²è¨­å®šã¾ãŸã¯æ¼”ç®—å­ãŒæœªè¨­å®š`); continue; } try { const priorityNum = parseInt(priority) || (tempRules[level] ? tempRules[level].priority : 1); const name = colorName || (tempRules[level] ? tempRules[level].name : `ã‚«ãƒ©ãƒ¼${level}`); let condition = { colorSetting: colorType, operator: operator }; if (operator === 'range') { condition.min = parseInt(rangeMin) || 0; condition.max = parseInt(rangeMax) || 100; } else { condition.threshold = parseInt(threshold) || 50; } if (tempRules[level]) { tempRules[level].conditions.push(condition); console.log(`â• ã‚«ãƒ©ãƒ¼${level}ã«æ¡ä»¶è¿½åŠ :`, condition); } else { tempRules[level] = { level: level, name: name, priority: priorityNum, conditions: [condition] }; console.log(`ğŸ†• ã‚«ãƒ©ãƒ¼${level}æ–°è¦ä½œæˆ:`, tempRules[level]); } importCount++; } catch (error) { console.error(`åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ (ã‚«ãƒ©ãƒ¼${level}):`, error); } } Object.keys(tempRules).forEach(level => { _0xaebf[level] = tempRules[level]; console.log(`âœ… ã‚«ãƒ©ãƒ¼${level}æœ€çµ‚ç¢ºå®š:`, _0xaebf[level]); }); if (importCount > 0) { localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); updateJudgmentRulesCards(); showSuccessMessage(`âœ… åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚’CSVã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ (${importCount}ä»¶)`); console.log('ğŸ“¥ åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†:', _0xaebf); } else { showError('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ'); } } catch (error) { console.error('åˆ¤å®šãƒ«ãƒ¼ãƒ«CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error); showError('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'); } }; reader.readAsText(file); }; input.click(); } function resetColorSettingsToDefault() { if (confirm('è‰²è¨­å®šã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) { const defaultColorSettings = { "ç·‘ç³»": { name: "ç·‘ç³»", hue: { min: 70, max: 150 }, saturation: { min: 40 }, brightness: { min: 20, max: 80 }, color: "#4CAF50" }, "é»„ç·‘ç³»": { name: "é»„ç·‘ç³»", hue: { min: 50, max: 100 }, saturation: { min: 25 }, brightness: { min: 40, max: 90 }, color: "#8BC34A" }, "é»„è‰²ç³»": { name: "é»„è‰²ç³»", hue: { min: 30, max: 70 }, saturation: { min: 40 }, brightness: { min: 60, max: 100 }, color: "#FFEB3B" }, "æ–‘ç‚¹ç³»": { name: "æ–‘ç‚¹ç³»", hue: { min: 20, max: 50 }, saturation: { min: 50 }, brightness: { min: 60, max: 95 }, color: "#FF9800" }, "è¤è‰²ç³»": { name: "è¤è‰²ç³»", hue: { min: 0, max: 30 }, saturation: { min: 30 }, brightness: { min: 20, max: 70 }, color: "#795548" } }; Object.keys(_0x8c9d).forEach(key => delete _0x8c9d[key]); Object.assign(_0x8c9d, defaultColorSettings); localStorage.setItem('bananaReporter_colorSettings', JSON.stringify(_0x8c9d)); updateColorSettingsCards(); showSuccessMessage('âœ… è‰²è¨­å®šã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã—ãŸ'); console.log('ğŸ”„ è‰²è¨­å®šã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã—ãŸ:', _0x8c9d); } } function resetJudgmentRulesToDefault() { if (confirm('åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) { Object.keys(_0xaebf).forEach(key => delete _0xaebf[key]); const defaultRules = { 2: { level: 2, name: "ã‚ªãƒ¼ãƒ«ã‚°ãƒªãƒ¼ãƒ³", priority: 8, conditions: [ { colorSetting: "ç·‘ç³»", operator: ">=", threshold: 60 } ] }, 3: { level: 3, name: "ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³", priority: 7, conditions: [ { colorSetting: "ç·‘ç³»", operator: ">=", threshold: 40 } ] }, 4: { level: 4, name: "ãƒãƒ¼ãƒ•ã‚°ãƒªãƒ¼ãƒ³", priority: 6, conditions: [ { colorSetting: "é»„ç·‘ç³»", operator: ">=", threshold: 40 } ] }, 5: { level: 5, name: "ã‚°ãƒªãƒ¼ãƒ³ãƒãƒƒãƒ—", priority: 5, conditions: [ { colorSetting: "é»„ç·‘ç³»", operator: ">=", threshold: 25 } ] }, 6: { level: 6, name: "ãƒ•ãƒ«ã‚¤ã‚¨ãƒ­ãƒ¼", priority: 4, conditions: [ { colorSetting: "é»„è‰²ç³»", operator: ">=", threshold: 50 } ] }, 7: { level: 7, name: "ã‚¹ã‚¿ãƒ¼", priority: 3, conditions: [ { colorSetting: "æ–‘ç‚¹ç³»", operator: ">=", threshold: 30 } ] }, 8: { level: 8, name: "ã‚«ãƒ©ãƒ¼8", priority: 2, conditions: [ { colorSetting: "æ–‘ç‚¹ç³»", operator: ">=", threshold: 15 } ] }, 9: { level: 9, name: "ã‚«ãƒ©ãƒ¼9", priority: 1, conditions: [ { colorSetting: "è¤è‰²ç³»", operator: ">=", threshold: 20 } ] } }; Object.assign(_0xaebf, defaultRules); localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); updateJudgmentRulesCards(); showSuccessMessage('âœ… åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã—ãŸ'); console.log('ğŸ”„ åˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚’åˆæœŸå€¤ã«æˆ»ã—ã¾ã—ãŸ:', _0xaebf); } } function loadMasterDataFromStorage() { try { const saved = localStorage.getItem('bananaReporter_masterData'); if (saved) { const savedData = JSON.parse(saved); Object.assign(MasterData, savedData); AppState.storeData = { ...MasterData.stores }; AppState.productData = [...MasterData.products]; AppState.claimTypeData = [...MasterData.claimTypes]; console.log('âœ… ä¿å­˜ã•ã‚ŒãŸãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ'); } } catch (error) { console.error('ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error); } try { const savedRules = localStorage.getItem('bananaReporter_judgmentRules'); if (savedRules) { const parsedRules = JSON.parse(savedRules); Object.assign(_0xaebf, parsedRules); console.log('âœ… ä¿å­˜ã•ã‚ŒãŸåˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ'); } } catch (error) { console.error('åˆ¤å®šãƒ«ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error); } try { const savedColorSettings = localStorage.getItem('bananaReporter_colorSettings'); if (savedColorSettings) { const parsedColorSettings = JSON.parse(savedColorSettings); Object.assign(_0x8c9d, parsedColorSettings); console.log('âœ… ä¿å­˜ã•ã‚ŒãŸè‰²è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', _0x8c9d); } } catch (error) { console.error('è‰²è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error); } } document.addEventListener('DOMContentLoaded', function() { console.log('ğŸŒ ãƒãƒŠãƒŠãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ v8.2 å®Œå…¨çµ±åˆç‰ˆ èµ·å‹•'); loadMasterDataFromStorage(); setupEventListeners(); console.log('âœ… åˆæœŸåŒ–å®Œäº†'); }); function addNewColorLevel() { const level = prompt('æ–°ã—ã„ã‚«ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ1-20ï¼‰:', '10'); if (!level || isNaN(level) || level < 1 || level > 20) { alert('æœ‰åŠ¹ãªãƒ¬ãƒ™ãƒ«ç•ªå·ï¼ˆ1-20ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; } if (_0xaebf[level]) { alert(`ã‚«ãƒ©ãƒ¼${level}ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚`); return; } const name = prompt(`ã‚«ãƒ©ãƒ¼${level}ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:`, `ã‚«ãƒ©ãƒ¼${level}`); if (!name) return; _0xaebf[level] = { level: parseInt(level), name: name.trim(), priority: parseInt(level), conditions: [{ colorSetting: 'ç·‘ç³»', operator: '>=', threshold: 50 }] }; updateJudgmentRulesCards(); showSuccessMessage(`âœ… ã‚«ãƒ©ãƒ¼${level} (${name}) ã‚’è¿½åŠ ã—ã¾ã—ãŸ`); } function duplicateRule(level) { const sourceRule = _0xaebf[level]; if (!sourceRule) return; const newLevel = prompt('è¤‡è£½å…ˆã®ã‚«ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:', (parseInt(level) + 1).toString()); if (!newLevel || isNaN(newLevel)) { alert('æœ‰åŠ¹ãªãƒ¬ãƒ™ãƒ«ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; } if (_0xaebf[newLevel]) { if (!confirm(`ã‚«ãƒ©ãƒ¼${newLevel}ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ`)) { return; } } _0xaebf[newLevel] = { level: parseInt(newLevel), name: sourceRule.name + 'ã®ã‚³ãƒ”ãƒ¼', priority: sourceRule.priority + 1, conditions: JSON.parse(JSON.stringify(sourceRule.conditions)) }; updateJudgmentRulesCards(); showSuccessMessage(`âœ… ã‚«ãƒ©ãƒ¼${level}ã‚’ã‚«ãƒ©ãƒ¼${newLevel}ã«è¤‡è£½ã—ã¾ã—ãŸ`); } function deleteRule(level) { const rule = _0xaebf[level]; if (!rule) return; if (confirm(`ã‚«ãƒ©ãƒ¼${level} (${rule.name}) ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) { delete _0xaebf[level]; updateJudgmentRulesCards(); showSuccessMessage(`âœ… ã‚«ãƒ©ãƒ¼${level}ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`); } } function testRule(level) { const rule = _0xaebf[level]; if (!rule) return; const testRuleModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="testRuleModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%;"> <h3 style="margin-bottom: 20px; color: #1976d2;">ğŸ§ª ã‚«ãƒ©ãƒ¼${level} ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ</h3> <div style="margin-bottom: 15px;"> <h5>${rule.name} (å„ªå…ˆåº¦: ${rule.priority})</h5> </div> <div style="margin-bottom: 20px;"> <h6>åˆ¤å®šæ¡ä»¶:</h6> ${rule.conditions.map((cond, i) => `<div style="margin: 5px 0; padding: 8px; background: #f8f9fa; border-radius: 4px;"> æ¡ä»¶${i+1}: ${cond.colorSetting} ${cond.operator} ${cond.threshold || (cond.min + 'ã€œ' + cond.max)}% </div>` ).join('')} </div> <div style="margin-bottom: 20px;"> <h6>ãƒ†ã‚¹ãƒˆç”¨ã®è‰²è§£æçµæœã‚’å…¥åŠ›:</h6> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;"> <div><label>ç·‘ç³» (%):</label><input type="number" id="testGreen" value="30" min="0" max="100" style="width: 60px; padding: 4px;"></div> <div><label>é»„ç·‘ç³» (%):</label><input type="number" id="testYellowGreen" value="25" min="0" max="100" style="width: 60px; padding: 4px;"></div> <div><label>é»„è‰²ç³» (%):</label><input type="number" id="testYellow" value="20" min="0" max="100" style="width: 60px; padding: 4px;"></div> <div><label>æ–‘ç‚¹ç³» (%):</label><input type="number" id="testSpot" value="15" min="0" max="100" style="width: 60px; padding: 4px;"></div> <div><label>è¤è‰²ç³» (%):</label><input type="number" id="testBrown" value="10" min="0" max="100" style="width: 60px; padding: 4px;"></div> </div> </div> <div style="text-align: center; margin-bottom: 20px;"> <button onclick="runRuleTest(${level})" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px;">ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button> </div> <div id="testResult" style="margin-bottom: 20px; padding: 10px; border-radius: 4px; min-height: 40px;"></div> <div style="text-align: right;"> <button onclick="closeTestModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px;">é–‰ã˜ã‚‹</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', testRuleModalHtml); } function runRuleTest(level) { const rule = _0xaebf[level]; const testData = { 'ç·‘ç³»': parseFloat(document.getElementById('testGreen').value) || 0, 'é»„ç·‘ç³»': parseFloat(document.getElementById('testYellowGreen').value) || 0, 'é»„è‰²ç³»': parseFloat(document.getElementById('testYellow').value) || 0, 'æ–‘ç‚¹ç³»': parseFloat(document.getElementById('testSpot').value) || 0, 'è¤è‰²ç³»': parseFloat(document.getElementById('testBrown').value) || 0 }; let allConditionsMet = true; let resultHtml = '<h6>ãƒ†ã‚¹ãƒˆçµæœ:</h6>'; rule.conditions.forEach((condition, index) => { const value = testData[condition.colorSetting]; let conditionMet = false; switch(condition.operator) { case '>=': conditionMet = value >= condition.threshold; break; case '<=': conditionMet = value <= condition.threshold; break; case '>': conditionMet = value > condition.threshold; break; case '<': conditionMet = value < condition.threshold; break; case '==': conditionMet = value == condition.threshold; break; case 'range': conditionMet = value >= condition.min && value <= condition.max; break; } const icon = conditionMet ? 'âœ…' : 'âŒ'; const bgColor = conditionMet ? '#d4edda' : '#f8d7da'; resultHtml += ` <div style="margin: 5px 0; padding: 8px; background: ${bgColor}; border-radius: 4px;"> ${icon} æ¡ä»¶${index+1}: ${condition.colorSetting} ${value}% ${condition.operator} ${condition.threshold || (condition.min + 'ã€œ' + condition.max)}% â†’ ${conditionMet ? 'æº€ãŸã™' : 'æº€ãŸã•ãªã„'} </div> `; if (!conditionMet) allConditionsMet = false; }); const finalResult = allConditionsMet ? 'âœ… åˆæ ¼' : 'âŒ ä¸åˆæ ¼'; const finalBgColor = allConditionsMet ? '#d1ecf1' : '#f5c6cb'; resultHtml += ` <div style="margin-top: 15px; padding: 12px; background: ${finalBgColor}; border-radius: 4px; text-align: center; font-weight: bold; font-size: 16px;"> æœ€çµ‚åˆ¤å®š: ${finalResult} </div> `; document.getElementById('testResult').innerHTML = resultHtml; } function closeTestModal() { const modal = document.getElementById('testRuleModal'); if (modal) modal.remove(); } function showRulePreview() { let previewHtml = '<h4>ğŸ“‹ å…¨ã‚«ãƒ©ãƒ¼åˆ¤å®šãƒ«ãƒ¼ãƒ«ä¸€è¦§</h4>'; const sortedRules = Object.values(_0xaebf).sort((a, b) => a.priority - b.priority); previewHtml += '<table style="width: 100%; border-collapse: collapse; margin-top: 15px;">'; previewHtml += '<tr style="background: #f8f9fa; border: 1px solid #dee2e6;"><th style="padding: 8px; border: 1px solid #dee2e6;">å„ªå…ˆåº¦</th><th style="padding: 8px; border: 1px solid #dee2e6;">ã‚«ãƒ©ãƒ¼</th><th style="padding: 8px; border: 1px solid #dee2e6;">åå‰</th><th style="padding: 8px; border: 1px solid #dee2e6;">æ¡ä»¶</th></tr>'; sortedRules.forEach(rule => { const conditionsText = rule.conditions.map(cond => `${cond.colorSetting} ${cond.operator} ${cond.threshold || (cond.min + 'ã€œ' + cond.max)}%` ).join(' ã‹ã¤ '); previewHtml += ` <tr style="border: 1px solid #dee2e6;"> <td style="padding: 8px; border: 1px solid #dee2e6; text-align: center;">${rule.priority}</td> <td style="padding: 8px; border: 1px solid #dee2e6; text-align: center;">ã‚«ãƒ©ãƒ¼${rule.level}</td> <td style="padding: 8px; border: 1px solid #dee2e6;">${rule.name}</td> <td style="padding: 8px; border: 1px solid #dee2e6; font-size: 12px;">${conditionsText}</td> </tr> `; }); previewHtml += '</table>'; const previewModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="previewModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto;"> ${previewHtml} <div style="text-align: right; margin-top: 20px;"> <button onclick="closePreviewModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px;">é–‰ã˜ã‚‹</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', testRuleModalHtml); } function closePreviewModal() { const modal = document.getElementById('previewModal'); if (modal) modal.remove(); } function sortRulesByPriority() { if (confirm('å…¨ã¦ã®ãƒ«ãƒ¼ãƒ«ã‚’å„ªå…ˆåº¦é †ã§ä¸¦ã³æ›¿ãˆã¾ã™ã‹ï¼Ÿ')) { updateJudgmentRulesCards(); showSuccessMessage('âœ… ãƒ«ãƒ¼ãƒ«ã‚’å„ªå…ˆåº¦é †ã§ä¸¦ã³æ›¿ãˆã¾ã—ãŸ'); } } function validateAllRules() { let issues = []; const priorities = []; Object.values(_0xaebf).forEach(rule => { if (priorities.includes(rule.priority)) { issues.push(`âš ï¸ å„ªå…ˆåº¦${rule.priority}ãŒé‡è¤‡ã—ã¦ã„ã¾ã™ (${rule.name})`); } priorities.push(rule.priority); rule.conditions.forEach((condition, index) => { if (condition.operator === 'range') { if (!condition.min && condition.min !== 0 || !condition.max && condition.max !== 0) { issues.push(`âš ï¸ ${rule.name} æ¡ä»¶${index+1}: ç¯„å›²ã®è¨­å®šãŒä¸æ­£ã§ã™`); } else if (condition.min >= condition.max) { issues.push(`âš ï¸ ${rule.name} æ¡ä»¶${index+1}: ç¯„å›²ã®æœ€å°å€¤ãŒæœ€å¤§å€¤ä»¥ä¸Šã§ã™`); } } else { if (!condition.threshold && condition.threshold !== 0) { issues.push(`âš ï¸ ${rule.name} æ¡ä»¶${index+1}: é—¾å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“`); } } }); if (!rule.conditions || rule.conditions.length === 0) { issues.push(`âš ï¸ ${rule.name}: åˆ¤å®šæ¡ä»¶ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“`); } }); let resultHtml = '<h4>ğŸ” ãƒ«ãƒ¼ãƒ«æ¤œè¨¼çµæœ</h4>'; if (issues.length === 0) { resultHtml += '<div style="color: #28a745; font-weight: bold;">âœ… å…¨ã¦ã®ãƒ«ãƒ¼ãƒ«ãŒæ­£å¸¸ã§ã™</div>'; } else { resultHtml += '<div style="color: #dc3545; font-weight: bold;">âŒ ä»¥ä¸‹ã®å•é¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ:</div><ul style="margin-top: 10px;">'; issues.forEach(issue => { resultHtml += `<li style="margin: 5px 0;">${issue}</li>`; }); resultHtml += '</ul>'; } const validationModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="validationModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 600px; width: 90%;"> ${resultHtml} <div style="text-align: right; margin-top: 20px;"> <button onclick="closeValidationModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px;">é–‰ã˜ã‚‹</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', validationModalHtml); } function closeValidationModal() { const modal = document.getElementById('validationModal'); if (modal) modal.remove(); } function saveSimpleJudgmentRule(level) { const priority = parseInt(document.getElementById(`priority_${level}`).value) || 1; const conditionsContainer = document.querySelector('.conditions-container'); const conditionItems = conditionsContainer.children; const conditions = []; Array.from(conditionItems).forEach((item, index) => { const itemId = item.id.replace('condition_', ''); const colorSetting = document.getElementById(`colorSetting_${itemId}`)?.value; const operator = document.getElementById(`operator_${itemId}`)?.value; if (!colorSetting || !operator) { console.warn(`âš ï¸ æ¡ä»¶${index + 1}ã®ãƒ‡ãƒ¼ã‚¿ãŒä¸å®Œå…¨:`, {colorSetting, operator}); return; } let condition = { colorSetting: colorSetting, operator: operator }; if (operator === 'range') { condition.min = parseInt(document.getElementById(`rangeMin_${itemId}`)?.value) || 0; condition.max = parseInt(document.getElementById(`rangeMax_${itemId}`)?.value) || 100; } else { condition.threshold = parseInt(document.getElementById(`threshold_${itemId}`)?.value) || 50; } conditions.push(condition); console.log(`âœ… æ¡ä»¶${index + 1}ã‚’åé›†:`, condition); }); if (conditions.length === 0) { showError('æœ€ä½1ã¤ã®æ¡ä»¶ã‚’è¨­å®šã—ã¦ãã ã•ã„'); return; } _0xaebf[level].priority = priority; _0xaebf[level].conditions = conditions; localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); closeJudgmentRuleModal(); updateJudgmentRulesCards(); showSuccessMessage(`âœ… ã‚«ãƒ©ãƒ¼${level}ã®ãƒ«ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ`); } function addSimpleCondition(level) { const conditionsContainer = document.querySelector('#judgmentRuleModal .conditions-container'); if (!conditionsContainer) { console.error('âŒ conditions-containerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); return; } const conditionIndex = Date.now(); const conditionCount = conditionsContainer.children.length; const conditionNumber = conditionCount + 1; const newConditionHtml = ` <div class="condition-item" id="condition_${conditionIndex}" style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #e0e0e0; margin-bottom: 15px;"> <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;"> <div style="font-weight: bold; color: #333;">æ¡ä»¶ ${conditionNumber}</div> <button onclick="removeCondition(${conditionIndex})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;"> âœ• å‰Šé™¤ </button> </div> <div style="margin-bottom: 15px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">è‰²è¨­å®š:</label> <select id="colorSetting_${conditionIndex}" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <option value="ç·‘ç³»">ç·‘ç³»</option> <option value="é»„ç·‘ç³»">é»„ç·‘ç³»</option> <option value="é»„è‰²ç³»">é»„è‰²ç³»</option> <option value="æ–‘ç‚¹ç³»">æ–‘ç‚¹ç³»</option> <option value="è¤è‰²ç³»">è¤è‰²ç³»</option> </select> </div> <div style="margin-bottom: 15px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">æ¼”ç®—å­:</label> <select id="operator_${conditionIndex}" onchange="toggleRangeInputsForCondition(${conditionIndex})" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <option value=">=">ä»¥ä¸Š (>=)</option> <option value="<=">ä»¥ä¸‹ (<=)</option> <option value=">">ã‚ˆã‚Šå¤§ãã„ (>)</option> <option value="<">ã‚ˆã‚Šå°ã•ã„ (<)</option> <option value="range">ç¯„å›² (ç¯„å›²å†…)</option> </select> </div> <div id="thresholdInput_${conditionIndex}" style="margin-bottom: 10px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">é–¾å€¤(%):</label> <input type="number" id="threshold_${conditionIndex}" value="50" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> </div> <div id="rangeInputs_${conditionIndex}" style="margin-bottom: 10px; display: none;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">ç¯„å›²(%):</label> <div style="display: flex; align-items: center; gap: 8px;"> <input type="number" id="rangeMin_${conditionIndex}" value="0" style="padding: 8px; width: 80px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> <span>%ã€œ</span> <input type="number" id="rangeMax_${conditionIndex}" value="100" style="padding: 8px; width: 80px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> <span>%</span> </div> </div> </div> `; conditionsContainer.insertAdjacentHTML('beforeend', newConditionHtml); console.log('âœ… æ–°ã—ã„æ¡ä»¶ã‚’è¿½åŠ ã—ã¾ã—ãŸ:', conditionIndex + 1); } </script> </body> </html>