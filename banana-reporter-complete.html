<!DOCTYPE html> <html lang="ja"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> <meta name="theme-color" content="#667eea"> <meta name="apple-mobile-web-app-capable" content="yes"> <title>„Éê„Éä„Éä„É¨„Éù„Éº„Çø„Éº v8.2 - ÂÆåÂÖ®Áµ±ÂêàÁâà</title> <style> * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; } :root { --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%); --success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); --danger: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%); --dark: #333333; --light: #f8f9fa; --border-radius: 10px; --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); } body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--primary); min-height: 100vh; overflow-x: hidden; } .container { max-width: 600px; margin: 0 auto; padding: 10px; overflow-x: hidden; } .auth-screen { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: var(--primary); } .auth-card { background: white; border-radius: 15px; padding: 30px; width: 90%; max-width: 400px; box-shadow: var(--box-shadow); } .auth-title { text-align: center; color: var(--dark); margin-bottom: 30px; font-size: 24px; } .header { text-align: center; padding: 20px 0; color: white; } .header h1 { font-size: 24px; font-weight: 700; margin-bottom: 5px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); } .subtitle { font-size: 14px; opacity: 0.9; } .form-group { margin-bottom: 20px; } .form-label { display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500; font-size: 14px; } .required { color: #dc3545; } .form-control { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; transition: all 0.3s; } .form-control:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); } .form-select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; background: white; cursor: pointer; transition: all 0.3s; } .form-select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); } .btn { display: inline-flex; align-items: center; justify-content: center; padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-decoration: none; } .btn-primary { background: var(--primary); color: white; } .btn-success { background: var(--success); color: white; } .btn-danger { background: var(--danger); color: white; } .btn-secondary { background: #6c757d; color: white; } .btn-info { background: #17a2b8; color: white; } .btn-block { width: 100%; margin-bottom: 10px; } .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); } .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; } .btn-group { display: flex; gap: 10px; margin-bottom: 20px; } .btn-group .btn { flex: 1; } .card { background: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding: 20px; margin-bottom: 20px; } .card h3 { color: var(--dark); margin-bottom: 15px; font-size: 18px; } .image-preview { min-height: 200px; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; margin-top: 20px; } .image-placeholder { color: #999; font-size: 14px; text-align: center; } .color-chart { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px; } .color-item { width: 80px; height: 80px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.2); position: relative; color: white; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); border: 3px solid transparent; } .color-item:hover { transform: scale(1.1); box-shadow: 0 4px 10px rgba(0,0,0,0.3); } .color-item.selected { border: 3px solid #007bff; box-shadow: 0 0 10px rgba(0, 123, 255, 0.5); transform: scale(1.1); } .color-number { font-size: 18px; font-weight: bold; } .color-name { font-size: 10px; margin-top: 2px; } .result-summary { background: #f8f9fa; padding: 15px; border-radius: 8px; } .result-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 5px 0; } .result-item .label { font-weight: bold; color: #666; } .result-item .value { font-weight: bold; color: #333; } .result-match { text-align: center; padding: 10px; border-radius: 5px; font-size: 18px; font-weight: bold; margin-top: 10px; } .result-match.match { background: #d4edda; color: #155724; } .result-match.mismatch { background: #f8d7da; color: #721c24; } .error-message { background: rgba(220, 53, 69, 0.1); color: #dc3545; padding: 10px; border-radius: 5px; margin-top: 10px; border: 1px solid rgba(220, 53, 69, 0.3); text-align: center; } .success-message { background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin-top: 10px; border: 1px solid #c3e6cb; text-align: center; } .hidden { display: none !important; } .banana-region-preview { margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; text-align: center; } .banana-region-preview canvas { max-width: 100%; border-radius: 4px; } .analysis-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 15px; } .stat-item { background: white; padding: 10px; border-radius: 6px; text-align: center; border-left: 4px solid #667eea; } .stat-value { font-size: 18px; font-weight: bold; color: #333; } .stat-label { font-size: 12px; color: #666; margin-top: 4px; } @media (max-width: 600px) { .container { padding: 5px; } .color-item { width: 60px; height: 60px; } .color-number { font-size: 14px; } .color-name { font-size: 8px; } } .settings-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 15px; } .master-section { margin-bottom: 30px; padding: 20px; background: white; border-radius: 8px; border-left: 4px solid #007bff; } .master-input-group { display: flex; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; } .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; } .tag { display: inline-block; padding: 6px 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 20px; font-size: 12px; cursor: pointer; position: relative; } .tag.product { background: linear-gradient(135deg, #e91e63, #f06292); } .tag.claim { background: linear-gradient(135deg, #03a9f4, #0288d1); } .tag .remove-btn { margin-left: 8px; background: rgba(255,255,255,0.3); border: none; border-radius: 50%; width: 20px; height: 20px; color: white; cursor: pointer; font-size: 12px; line-height: 1; } .tag .remove-btn:hover { background: rgba(255,255,255,0.5); } .color-settings-card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 15px; border-left: 4px solid; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; } .color-settings-card.green { border-left-color: #4CAF50; } .color-settings-card.yellow-green { border-left-color: #8BC34A; } .color-settings-card.yellow { border-left-color: #FFEB3B; } .color-settings-card.orange { border-left-color: #FF9800; } .color-settings-card.brown { border-left-color: #795548; } .color-info { flex: 1; } .color-info h6 { color: #333; font-size: 18px; margin-bottom: 5px; } .color-info .hsv-info { color: #666; font-size: 14px; } .judgment-rule-card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 15px; border-left: 4px solid; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; } .judgment-rule-card.color-2 { border-left-color: #2E7D32; } .judgment-rule-card.color-3 { border-left-color: #4CAF50; } .judgment-rule-card.color-4 { border-left-color: #8BC34A; } .judgment-rule-card.color-5 { border-left-color: #CDDC39; } .judgment-rule-card.color-6 { border-left-color: #FFEB3B; } .judgment-rule-card.color-7 { border-left-color: #FFC107; } .judgment-rule-card.color-8 { border-left-color: #FF9800; } .judgment-rule-card.color-9 { border-left-color: #795548; } .rule-info { flex: 1; } .rule-info h6 { color: #333; font-size: 18px; margin-bottom: 5px; } .rule-info .priority { color: #666; font-size: 12px; margin-bottom: 8px; } .rule-info .condition { color: #333; font-weight: bold; } .management-buttons { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; } @media (max-width: 768px) { .master-input-group { flex-direction: column; align-items: stretch; } .master-input-group input, .master-input-group select, .master-input-group button { width: 100% !important; margin-right: 0 !important; margin-bottom: 5px; } .management-buttons { flex-direction: column; } .management-buttons button { margin-right: 0 !important; } } </style> </head> <body> <!-- Ë™çË®ºÁîªÈù¢ --> <div class="auth-screen" id="authScreen"> <div class="auth-card"> <h2 class="auth-title">üçå „Éê„Éä„Éä„É¨„Éù„Éº„Çø„Éº v8.2</h2> <div class="form-group"> <label class="form-label">„É¶„Éº„Ç∂„ÉºID</label> <input type="text" class="form-control" id="userId" value="admin" autocomplete="username"> </div> <div class="form-group"> <label class="form-label">„Éë„Çπ„ÉØ„Éº„Éâ</label> <input type="password" class="form-control" id="password" value="" autocomplete="current-password"> </div> <button class="btn btn-primary btn-block" id="loginBtn">„É≠„Ç∞„Ç§„É≥</button> <div id="loginError" class="error-message hidden"></div> </div> </div> <!-- „É°„Ç§„É≥ÁîªÈù¢ --> <div class="container hidden" id="mainScreen"> <div class="header"> <h1>üçå „Éê„Éä„Éä„É¨„Éù„Éº„Çø„Éº</h1> <div class="subtitle">ÂìÅË≥™ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† v8.2 - <span id="currentUserDisplay"></span></div> </div> <!-- ÁîªÂÉèÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ --> <div class="card"> <h3>üì∏ ÁîªÂÉèÂÖ•Âäõ</h3> <div class="btn-group"> <button class="btn btn-primary" id="cameraBtn">üì∑ „Ç´„É°„É©ÊíÆÂΩ±</button> <button class="btn btn-secondary" id="fileBtn">üìÅ „Éï„Ç°„Ç§„É´ÈÅ∏Êäû</button> </div> <input type="file" class="form-control hidden" id="cameraInput" accept="image/*" capture="environment"> <input type="file" class="form-control hidden" id="fileInput" accept="image/*"> <div class="image-preview" id="imagePreview"> <div class="image-placeholder">ÁîªÂÉè„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div> </div> <!-- „Éê„Éä„ÉäÈ†òÂüüÊ§úÂá∫ÁµêÊûú --> <div class="banana-region-preview hidden" id="bananaRegionPreview"> <h4>üéØ „Éê„Éä„ÉäÈ†òÂüüÊ§úÂá∫ÁµêÊûú</h4> <canvas id="regionCanvas"></canvas> <div id="regionStats" class="analysis-stats"></div> </div> </div> <!-- ÁõÆË¶ñÈÅ∏Êäû„Ç´„É©„Éº„ÉÅ„É£„Éº„Éà --> <div class="card"> <h3>üëÅÔ∏è ÁõÆË¶ñÈÅ∏Êäû</h3> <div style="margin-bottom: 15px;"> <span><strong>ÈÅ∏Êäû„Åï„Çå„Åü„Ç´„É©„Éº:</strong> <span id="selectedColorText">Êú™ÈÅ∏Êäû</span></span> </div> <div class="color-chart" id="colorChart"></div> <!-- Ëß£ÊûêÂÆüË°å„Éú„Çø„É≥ --> <div style="margin-top: 20px; text-align: center;"> <button class="btn btn-success" id="analyzeBtn" style="padding: 15px 30px; font-size: 18px; font-weight: bold;" disabled>üîç Ëß£ÊûêÂÆüË°å</button> </div> </div> <!-- Ëß£ÊûêÁµêÊûú --> <div class="card hidden" id="resultCard"> <h3>üìä Ëß£ÊûêÁµêÊûú</h3> <div id="resultContent"></div> </div> <!-- ÂïÜÂìÅÊÉÖÂ†±ÂÖ•Âäõ --> <div class="card"> <h3>üìù ÂïÜÂìÅÊÉÖÂ†±</h3> <div class="form-group"> <label class="form-label">„ÉÅ„Çß„Éº„É≥Âêç <span class="required">*</span></label> <select class="form-select" id="chainName"> <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option> </select> </div> <div class="form-group"> <label class="form-label">Â∫óËàóÂêç <span class="required">*</span></label> <select class="form-select" id="storeName"> <option value="">„ÉÅ„Çß„Éº„É≥„ÇíÂÖà„Å´ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option> </select> </div> <div class="form-group"> <label class="form-label">ÂïÜÂìÅÂêç <span class="required">*</span></label> <select class="form-select" id="productName"> <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option> <option value="„Éï„Ç£„É™„Éî„É≥Áî£„Éê„Éä„Éä">„Éï„Ç£„É™„Éî„É≥Áî£„Éê„Éä„Éä</option> <option value="„Ç®„ÇØ„Ç¢„Éâ„É´Áî£„Éê„Éä„Éä">„Ç®„ÇØ„Ç¢„Éâ„É´Áî£„Éê„Éä„Éä</option> </select> </div> <div class="form-group"> <label class="form-label">„ÇØ„É¨„Éº„É†Á®ÆÂà• <span class="required">*</span></label> <select class="form-select" id="claimType"> <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option> </select> </div> <div class="form-group"> <label class="form-label">Á¥çÂìÅÊó• <span class="required">*</span></label> <input type="date" class="form-control" id="deliveryDate"> </div> <div class="form-group"> <label class="form-label">ÊíÆÂΩ±Êó• <span class="required">*</span></label> <input type="date" class="form-control" id="captureDate"> </div> <div class="form-group"> <label class="form-label">„Ç≥„É°„É≥„Éà</label> <textarea class="form-control" id="commentText" rows="3" placeholder="ËøΩÂä†„ÅÆÊÉÖÂ†±„ÇÑ„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea> </div> <!-- „Ç≥„Éº„Éâ1„Äú3 --> <div class="form-group"> <label class="form-label"><span id="code1Label">„Ç≥„Éº„Éâ1</span></label> <input type="text" class="form-control" id="code1" placeholder="„Ç≥„Éº„Éâ1„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"> </div> <div class="form-group"> <label class="form-label"><span id="code2Label">„Ç≥„Éº„Éâ2</span></label> <input type="text" class="form-control" id="code2" placeholder="„Ç≥„Éº„Éâ2„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"> </div> <div class="form-group"> <label class="form-label"><span id="code3Label">„Ç≥„Éº„Éâ3</span></label> <input type="text" class="form-control" id="code3" placeholder="„Ç≥„Éº„Éâ3„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"> </div> </div> <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ --> <div class="card"> <button class="btn btn-success btn-block" id="exportBtn" disabled>üìä CSVÂá∫Âäõ</button> <button class="btn btn-info btn-block" id="emailBtn" disabled>üìß „É°„Éº„É´ÈÄÅ‰ø°</button> <button class="btn btn-danger" id="resetBtn">üîÑ „É™„Çª„ÉÉ„Éà</button> <button class="btn btn-secondary admin-only hidden" id="settingsBtn">‚öôÔ∏è Ë®≠ÂÆö</button> <button class="btn btn-primary" id="logoutBtn">üö™ „É≠„Ç∞„Ç¢„Ç¶„Éà</button> </div> <!-- Ë®≠ÂÆöÁîªÈù¢ÔºàÁÆ°ÁêÜËÄÖÂ∞ÇÁî®Ôºâ --> <div class="card hidden" id="colorAnalysisSettings"> <h3>‚öôÔ∏è „Éê„Éä„ÉäÂìÅË≥™Âà§ÂÆö„Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö</h3> <p style="color: #666; margin-bottom: 25px;"> „Éû„Çπ„Çø„Éá„Éº„ÇøÁÆ°ÁêÜ„ÄÅHSVËâ≤ÁØÑÂõ≤Ë®≠ÂÆö„ÄÅ„Ç´„É©„Éº„É¨„Éô„É´Âà§ÂÆö„É´„Éº„É´Ë®≠ÂÆö„ÇíË°å„ÅÑ„Åæ„Åô </p> <!-- „Éû„Çπ„Çø„Éá„Éº„ÇøÁÆ°ÁêÜ --> <div style="margin-bottom: 30px;"> <h4 style="color: #1976d2; margin-bottom: 15px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px;" onclick="toggleMasterDataSection()"> üìä „Éû„Çπ„Çø„Éá„Éº„ÇøÁÆ°ÁêÜ <span id="masterDataToggle">‚ñº</span> </h4> <div id="masterDataSection" class="settings-section"> <!-- „ÉÅ„Çß„Éº„É≥Âêç„Éû„Çπ„Çø --> <div class="master-section"> <h5>„ÉÅ„Çß„Éº„É≥Âêç„Éû„Çπ„Çø</h5> <div class="master-input-group"> <input type="text" id="newChainName" placeholder="Êñ∞„Åó„ÅÑ„ÉÅ„Çß„Éº„É≥Âêç„ÇíÂÖ•Âäõ" class="form-control" style="display: inline-block; width: 70%; margin-right: 10px;"> <button class="btn btn-primary" onclick="addChainName()" style="display: inline-block; width: 25%;">‚ûï ËøΩÂä†</button> </div> <div id="chainTags" class="tag-container"></div> </div> <!-- Â∫óËàóÂêç„Éû„Çπ„Çø --> <div class="master-section"> <h5>Â∫óËàóÂêç„Éû„Çπ„Çø</h5> <div class="master-input-group"> <select id="chainSelect" class="form-control" style="display: inline-block; width: 30%; margin-right: 10px;"> <option value="">„ÉÅ„Çß„Éº„É≥„ÇíÈÅ∏Êäû</option> </select> <input type="text" id="newStoreName" placeholder="Êñ∞„Åó„ÅÑÂ∫óËàóÂêç„ÇíÂÖ•Âäõ" class="form-control" style="display: inline-block; width: 35%; margin-right: 10px;"> <button class="btn btn-primary" onclick="addStoreName()" style="display: inline-block; width: 20%;">‚ûï ËøΩÂä†</button> </div> <div id="storesByChain"></div> </div> <!-- ÂïÜÂìÅÂêç„Éû„Çπ„Çø --> <div class="master-section"> <h5>ÂïÜÂìÅÂêç„Éû„Çπ„Çø</h5> <div class="master-input-group"> <input type="text" id="newProductName" placeholder="Êñ∞„Åó„ÅÑÂïÜÂìÅÂêç„ÇíÂÖ•Âäõ" class="form-control" style="display: inline-block; width: 70%; margin-right: 10px;"> <button class="btn btn-primary" onclick="addProductName()" style="display: inline-block; width: 25%;">‚ûï ËøΩÂä†</button> </div> <div id="productTags" class="tag-container"></div> </div> <!-- „ÇØ„É¨„Éº„É†Á®ÆÂà•„Éû„Çπ„Çø --> <div class="master-section"> <h5>„ÇØ„É¨„Éº„É†Á®ÆÂà•„Éû„Çπ„Çø</h5> <div class="master-input-group"> <input type="text" id="newClaimType" placeholder="Êñ∞„Åó„ÅÑ„ÇØ„É¨„Éº„É†Á®ÆÂà•„ÇíÂÖ•Âäõ" class="form-control" style="display: inline-block; width: 70%; margin-right: 10px;"> <button class="btn btn-primary" onclick="addClaimType()" style="display: inline-block; width: 25%;">‚ûï ËøΩÂä†</button> </div> <div id="claimTypeTags" class="tag-container"></div> <div style="margin-top: 15px;"> <button class="btn btn-success" onclick="saveMasterData()" style="margin-right: 10px;">üíæ ‰øùÂ≠ò</button> <button class="btn btn-warning" onclick="resetMasterDataToDefault()">üîÑ ÂàùÊúüÂÄ§„Å´Êàª„Åô</button> </div> </div> </div> </div> <!-- HSVËâ≤ÁØÑÂõ≤Ë®≠ÂÆö --> <div style="margin-bottom: 30px;"> <h4 style="color: #4CAF50; margin-bottom: 15px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px;" onclick="toggleColorSettingsSection()"> üé® HSVËâ≤ÁØÑÂõ≤Ë®≠ÂÆö <span id="colorSettingsToggle">‚ñº</span> </h4> <div id="colorSettingsSection" class="settings-section"> <div class="color-management-header"> <h5>ÁîªÂÉèËß£ÊûêÁî®HSVËâ≤ÁØÑÂõ≤Ë®≠ÂÆö</h5> <div class="management-buttons"> <button class="btn btn-success" onclick="saveColorSettings()" style="margin-right: 10px;">üíæ ÁèæÂú®„ÅÆË®≠ÂÆö„Çí‰øùÂ≠ò</button> <button class="btn btn-info" onclick="exportColorSettingsCSV()" style="margin-right: 10px;">üì§ CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button> <button class="btn btn-secondary" onclick="importColorSettingsCSV()" style="margin-right: 10px;">üì• CSV„Ç§„É≥„Éù„Éº„Éà</button> <button class="btn btn-warning" onclick="resetColorSettingsToDefault()">üîÑ ÂàùÊúüÂÄ§„Å´Êàª„Åô</button> </div> </div> <div style="margin-top: 20px;"> <h6>ÁèæÂú®„ÅÆHSVËâ≤ÁØÑÂõ≤Ë®≠ÂÆöÔºà5Á®ÆÈ°ûÔºâ</h6> <p style="color: #666; font-size: 14px; margin-bottom: 15px;"> ÁîªÂÉèËß£Êûê„Åß‰ΩøÁî®„Åô„ÇãÂêÑËâ≤Á≥ªÁµ±„ÅÆHSVÂÄ§ÁØÑÂõ≤„ÇíË®≠ÂÆö„Åó„Åæ„ÅôÔºàËâ≤Áõ∏: 0-360¬∞„ÄÅÂΩ©Â∫¶: 0-100%„ÄÅÊòéÂ∫¶: 0-100%Ôºâ </p> <div id="colorSettingsCards"></div> </div> </div> </div> <!-- „Ç´„É©„Éº„É¨„Éô„É´Âà§ÂÆö„É´„Éº„É´Ë®≠ÂÆö --> <div style="margin-bottom: 30px;"> <h4 style="color: #FF9800; margin-bottom: 15px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px;" onclick="toggleJudgmentRulesSection()"> ‚öñÔ∏è „Ç´„É©„Éº„É¨„Éô„É´Âà§ÂÆö„É´„Éº„É´Ë®≠ÂÆö <span id="judgmentRulesToggle">‚ñº</span> </h4> <div id="judgmentRulesSection" class="settings-section"> <div class="rule-management-header"> <h5>„Ç´„É©„ÉºÂà§ÂÆö„É´„Éº„É´ÁÆ°ÁêÜ</h5> <div class="management-buttons" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;"> <button class="btn btn-success" onclick="saveJudgmentRules()" style="padding: 10px 20px;">üíæ ÁèæÂú®„ÅÆ„É´„Éº„É´„Çí‰øùÂ≠ò</button> <button class="btn btn-primary" onclick="exportJudgmentRulesCSV()" style="padding: 10px 20px;">üì§ CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button> </div> <div class="management-buttons" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;"> <button class="btn btn-secondary" onclick="importJudgmentRulesCSV()" style="padding: 10px 20px;">üì• CSV„Ç§„É≥„Éù„Éº„Éà</button> <button class="btn btn-warning" onclick="resetJudgmentRulesToDefault()" style="padding: 10px 20px;">üîÑ ÂàùÊúüÂÄ§„Å´Êàª„Åô</button> </div> </div> <div style="margin-top: 20px;" id="judgmentRulesCards"></div> </div> </div> <div style="text-align: center; margin-top: 30px;"> <button class="btn btn-secondary" onclick="hideSettings()">‚ùå Ë®≠ÂÆöÁîªÈù¢„ÇíÈñâ„Åò„Çã</button> </div> </div> </div> <script> const AppState = { currentUser: null, currentImage: null, imageData: null, bananaRegion: null, visualJudgment: null, analysisResult: null, storeData: { 'A„ÉÅ„Çß„Éº„É≥': ['Êú¨Â∫ó', 'ÊîØÂ∫ó1', 'ÊîØÂ∫ó2'], 'B„Çπ„Éà„Ç¢': ['‰∏ñÁî∞Ë∞∑Â∫ó', 'Ê∏ãË∞∑Â∫ó', 'Êñ∞ÂÆøÂ∫ó'], 'C„Éû„Éº„Ç±„ÉÉ„Éà': ['Â∫ú‰∏≠Â∫ó', 'Ë™øÂ∏ÉÂ∫ó', 'ÂõΩÂàÜÂØ∫Â∫ó'] }, productData: [ '„Éê„Éä„ÉäÔºàÊàøÔºâ', '„Éê„Éä„ÉäÔºàÂçòÂìÅÔºâ' ], claimTypeData: [ 'ÈÅéÁÜü', '„Åä„Åï„Çå„Éª„Åç„Åö', 'ËÖê„Çå', 'Êú™ÁÜü', '„Åç„Å∂„Åè', '„ÅÇ„Åä„Å∂„Åè', '„Åù„ÅÆ‰ªñ' ], codeNames: { code1: '„Ç≥„Éº„Éâ1', code2: '„Ç≥„Éº„Éâ2', code3: '„Ç≥„Éº„Éâ3' } }; let _0xaebf = { 2: { level: 2, name: "„Ç™„Éº„É´„Ç∞„É™„Éº„É≥", priority: 8, conditions: [ { colorSetting: "Á∑ëÁ≥ª", operator: ">=", threshold: 60 } ] }, 3: { level: 3, name: "„É©„Ç§„Éà„Ç∞„É™„Éº„É≥", priority: 7, conditions: [ { colorSetting: "Á∑ëÁ≥ª", operator: ">=", threshold: 40 } ] }, 4: { level: 4, name: "„Éè„Éº„Éï„Ç∞„É™„Éº„É≥", priority: 6, conditions: [ { colorSetting: "ÈªÑÁ∑ëÁ≥ª", operator: ">=", threshold: 40 } ] }, 5: { level: 5, name: "„Ç∞„É™„Éº„É≥„ÉÅ„ÉÉ„Éó", priority: 5, conditions: [ { colorSetting: "ÈªÑÁ∑ëÁ≥ª", operator: ">=", threshold: 25 } ] }, 6: { level: 6, name: "„Éï„É´„Ç§„Ç®„É≠„Éº", priority: 4, conditions: [ { colorSetting: "ÈªÑËâ≤Á≥ª", operator: ">=", threshold: 50 } ] }, 7: { level: 7, name: "„Çπ„Çø„Éº", priority: 3, conditions: [ { colorSetting: "ÊñëÁÇπÁ≥ª", operator: ">=", threshold: 30 } ] }, 8: { level: 8, name: "„Ç´„É©„Éº8", priority: 2, conditions: [ { colorSetting: "ÊñëÁÇπÁ≥ª", operator: ">=", threshold: 15 } ] }, 9: { level: 9, name: "„Ç´„É©„Éº9", priority: 1, conditions: [ { colorSetting: "Ë§êËâ≤Á≥ª", operator: ">=", threshold: 20 } ] } }; const ColorData = [ { level: 2, name: "„Ç™„Éº„É´„Ç∞„É™„Éº„É≥", color: "#2E7D32" }, { level: 3, name: "„É©„Ç§„Éà„Ç∞„É™„Éº„É≥", color: "#4CAF50" }, { level: 4, name: "„Éè„Éº„Éï„Ç∞„É™„Éº„É≥", color: "#8BC34A" }, { level: 5, name: "„Ç∞„É™„Éº„É≥„ÉÅ„ÉÉ„Éó", color: "#CDDC39" }, { level: 6, name: "„Éï„É´„Ç§„Ç®„É≠„Éº", color: "#FFEB3B" }, { level: 7, name: "„Çπ„Çø„Éº", color: "#FFC107" }, { level: 8, name: "„Ç´„É©„Éº8", color: "#FF9800" }, { level: 9, name: "„Ç´„É©„Éº9", color: "#795548" } ]; const _0xc1d2 = [ { id: 'admin', passHash: '5489133e8d9d5532b01aeea41f46437a318174f3cd31ac3fe6ed5c93d519f146', role: 'admin' }, { id: 'expert', passHash: 'c85ae548b43231211698a16d6ab845875d6f679d33c73c13c8f07918f5c7bd85', role: 'expert' }, { id: 'user', passHash: '5e2f5e045c00f496d4fbfc8a7e505f3fcf2c6a5e27a73ff98f33b13ebeeba7f1', role: 'user' } ]; async function _0xf5g6(password) { const msgBuffer = new TextEncoder().encode(password); const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer); const hashArray = Array.from(new Uint8Array(hashBuffer)); return hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); } function isMobileDevice() { return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent); } function _0x2c3d(r, g, b) { r /= 255; g /= 255; b /= 255; const max = Math.max(r, g, b); const min = Math.min(r, g, b); const delta = max - min; let h = 0; if (delta !== 0) { if (max === r) h = ((g - b) / delta) % 6; else if (max === g) h = (b - r) / delta + 2; else h = (r - g) / delta + 4; } h = Math.round(h * 60); if (h < 0) h += 360; const s = max === 0 ? 0 : Math.round((delta / max) * 100); const v = Math.round(max * 100); return { h, s, v }; } function _0x1a2b(imageData) { const data = imageData.data; const width = imageData.width; const height = imageData.height; const segmentMap = new Array(width * height).fill(0); const _0x4e5f = [ { h: [45, 65], s: [30, 100], v: [20, 95] }, { h: [25, 45], s: [40, 100], v: [25, 90] }, { h: [65, 85], s: [25, 80], v: [30, 85] }, { h: [15, 35], s: [50, 100], v: [15, 70] } ]; for (let i = 0; i < data.length; i += 4) { const pixelIndex = Math.floor(i / 4); const r = data[i]; const g = data[i + 1]; const b = data[i + 2]; const a = data[i + 3]; if (a < 128) continue; const hsv = _0x2c3d(r, g, b); let isBanana = false; for (const range of _0x4e5f) { if (hsv.h >= range.h[0] && hsv.h <= range.h[1] && hsv.s >= range.s[0] && hsv.s <= range.s[1] && hsv.v >= range.v[0] && hsv.v <= range.v[1]) { isBanana = true; break; } } if (isBanana) { segmentMap[pixelIndex] = 1; } } const cleanedMap = removeNoiseFromSegmentation(segmentMap, width, height, 0.01); const bananaRegion = findLargestConnectedComponent(cleanedMap, width, height); return bananaRegion; } function removeNoiseFromSegmentation(segmentMap, width, height, threshold) { const totalPixels = width * height; const minSize = Math.floor(totalPixels * threshold); const cleaned = [...segmentMap]; const visited = new Array(totalPixels).fill(false); for (let i = 0; i < totalPixels; i++) { if (segmentMap[i] === 1 && !visited[i]) { const component = []; const stack = [i]; while (stack.length > 0) { const current = stack.pop(); if (visited[current]) continue; visited[current] = true; component.push(current); const x = current % width; const y = Math.floor(current / width); for (let dx = -1; dx <= 1; dx++) { for (let dy = -1; dy <= 1; dy++) { if (dx === 0 && dy === 0) continue; const nx = x + dx; const ny = y + dy; if (nx >= 0 && nx < width && ny >= 0 && ny < height) { const neighbor = ny * width + nx; if (segmentMap[neighbor] === 1 && !visited[neighbor]) { stack.push(neighbor); } } } } } if (component.length < minSize) { component.forEach(pixel => { cleaned[pixel] = 0; }); } } } return cleaned; } function findLargestConnectedComponent(segmentMap, width, height) { const visited = new Array(segmentMap.length).fill(false); let largestComponent = []; for (let i = 0; i < segmentMap.length; i++) { if (segmentMap[i] === 1 && !visited[i]) { const component = bfs(segmentMap, visited, i % width, Math.floor(i / width), width, height); if (component.length > largestComponent.length) { largestComponent = component; } } } return largestComponent; } function bfs(segmentMap, visited, startX, startY, width, height) { const component = []; const queue = [{ x: startX, y: startY }]; while (queue.length > 0) { const { x, y } = queue.shift(); const index = y * width + x; if (x < 0 || x >= width || y < 0 || y >= height || visited[index] || segmentMap[index] !== 1) { continue; } visited[index] = true; component.push({ x, y }); queue.push({ x: x + 1, y: y }); queue.push({ x: x - 1, y: y }); queue.push({ x: x, y: y + 1 }); queue.push({ x: x, y: y - 1 }); } return component; } async function _0xe3f4() { console.log('üîç „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜÈñãÂßã'); const userId = document.getElementById('userId').value.trim(); const password = document.getElementById('password').value; console.log('ÂÖ•ÂäõÊÉÖÂ†±:', { userId, passwordLength: password.length }); if (!userId || !password) { showError('„É¶„Éº„Ç∂„ÉºID„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } try { console.log('„Éë„Çπ„ÉØ„Éº„Éâ„Éè„ÉÉ„Ç∑„É•ÂåñÈñãÂßã'); const passwordHash = await _0xf5g6(password); console.log('ÁîüÊàê„Åï„Çå„Åü„Éè„ÉÉ„Ç∑„É•:', passwordHash); console.log('ÊúüÂæÖ„Åï„Çå„Çã„Éè„ÉÉ„Ç∑„É•:', '„É¶„Éº„Ç∂„Éº‰æùÂ≠ò'); console.log('„Éè„ÉÉ„Ç∑„É•‰∏ÄËá¥„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...'); console.log('_0xc1d2ÈÖçÂàó:', _0xc1d2); const user = _0xc1d2.find(u => u.id === userId && u.passHash === passwordHash); console.log('Ê§úÁ¥¢ÁµêÊûú:', user); if (user) { AppState.currentUser = user; showMainScreen(); console.log(`‚úÖ „É≠„Ç∞„Ç§„É≥ÊàêÂäü: ${user.id} (${user.role})`); } else { console.log('‚ùå „É¶„Éº„Ç∂„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'); console.log('Ê§úÁ¥¢Êù°‰ª∂:', { userId, passwordHash }); showError('„É¶„Éº„Ç∂„ÉºID„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì'); } } catch (error) { showError('„É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü'); console.error('„É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº:', error); } } async function handleLogout() { if (confirm('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åô„ÅãÔºü')) { AppState.currentUser = null; showAuthScreen(); resetForm(); } } function showMainScreen() { document.getElementById('authScreen').classList.add('hidden'); document.getElementById('mainScreen').classList.remove('hidden'); const display = document.getElementById('currentUserDisplay'); if (display && AppState.currentUser) { const roleText = getRoleDisplayText(AppState.currentUser.role); display.textContent = `${AppState.currentUser.id}Ôºà${roleText}Ôºâ[„Ç™„Éï„É©„Ç§„É≥]`; } initializeColorChart(); initializeFormElements(); setupDateLimits(); updateUIByRole(); } function showAuthScreen() { document.getElementById('mainScreen').classList.add('hidden'); document.getElementById('authScreen').classList.remove('hidden'); document.getElementById('userId').value = ''; document.getElementById('password').value = ''; } function getRoleDisplayText(role) { const roleMap = { 'admin': 'ÁÆ°ÁêÜËÄÖ', 'expert': '„Ç®„Ç≠„Çπ„Éë„Éº„Éà', 'user': '„É¶„Éº„Ç∂„Éº' }; return roleMap[role] || '„É¶„Éº„Ç∂„Éº'; } function updateUIByRole() { const isAdmin = AppState.currentUser?.role === 'admin'; const isExpert = ['admin', 'expert'].includes(AppState.currentUser?.role); document.querySelectorAll('.admin-only').forEach(el => { el.classList.toggle('hidden', !isAdmin); }); document.querySelectorAll('.expert-only').forEach(el => { el.classList.toggle('hidden', !isExpert); }); } function initializeColorChart() { const container = document.getElementById('colorChart'); if (!container) return; container.innerHTML = ''; ColorData.forEach(color => { const item = document.createElement('div'); item.className = 'color-item'; item.dataset.level = color.level; item.style.backgroundColor = color.color; item.innerHTML = ` <div class="color-number">${color.level}</div> ${color.name ? `<div class="color-name">${color.name}</div>` : ''} `; item.addEventListener('click', () => selectColor(color.level)); container.appendChild(item); }); } function selectColor(level) { document.querySelectorAll('.color-item').forEach(item => { item.classList.remove('selected'); }); const selectedItem = document.querySelector(`[data-level="${level}"]`); if (selectedItem) { selectedItem.classList.add('selected'); AppState.visualJudgment = level; const colorInfo = ColorData.find(c => c.level === level); const colorName = colorInfo ? (colorInfo.name || `„Ç´„É©„Éº${level}`) : `„Ç´„É©„Éº${level}`; document.getElementById('selectedColorText').textContent = colorName; updateAnalyzeButton(); } } function handleImageSelect(event) { const file = event.target.files?.[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { AppState.currentImage = e.target.result; displayImagePreview(e.target.result); performImageAnalysis(e.target.result); updateAnalyzeButton(); }; reader.readAsDataURL(file); event.target.value = ''; } function displayImagePreview(imageSrc) { const preview = document.getElementById('imagePreview'); if (preview) { preview.innerHTML = `<img src="${imageSrc}" style="max-width: 100%; max-height: 300px; border-radius: 8px;">`; } } function performImageAnalysis(imageSrc) { const img = new Image(); img.onload = function() { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); const MAX_SIZE = 800; let { width, height } = img; if (width > MAX_SIZE || height > MAX_SIZE) { const scale = Math.min(MAX_SIZE / width, MAX_SIZE / height); width = Math.floor(width * scale); height = Math.floor(height * scale); } canvas.width = width; canvas.height = height; ctx.drawImage(img, 0, 0, width, height); AppState.imageData = ctx.getImageData(0, 0, width, height); AppState.bananaRegion = _0x1a2b(AppState.imageData); if (AppState.currentUser?.role === 'admin') { showBananaRegionPreview(); } console.log(`‚úÖ „Éê„Éä„ÉäÈ†òÂüüÊ§úÂá∫ÂÆå‰∫Ü: ${AppState.bananaRegion.length}„Éî„ÇØ„Çª„É´`); }; img.src = imageSrc; } function showBananaRegionPreview() { const preview = document.getElementById('bananaRegionPreview'); const canvas = document.getElementById('regionCanvas'); const statsContainer = document.getElementById('regionStats'); if (!preview || !canvas || !AppState.imageData || !AppState.bananaRegion) return; const ctx = canvas.getContext('2d'); canvas.width = AppState.imageData.width; canvas.height = AppState.imageData.height; ctx.putImageData(AppState.imageData, 0, 0); ctx.fillStyle = 'rgba(255, 0, 0, 0.3)'; AppState.bananaRegion.forEach(pixel => { ctx.fillRect(pixel.x, pixel.y, 1, 1); }); const totalPixels = AppState.imageData.width * AppState.imageData.height; const bananaPixels = AppState.bananaRegion.length; const coverage = ((bananaPixels / totalPixels) * 100).toFixed(1); statsContainer.innerHTML = ` <div class="stat-item"> <div class="stat-value">${bananaPixels.toLocaleString()}</div> <div class="stat-label">„Éê„Éä„Éä„Éî„ÇØ„Çª„É´</div> </div> <div class="stat-item"> <div class="stat-value">${coverage}%</div> <div class="stat-label">ÁîªÂÉèÂÜÖÂâ≤Âêà</div> </div> <div class="stat-item"> <div class="stat-value">${AppState.imageData.width}√ó${AppState.imageData.height}</div> <div class="stat-label">ÁîªÂÉè„Çµ„Ç§„Ç∫</div> </div> `; preview.classList.remove('hidden'); } function updateAnalyzeButton() { const btn = document.getElementById('analyzeBtn'); if (btn) { btn.disabled = !(AppState.currentImage && AppState.visualJudgment); } } async function handleAnalyze() { if (!AppState.currentImage || !AppState.visualJudgment) { showError('ÁîªÂÉè„ÇíÈÅ∏Êäû„Åó„ÄÅÁõÆË¶ñÂà§ÂÆö„ÇíË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ'); return; } const btn = document.getElementById('analyzeBtn'); const originalText = btn.textContent; btn.textContent = 'üîç Ëß£Êûê‰∏≠...'; btn.disabled = true; try { await new Promise(resolve => setTimeout(resolve, 2000)); let detectedLevel; if (AppState.bananaRegion && AppState.bananaRegion.length > 0) { detectedLevel = analyzeHSVInRegion(AppState.imageData, AppState.bananaRegion); } else { detectedLevel = Math.floor(Math.random() * 8) + 2; } AppState.analysisResult = { detectedLevel: detectedLevel, bananaRegionDetected: AppState.bananaRegion && AppState.bananaRegion.length > 0, totalPixels: AppState.imageData ? AppState.imageData.width * AppState.imageData.height : 0, bananaPixels: AppState.bananaRegion ? AppState.bananaRegion.length : 0 }; displayAnalysisResult(); enableExportButtons(); } catch (error) { console.error('Ëß£Êûê„Ç®„É©„Éº:', error); showError('Ëß£Êûê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü'); } finally { btn.textContent = originalText; btn.disabled = false; } } const _0x8c9d = { "Á∑ëÁ≥ª": { name: "Á∑ëÁ≥ª", hue: { min: 70, max: 150 }, saturation: { min: 40 }, brightness: { min: 20, max: 80 }, color: "#4CAF50" }, "ÈªÑÁ∑ëÁ≥ª": { name: "ÈªÑÁ∑ëÁ≥ª", hue: { min: 50, max: 100 }, saturation: { min: 25 }, brightness: { min: 40, max: 90 }, color: "#8BC34A" }, "ÈªÑËâ≤Á≥ª": { name: "ÈªÑËâ≤Á≥ª", hue: { min: 30, max: 70 }, saturation: { min: 40 }, brightness: { min: 60, max: 100 }, color: "#FFEB3B" }, "ÊñëÁÇπÁ≥ª": { name: "ÊñëÁÇπÁ≥ª", hue: { min: 20, max: 50 }, saturation: { min: 50 }, brightness: { min: 60, max: 95 }, color: "#FF9800" }, "Ë§êËâ≤Á≥ª": { name: "Ë§êËâ≤Á≥ª", hue: { min: 0, max: 30 }, saturation: { min: 30 }, brightness: { min: 20, max: 70 }, color: "#795548" } }; function analyzeHSVInRegion(imageData, region) { if (!region || region.length === 0) { return Math.floor(Math.random() * 8) + 2; } const trimmedRegion = trimNonBananaAreas(imageData, region); const detailedAnalysis = _0x6a7b(imageData, trimmedRegion); AppState.detailedAnalysis = detailedAnalysis; return determineFinalColorLevel(detailedAnalysis); } function trimNonBananaAreas(imageData, region) { if (!region || region.length === 0) return region; const data = imageData.data; const width = imageData.width; return region.filter(pixel => { const index = (pixel.y * width + pixel.x) * 4; const r = data[index]; const g = data[index + 1]; const b = data[index + 2]; const hsv = _0x2c3d(r, g, b); return (hsv.h >= 0 && hsv.h <= 150) && (hsv.s >= 20) && (hsv.v >= 15); }); } function _0x6a7b(imageData, region) { const analysis = {}; const data = imageData.data; const width = imageData.width; const totalPixels = region ? region.length : imageData.width * imageData.height; Object.keys(_0x8c9d).forEach(settingName => { const setting = _0x8c9d[settingName]; const matchingPixels = []; const hsvValues = []; if (region) { region.forEach(pixel => { const index = (pixel.y * width + pixel.x) * 4; const r = data[index]; const g = data[index + 1]; const b = data[index + 2]; const hsv = _0x2c3d(r, g, b); if (matchesColorSetting(hsv, setting)) { matchingPixels.push(pixel); hsvValues.push(hsv); } }); } analysis[settingName] = { pixelCount: matchingPixels.length, areaPercentage: totalPixels > 0 ? (matchingPixels.length / totalPixels) * 100 : 0, actualHSV: calculateAverageHSV(hsvValues) }; }); return analysis; } function matchesColorSetting(hsv, setting) { const h = hsv.h; const s = hsv.s; const v = hsv.v; const hueInRange = (h >= setting.hue.min && h <= setting.hue.max); const satOk = s >= setting.saturation.min; const brightOk = (!setting.brightness.max || (v >= setting.brightness.min && v <= setting.brightness.max)); return hueInRange && satOk && brightOk; } function calculateAverageHSV(hsvValues) { if (!hsvValues || hsvValues.length === 0) return null; const sum = hsvValues.reduce((acc, hsv) => { acc.h += hsv.h; acc.s += hsv.s; acc.v += hsv.v; return acc; }, { h: 0, s: 0, v: 0 }); return { hue: Math.round(sum.h / hsvValues.length), saturation: Math.round(sum.s / hsvValues.length), brightness: Math.round(sum.v / hsvValues.length) }; } function determineFinalColorLevel(detailedAnalysis) { const sortedRules = Object.values(_0xaebf).sort((a, b) => b.priority - a.priority); for (const rule of sortedRules) { let allConditionsMet = true; const conditionResults = []; for (const condition of rule.conditions) { const colorType = condition.colorSetting; const actualPercentage = detailedAnalysis[colorType]?.areaPercentage || 0; let conditionMet = false; switch (condition.operator) { case '>=': conditionMet = actualPercentage >= condition.threshold; break; case '>': conditionMet = actualPercentage > condition.threshold; break; case '<=': conditionMet = actualPercentage <= condition.threshold; break; case '<': conditionMet = actualPercentage < condition.threshold; break; case '==': case '=': conditionMet = actualPercentage === condition.threshold; break; case 'range': conditionMet = actualPercentage >= (condition.min || 0) && actualPercentage <= (condition.max || 100); break; } conditionResults.push({ colorType: colorType, actualPercentage: actualPercentage, operator: condition.operator, threshold: condition.threshold, min: condition.min, max: condition.max, met: conditionMet }); if (!conditionMet) { allConditionsMet = false; break; } } if (allConditionsMet) { console.log(`üéØ Âà§ÂÆöÊù°‰ª∂ÂêàËá¥: „Ç´„É©„Éº${rule.level} (${rule.name})`, conditionResults); return rule.level; } } return 6; } function displayAnalysisResult() { const card = document.getElementById('resultCard'); const content = document.getElementById('resultContent'); if (!card || !content || !AppState.analysisResult) return; const result = AppState.analysisResult; const detectedColor = ColorData.find(c => c.level === result.detectedLevel); const selectedColor = ColorData.find(c => c.level === AppState.visualJudgment); const detectedColorName = detectedColor ? (detectedColor.name || `„Ç´„É©„Éº${result.detectedLevel}`) : `„Ç´„É©„Éº${result.detectedLevel}`; const selectedColorName = selectedColor ? (selectedColor.name || `„Ç´„É©„Éº${AppState.visualJudgment}`) : `„Ç´„É©„Éº${AppState.visualJudgment}`; const isMatch = result.detectedLevel === AppState.visualJudgment; let html = ` <div class="result-summary"> <div class="result-item"> <span class="label">ü§ñ Ëá™ÂãïËß£Êûê:</span> <span class="value">${detectedColorName}</span> </div> <div class="result-item"> <span class="label">üëÅÔ∏è ÁõÆË¶ñÂà§ÂÆö:</span> <span class="value">${selectedColorName}</span> </div> ${result.bananaRegionDetected ? ` <div class="result-item"> <span class="label">üçå „Éê„Éä„ÉäÈ†òÂüü:</span> <span class="value">Ê§úÂá∫Ê∏à„Åø (${result.bananaPixels.toLocaleString()}px)</span> </div>` : ''} <div class="result-match ${isMatch ? 'match' : 'mismatch'}"> ${isMatch ? '‚úÖ ‰∏ÄËá¥' : '‚ùå ‰∏ç‰∏ÄËá¥'} </div> </div> `; content.innerHTML = html; card.classList.remove('hidden'); } function enableExportButtons() { document.getElementById('exportBtn').disabled = false; document.getElementById('emailBtn').disabled = false; } function initializeFormElements() { updateChainOptions(); updateProductOptions(); updateClaimTypeOptions(); updateCodeLabels(); const chainSelect = document.getElementById('chainName'); if (chainSelect) { chainSelect.addEventListener('change', updateStoreOptions); } } function updateChainOptions() { const select = document.getElementById('chainName'); if (!select) return; select.innerHTML = '<option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>'; const chains = MasterData ? MasterData.chains : Object.keys(AppState.storeData); chains.forEach(chain => { const option = document.createElement('option'); option.value = chain; option.textContent = chain; select.appendChild(option); }); } function updateStoreOptions() { const chainSelect = document.getElementById('chainName'); const storeSelect = document.getElementById('storeName'); if (!chainSelect || !storeSelect) return; const selectedChain = chainSelect.value; storeSelect.innerHTML = '<option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>'; if (selectedChain && AppState.storeData[selectedChain]) { AppState.storeData[selectedChain].forEach(store => { const option = document.createElement('option'); option.value = store; option.textContent = store; storeSelect.appendChild(option); }); } } function updateProductOptions() { const select = document.getElementById('productName'); if (!select) return; select.innerHTML = '<option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>'; const products = MasterData ? MasterData.products : AppState.productData; products.forEach(product => { const option = document.createElement('option'); option.value = product; option.textContent = product; select.appendChild(option); }); } function updateClaimTypeOptions() { const select = document.getElementById('claimType'); if (!select) return; select.innerHTML = '<option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>'; const claimTypes = MasterData ? MasterData.claimTypes : AppState.claimTypeData; claimTypes.forEach(type => { const option = document.createElement('option'); option.value = type; option.textContent = type; select.appendChild(option); }); } function updateCodeLabels() { ['code1Label', 'code2Label', 'code3Label'].forEach((labelId, index) => { const label = document.getElementById(labelId); if (label) { const codeKey = `code${index + 1}`; label.textContent = AppState.codeNames[codeKey] || `„Ç≥„Éº„Éâ${index + 1}`; } }); } function setupDateLimits() { const today = new Date().toISOString().split('T')[0]; const deliveryDate = document.getElementById('deliveryDate'); const captureDate = document.getElementById('captureDate'); if (deliveryDate) { deliveryDate.max = today; deliveryDate.value = today; } if (captureDate) { captureDate.max = today; captureDate.value = today; } } function exportAnalysisResultCSV() { if (!AppState.analysisResult) { showError('Ëß£Êûê„ÇíÂÆüË°å„Åó„Å¶„Åã„ÇâCSVÂá∫Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } try { const now = new Date(); const timestamp = now.toISOString().replace(/[:.]/g, '-'); const formData = { '„ÉÅ„Çß„Éº„É≥Âêç': document.getElementById('chainName')?.value || '', 'Â∫óËàóÂêç': document.getElementById('storeName')?.value || '', 'ÂïÜÂìÅÂêç': document.getElementById('productName')?.value || '', '„ÇØ„É¨„Éº„É†Á®ÆÂà•': document.getElementById('claimType')?.value || '', 'Á¥çÂìÅÊó•': document.getElementById('deliveryDate')?.value || '', 'ÊíÆÂΩ±Êó•': document.getElementById('captureDate')?.value || '', '„Ç≥„É°„É≥„Éà': document.getElementById('commentText')?.value || '', [AppState.codeNames.code1]: document.getElementById('code1')?.value || '', [AppState.codeNames.code2]: document.getElementById('code2')?.value || '', [AppState.codeNames.code3]: document.getElementById('code3')?.value || '' }; const basicInfo = { 'Ëß£ÊûêÊó•ÊôÇ': now.toLocaleString('ja-JP'), 'Á∑è„Éî„ÇØ„Çª„É´Êï∞': AppState.analysisResult.totalPixels || 0, 'ÁõÆË¶ñÈÅ∏Êäû„Ç´„É©„Éº': `„Ç´„É©„Éº${AppState.visualJudgment}`, 'Ëá™ÂãïËß£Êûê„Ç´„É©„Éº': `„Ç´„É©„Éº${AppState.analysisResult.detectedLevel}`, '‰∏ÄËá¥È†ÖÁõÆ': AppState.analysisResult.detectedLevel === AppState.visualJudgment ? '‰∏ÄËá¥' : '‰∏ç‰∏ÄËá¥' }; const headers = []; const values = []; Object.entries(basicInfo).forEach(([key, value]) => { headers.push(key); values.push(value); }); Object.entries(formData).forEach(([key, value]) => { headers.push(key); values.push(value); }); if (AppState.detailedAnalysis) { const colorSettings = ['Á∑ëÁ≥ª', 'ÈªÑÁ∑ëÁ≥ª', 'ÈªÑËâ≤Á≥ª', 'ÊñëÁÇπÁ≥ª', 'Ë§êËâ≤Á≥ª']; colorSettings.forEach(settingName => { const analysis = AppState.detailedAnalysis[settingName]; if (analysis) { headers.push(`${settingName}_Èù¢Á©çÂâ≤Âêà(%)`); values.push(analysis.areaPercentage.toFixed(2)); headers.push(`${settingName}_„Éî„ÇØ„Çª„É´Êï∞`); values.push(analysis.pixelCount); if (analysis.actualHSV) { headers.push(`${settingName}_ÂÆüÈöõËâ≤Áõ∏(H)`); values.push(analysis.actualHSV.hue); headers.push(`${settingName}_ÂÆüÈöõÂΩ©Â∫¶(S)`); values.push(analysis.actualHSV.saturation); headers.push(`${settingName}_ÂÆüÈöõÊòéÂ∫¶(V)`); values.push(analysis.actualHSV.brightness); } else { headers.push(`${settingName}_ÂÆüÈöõËâ≤Áõ∏(H)`); values.push(''); headers.push(`${settingName}_ÂÆüÈöõÂΩ©Â∫¶(S)`); values.push(''); headers.push(`${settingName}_ÂÆüÈöõÊòéÂ∫¶(V)`); values.push(''); } const colorSetting = _0x8c9d[settingName]; if (colorSetting) { headers.push(`${settingName}_Ë®≠ÂÆöËâ≤Áõ∏ÁØÑÂõ≤`); values.push(`${colorSetting.hue.min}-${colorSetting.hue.max}`); headers.push(`${settingName}_Ë®≠ÂÆöÂΩ©Â∫¶ÊúÄÂ∞è`); values.push(colorSetting.saturation.min); headers.push(`${settingName}_Ë®≠ÂÆöÊòéÂ∫¶ÁØÑÂõ≤`); values.push(`${colorSetting.brightness.min}-${colorSetting.brightness.max}`); } } }); } const escapeCSV = (val) => { if (typeof val === 'string' && (val.includes(',') || val.includes('"') || val.includes('\n'))) { return `"${val.replace(/"/g, '""')}"`; } return val; }; const csvData = []; csvData.push(headers.join(',')); csvData.push(values.join(',')); const csvContent = '\uFEFF' + csvData.join('\n'); const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href = url; link.download = `banana_analysis_${timestamp}_${formData['„ÉÅ„Çß„Éº„É≥Âêç']}_${formData['Â∫óËàóÂêç']}_„Ç´„É©„Éº${AppState.analysisResult.detectedLevel}.csv`; link.click(); URL.revokeObjectURL(url); showSuccessMessage('‚úÖ Ëß£ÊûêÁµêÊûú„ÇíCSV„Åß„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü'); } catch (error) { console.error('CSVÂá∫Âäõ„Ç®„É©„Éº:', error); showError('‚ùå CSVÂá∫Âäõ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'); } } function sendEmail() { if (!AppState.analysisResult) { showError('Ëß£Êûê„ÇíÂÆüË°å„Åó„Å¶„Åã„Çâ„É°„Éº„É´ÈÄÅ‰ø°„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } const chainName = document.getElementById('chainName')?.value || ''; const storeName = document.getElementById('storeName')?.value || ''; const subject = `„Éê„Éä„ÉäÂìÅË≥™„É¨„Éù„Éº„Éà_${chainName}_${storeName}_${new Date().toISOString().slice(0, 10)}`; const body = `„Éê„Éä„ÉäÂìÅË≥™„É¨„Éù„Éº„Éà „ÄêÂü∫Êú¨ÊÉÖÂ†±„Äë „ÉÅ„Çß„Éº„É≥Âêç: ${chainName} Â∫óËàóÂêç: ${storeName} Ëß£ÊûêÊó•ÊôÇ: ${new Date().toLocaleString()} „ÄêËß£ÊûêÁµêÊûú„Äë ÁõÆË¶ñÈÅ∏Êäû: „Ç´„É©„Éº${AppState.visualJudgment} Ëá™ÂãïËß£Êûê: „Ç´„É©„Éº${AppState.analysisResult.detectedLevel} Âà§ÂÆöÁµêÊûú: ${AppState.analysisResult.detectedLevel === AppState.visualJudgment ? '‰∏ÄËá¥' : '‰∏ç‰∏ÄËá¥'} „Éê„Éä„ÉäÈ†òÂüüÊ§úÂá∫: ${AppState.analysisResult.bananaRegionDetected ? '„ÅÇ„Çä' : '„Å™„Åó'} ‚ÄªCSV„Éï„Ç°„Ç§„É´„Å®ÁîªÂÉè„ÇíÊ∑ª‰ªò„Åó„Å¶„Åè„Å†„Åï„ÅÑ`; const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`; window.location.href = mailtoLink; } function resetForm() { if (confirm('ÂÖ•ÂäõÂÜÖÂÆπ„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü\nÂÖ•ÂäõÂÜÖÂÆπ„Åå„Åô„Åπ„Å¶ÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ')) { AppState.currentImage = null; AppState.imageData = null; AppState.bananaRegion = null; AppState.visualJudgment = null; AppState.analysisResult = null; document.getElementById('imagePreview').innerHTML = '<div class="image-placeholder">ÁîªÂÉè„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>'; document.getElementById('selectedColorText').textContent = 'Êú™ÈÅ∏Êäû'; document.getElementById('resultCard').classList.add('hidden'); document.getElementById('bananaRegionPreview').classList.add('hidden'); ['chainName', 'storeName', 'productName', 'claimType', 'commentText', 'code1', 'code2', 'code3'].forEach(id => { const element = document.getElementById(id); if (element) element.value = ''; }); const today = new Date().toISOString().split('T')[0]; document.getElementById('deliveryDate').value = today; document.getElementById('captureDate').value = today; document.querySelectorAll('.color-item').forEach(item => { item.classList.remove('selected'); }); updateAnalyzeButton(); document.getElementById('exportBtn').disabled = true; document.getElementById('emailBtn').disabled = true; } } function showError(message) { const errorEl = document.getElementById('loginError'); if (errorEl) { errorEl.textContent = message; errorEl.classList.remove('hidden'); setTimeout(() => errorEl.classList.add('hidden'), 5000); } else { alert(message); } } function showSuccessMessage(message) { console.log(message); } function setupEventListeners() { document.getElementById('loginBtn')?.addEventListener('click', _0xe3f4); document.getElementById('userId')?.addEventListener('keypress', (e) => { if (e.key === 'Enter') _0xe3f4(); }); document.getElementById('password')?.addEventListener('keypress', (e) => { if (e.key === 'Enter') _0xe3f4(); }); document.getElementById('logoutBtn')?.addEventListener('click', handleLogout); document.getElementById('cameraBtn')?.addEventListener('click', () => { const input = document.getElementById('cameraInput'); if (input) { if (isMobileDevice()) { input.setAttribute('capture', 'environment'); } input.click(); } }); document.getElementById('fileBtn')?.addEventListener('click', () => { document.getElementById('fileInput')?.click(); }); document.getElementById('cameraInput')?.addEventListener('change', handleImageSelect); document.getElementById('fileInput')?.addEventListener('change', handleImageSelect); document.getElementById('analyzeBtn')?.addEventListener('click', handleAnalyze); document.getElementById('exportBtn')?.addEventListener('click', exportAnalysisResultCSV); document.getElementById('emailBtn')?.addEventListener('click', sendEmail); document.getElementById('resetBtn')?.addEventListener('click', resetForm); document.getElementById('settingsBtn')?.addEventListener('click', showSettings); } const MasterData = { chains: ['A„ÉÅ„Çß„Éº„É≥', 'B„Çπ„Éà„Ç¢', 'C„Éû„Éº„Ç±„ÉÉ„Éà'], stores: { 'A„ÉÅ„Çß„Éº„É≥': ['Êú¨Â∫ó', 'ÊîØÂ∫ó1', 'ÊîØÂ∫ó2'], 'B„Çπ„Éà„Ç¢': ['‰∏ñÁî∞Ë∞∑Â∫ó', 'Ê∏ãË∞∑Â∫ó', 'Êñ∞ÂÆøÂ∫ó'], 'C„Éû„Éº„Ç±„ÉÉ„Éà': ['Â∫ú‰∏≠Â∫ó', 'Ë™øÂ∏ÉÂ∫ó', 'ÂõΩÂàÜÂØ∫Â∫ó'] }, products: ['„Éï„Ç£„É™„Éî„É≥Áî£„Éê„Éä„Éä', '„Ç®„ÇØ„Ç¢„Éâ„É´Áî£„Éê„Éä„Éä'], claimTypes: ['„Åù„ÅÆ‰ªñ', 'ÈÅéÁÜü', 'Êú™ÁÜü', '„Åä„Åï„Çå„ÉªÂÇ∑', '„Åç„Å∂„Åè', '„ÅÇ„Åä„Å∂„Åè', 'ËÖê„Çå'] }; function showSettings() { const colorSettings = document.getElementById('colorAnalysisSettings'); if (colorSettings.classList.contains('hidden')) { colorSettings.classList.remove('hidden'); initializeMasterData(); updateColorSettingsCards(); const judgmentRulesSection = document.getElementById('judgmentRulesSection'); if (judgmentRulesSection) { judgmentRulesSection.style.display = 'block'; console.log('‚úÖ Âà§ÂÆö„É´„Éº„É´„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫Áä∂ÊÖã„Å´Ë®≠ÂÆö'); } loadMasterDataFromStorage(); console.log('üîÑ Ë®≠ÂÆöÁîªÈù¢Ë°®Á§∫ÊôÇ„Å´updateJudgmentRulesCards„ÇíÂÆüË°å'); console.log('üìã ÁèæÂú®„ÅÆ_0xaebf:', Object.keys(_0xaebf)); updateJudgmentRulesCards(); setTimeout(() => { updateJudgmentRulesCards(); }, 100); colorSettings.scrollIntoView({ behavior: 'smooth' }); } else { colorSettings.classList.add('hidden'); } console.log('„Ç´„É©„ÉºÂà§ÂÆö„Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆöÁîªÈù¢„ÇíË°®Á§∫„Åó„Åæ„Åó„Åü'); } function hideSettings() { const colorSettings = document.getElementById('colorAnalysisSettings'); if (colorSettings) { colorSettings.classList.add('hidden'); } console.log('„Ç´„É©„ÉºË®≠ÂÆöÁîªÈù¢„ÇíÈùûË°®Á§∫„Å´„Åó„Åæ„Åó„Åü'); } function toggleMasterDataSection() { toggleSection('masterDataSection', 'masterDataToggle'); } function toggleColorSettingsSection() { toggleSection('colorSettingsSection', 'colorSettingsToggle'); } function toggleJudgmentRulesSection() { toggleSection('judgmentRulesSection', 'judgmentRulesToggle'); } function toggleSection(sectionId, toggleId) { const section = document.getElementById(sectionId); const toggle = document.getElementById(toggleId); if (section.style.display === 'none') { section.style.display = 'block'; toggle.textContent = '‚ñº'; } else { section.style.display = 'none'; toggle.textContent = '‚ñ∂'; } } function initializeMasterData() { updateChainTags(); updateChainSelect(); updateStoresByChain(); updateProductTags(); updateClaimTypeTags(); } function updateChainTags() { const container = document.getElementById('chainTags'); container.innerHTML = ''; MasterData.chains.forEach(chain => { const tag = createTag(chain, 'chain', () => removeChainName(chain)); container.appendChild(tag); }); } function updateChainSelect() { const select = document.getElementById('chainSelect'); select.innerHTML = '<option value="">„ÉÅ„Çß„Éº„É≥„ÇíÈÅ∏Êäû</option>'; MasterData.chains.forEach(chain => { const option = document.createElement('option'); option.value = chain; option.textContent = chain; select.appendChild(option); }); } function updateStoresByChain() { const container = document.getElementById('storesByChain'); container.innerHTML = ''; Object.entries(MasterData.stores).forEach(([chain, stores]) => { const chainDiv = document.createElement('div'); chainDiv.style.marginBottom = '15px'; const title = document.createElement('h6'); title.textContent = chain; title.style.color = '#FF9800'; title.style.marginBottom = '8px'; chainDiv.appendChild(title); const tagContainer = document.createElement('div'); tagContainer.className = 'tag-container'; stores.forEach(store => { const tag = createTag(store, 'store', () => removeStoreName(chain, store)); tagContainer.appendChild(tag); }); chainDiv.appendChild(tagContainer); container.appendChild(chainDiv); }); } function updateProductTags() { const container = document.getElementById('productTags'); container.innerHTML = ''; MasterData.products.forEach(product => { const tag = createTag(product, 'product', () => removeProductName(product)); container.appendChild(tag); }); } function updateClaimTypeTags() { const container = document.getElementById('claimTypeTags'); container.innerHTML = ''; MasterData.claimTypes.forEach(claimType => { const tag = createTag(claimType, 'claim', () => removeClaimType(claimType)); container.appendChild(tag); }); } function createTag(text, type, onRemove) { const tag = document.createElement('div'); tag.className = `tag ${type}`; tag.innerHTML = `${text} <button class="remove-btn" onclick="event.preventDefault(); (${onRemove.toString()})();">√ó</button>`; return tag; } function addChainName() { const input = document.getElementById('newChainName'); const name = input.value.trim(); if (name && !MasterData.chains.includes(name)) { MasterData.chains.push(name); MasterData.stores[name] = []; updateChainTags(); updateChainSelect(); updateStoresByChain(); input.value = ''; showSuccessMessage(`„ÉÅ„Çß„Éº„É≥„Äå${name}„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`); } } function addStoreName() { const chainSelect = document.getElementById('chainSelect'); const input = document.getElementById('newStoreName'); const chain = chainSelect.value; const store = input.value.trim(); if (chain && store && !MasterData.stores[chain].includes(store)) { MasterData.stores[chain].push(store); updateStoresByChain(); input.value = ''; showSuccessMessage(`Â∫óËàó„Äå${store}„Äç„Çí${chain}„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`); } } function addProductName() { const input = document.getElementById('newProductName'); const name = input.value.trim(); if (name && !MasterData.products.includes(name)) { MasterData.products.push(name); updateProductTags(); updateProductOptions(); input.value = ''; showSuccessMessage(`ÂïÜÂìÅ„Äå${name}„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`); } } function addClaimType() { const input = document.getElementById('newClaimType'); const name = input.value.trim(); if (name && !MasterData.claimTypes.includes(name)) { MasterData.claimTypes.push(name); updateClaimTypeTags(); input.value = ''; showSuccessMessage(`„ÇØ„É¨„Éº„É†Á®ÆÂà•„Äå${name}„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`); } } function removeChainName(name) { const index = MasterData.chains.indexOf(name); if (index > -1) { MasterData.chains.splice(index, 1); delete MasterData.stores[name]; updateChainTags(); updateChainSelect(); updateStoresByChain(); showSuccessMessage(`„ÉÅ„Çß„Éº„É≥„Äå${name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`); } } function removeStoreName(chain, store) { const stores = MasterData.stores[chain]; if (stores) { const index = stores.indexOf(store); if (index > -1) { stores.splice(index, 1); updateStoresByChain(); showSuccessMessage(`Â∫óËàó„Äå${store}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`); } } } function removeProductName(name) { const index = MasterData.products.indexOf(name); if (index > -1) { MasterData.products.splice(index, 1); updateProductTags(); updateProductOptions(); showSuccessMessage(`ÂïÜÂìÅ„Äå${name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`); } } function removeClaimType(name) { const index = MasterData.claimTypes.indexOf(name); if (index > -1) { MasterData.claimTypes.splice(index, 1); updateClaimTypeTags(); showSuccessMessage(`„ÇØ„É¨„Éº„É†Á®ÆÂà•„Äå${name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`); } } function updateColorSettingsCards() { const container = document.getElementById('colorSettingsCards'); if (!container) return; const colorClasses = ['green', 'yellow-green', 'yellow', 'orange', 'brown']; let html = ''; Object.entries(_0x8c9d).forEach(([name, setting], index) => { const colorClass = colorClasses[index] || 'green'; html += ` <div class="color-settings-card ${colorClass}"> <div class="color-info"> <h6>${name}</h6> <div class="hsv-info"> Ëâ≤Áõ∏: ${setting.hue.min}¬∞ÔΩû${setting.hue.max}¬∞ | ÂΩ©Â∫¶: ${setting.saturation.min}%‰ª•‰∏ä | ÊòéÂ∫¶: ${setting.brightness.min}ÔΩû${setting.brightness.max}% </div> </div> <button class="btn btn-secondary" onclick="editColorSetting('${name}')"> üîß Á∑®ÈõÜ </button> </div> `; }); container.innerHTML = html; } function updateJudgmentRulesCards() { console.log('üîÑ updateJudgmentRulesCards ÈñãÂßã'); const container = document.getElementById('judgmentRulesCards'); if (!container) { console.error('‚ùå judgmentRulesCards „Ç≥„É≥„ÉÜ„Éä„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'); return; } console.log('üìã _0xaebf:', _0xaebf); let html = ''; const sortedRules = Object.values(_0xaebf).sort((a, b) => a.priority - b.priority); const levelSortedRules = Object.values(_0xaebf).sort((a, b) => a.level - b.level); console.log('üìä Ë°®Á§∫‰∫àÂÆö„É´„Éº„É´Êï∞:', levelSortedRules.length); levelSortedRules.forEach(rule => { console.log('üé® „Ç´„Éº„ÉâÁîüÊàê:', rule.name, 'conditions:', rule.conditions); let conditionText = ''; if (rule.conditions && rule.conditions.length > 0) { const conditionTexts = rule.conditions.map(condition => { if (condition.operator === 'range') { return `${condition.colorSetting} ${condition.min}%„Äú${condition.max}%`; } else { return `${condition.colorSetting} ${condition.operator} ${condition.threshold}%`; } }); conditionText = conditionTexts.join('<br> „Åã„Å§<br>'); } else { conditionText = 'Êù°‰ª∂Êú™Ë®≠ÂÆö'; } let nameColor = '#4CAF50'; if (rule.name.includes('„É©„Ç§„Éà„Ç∞„É™„Éº„É≥')) { nameColor = '#8BC34A'; } else if (rule.name.includes('„Éè„Éº„Éï„Ç∞„É™„Éº„É≥')) { nameColor = '#9CCC65'; } else if (rule.name.includes('„Ç∞„É™„Éº„É≥„ÉÅ„ÉÉ„Éó')) { nameColor = '#CDDC39'; } else if (rule.name.includes('„Éï„É´„Ç§„Ç®„É≠„Éº')) { nameColor = '#FFEB3B'; } else if (rule.name.includes('„Çπ„Çø„Éº')) { nameColor = '#FFC107'; } else if (rule.level == 8) { nameColor = '#FF9800'; } else if (rule.level == 9) { nameColor = '#795548'; } html += ` <div style="background: white; border-radius: 8px; padding: 20px; margin-bottom: 15px; border-left: 4px solid ${nameColor}; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center;"> <div style="flex: 1;"> <h6 style="color: ${nameColor}; font-size: 18px; margin-bottom: 5px; font-weight: bold;"> ${rule.name} („Ç´„É©„Éº${rule.level}) </h6> <div style="color: #666; font-size: 12px; margin-bottom: 8px;"> ÂÑ™ÂÖàÂ∫¶: ${rule.priority} </div> <div style="color: #333; font-weight: bold; margin-bottom: 3px;"> Âà§ÂÆöÊù°‰ª∂: </div> <div style="margin-left: 20px; color: #555;"> ${conditionText} </div> </div> <button onclick="editJudgmentRule(${rule.level})" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; min-width: 80px; display: flex; align-items: center; justify-content: center; gap: 5px;"> üîß Á∑®ÈõÜ </button> </div> `; }); console.log('‚úÖ ÁîüÊàê„Åï„Çå„ÅüHTMLÈï∑:', html.length); console.log('üé® HTMLÂÜÖÂÆπ (ÊúÄÂàù„ÅÆ500ÊñáÂ≠ó):', html.substring(0, 500)); container.innerHTML = html; console.log('‚úÖ updateJudgmentRulesCards ÂÆå‰∫Ü'); } function exportColorSettingsCSV() { console.log('üì§ Ëâ≤Ë®≠ÂÆöCSV„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÈñãÂßã'); const headers = ['Ë®≠ÂÆöÂêç', 'Ëâ≤Áõ∏ÊúÄÂ∞è', 'Ëâ≤Áõ∏ÊúÄÂ§ß', 'ÂΩ©Â∫¶ÊúÄÂ∞è', 'ÊòéÂ∫¶ÊúÄÂ∞è', 'ÊòéÂ∫¶ÊúÄÂ§ß']; const csvData = [headers.join(',')]; Object.entries(_0x8c9d).forEach(([settingName, setting]) => { const row = [ settingName, setting.hue.min, setting.hue.max, setting.saturation.min, setting.brightness.min, setting.brightness.max ]; csvData.push(row.join(',')); }); console.log('üìã CSV„Éá„Éº„Çø:', csvData); const csvContent = '\uFEFF' + csvData.join('\n'); const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href = url; link.download = `banana_color_settings_${new Date().toISOString().slice(0, 10)}.csv`; console.log('üíæ CSV„Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÈñãÂßã:', link.download); link.click(); URL.revokeObjectURL(url); showSuccessMessage('‚úÖ Ëâ≤Ë®≠ÂÆö„ÇíCSV„Åß„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü'); console.log('‚úÖ Ëâ≤Ë®≠ÂÆöCSV„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÂÆå‰∫Ü'); } function exportJudgmentRulesCSV() { console.log('üì§ Âà§ÂÆö„É´„Éº„É´CSV„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÈñãÂßã'); const headers = ['„Ç´„É©„Éº', '„Ç´„É©„ÉºÂêç', 'ÂÑ™ÂÖàÂ∫¶', 'Ëâ≤Ë®≠ÂÆö', 'ÊºîÁÆóÂ≠ê', 'ÈñæÂÄ§', 'ÁØÑÂõ≤ÊúÄÂ∞è', 'ÁØÑÂõ≤ÊúÄÂ§ß']; const csvData = [headers.join(',')]; Object.values(_0xaebf) .sort((a, b) => a.level - b.level) .forEach(rule => { console.log('üìã CSV„É´„Éº„É´Âá¶ÁêÜ:', rule.name, 'conditions:', rule.conditions); const conditions = rule.conditions || []; if (conditions.length === 0) { csvData.push([ `„Ç´„É©„Éº${rule.level}`, rule.name, rule.priority.toString(), 'Êù°‰ª∂Êú™Ë®≠ÂÆö', '', '', '', '' ].join(',')); } else { conditions.forEach((condition, index) => { const row = [ `„Ç´„É©„Éº${rule.level}`, index === 0 ? rule.name : '', index === 0 ? rule.priority.toString() : '', condition.colorSetting, condition.operator, condition.threshold || '', condition.min || '', condition.max || '' ]; csvData.push(row.join(',')); }); } }); const csvContent = '\uFEFF' + csvData.join('\n'); const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href = url; link.download = `banana_judgment_rules_${new Date().toISOString().slice(0, 10)}.csv`; link.click(); URL.revokeObjectURL(url); showSuccessMessage('‚úÖ Âà§ÂÆö„É´„Éº„É´„ÇíCSV„Åß„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü'); } function saveMasterData() { try { console.log('üì§ „Éû„Çπ„Çø„Éá„Éº„Çø‰øùÂ≠òÈñãÂßã:', MasterData); localStorage.setItem('bananaReporter_masterData', JSON.stringify(MasterData)); AppState.storeData = { ...MasterData.stores }; AppState.productData = [...MasterData.products]; AppState.claimTypeData = [...MasterData.claimTypes]; console.log('üìù AppStateÊõ¥Êñ∞ÂÆå‰∫Ü:', { stores: AppState.storeData, products: AppState.productData, claimTypes: AppState.claimTypeData }); updateChainOptions(); updateProductOptions(); updateClaimTypeOptions(); console.log('‚úÖ ÈÅ∏ÊäûËÇ¢Êõ¥Êñ∞ÂÆå‰∫Ü'); showSuccessMessage('üíæ „Éû„Çπ„Çø„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„ÄÅÈÅ∏ÊäûËÇ¢„Å´ÂèçÊò†„Åó„Åæ„Åó„Åü'); console.log('üîç ‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„ÇøÁ¢∫Ë™ç:', localStorage.getItem('bananaReporter_masterData')); } catch (error) { console.error('‚ùå „Éû„Çπ„Çø„Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº:', error); showError('„Éû„Çπ„Çø„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message); } } function resetMasterDataToDefault() { if (confirm('„Éû„Çπ„Çø„Éá„Éº„Çø„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åô„ÅãÔºü')) { MasterData.chains = ['A„ÉÅ„Çß„Éº„É≥', 'B„Çπ„Éà„Ç¢', 'C„Éû„Éº„Ç±„ÉÉ„Éà']; MasterData.stores = { 'A„ÉÅ„Çß„Éº„É≥': ['Êú¨Â∫ó', 'ÊîØÂ∫ó1', 'ÊîØÂ∫ó2'], 'B„Çπ„Éà„Ç¢': ['‰∏ñÁî∞Ë∞∑Â∫ó', 'Ê∏ãË∞∑Â∫ó', 'Êñ∞ÂÆøÂ∫ó'], 'C„Éû„Éº„Ç±„ÉÉ„Éà': ['Â∫ú‰∏≠Â∫ó', 'Ë™øÂ∏ÉÂ∫ó', 'ÂõΩÂàÜÂØ∫Â∫ó'] }; MasterData.products = ['„Éï„Ç£„É™„Éî„É≥Áî£„Éê„Éä„Éä', '„Ç®„ÇØ„Ç¢„Éâ„É´Áî£„Éê„Éä„Éä']; MasterData.claimTypes = ['„Åù„ÅÆ‰ªñ', 'ÈÅéÁÜü', 'Êú™ÁÜü', '„Åä„Åï„Çå„ÉªÂÇ∑', '„Åç„Å∂„Åè', '„ÅÇ„Åä„Å∂„Åè', 'ËÖê„Çå']; initializeMasterData(); showSuccessMessage('‚úÖ „Éû„Çπ„Çø„Éá„Éº„Çø„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åó„Åü'); } } function saveColorSettings() { localStorage.setItem('bananaReporter_colorSettings', JSON.stringify(_0x8c9d)); showSuccessMessage('üíæ Ëâ≤Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü'); } function saveJudgmentRules() { try { localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); console.log('üìù ÂÖ®Âà§ÂÆö„É´„Éº„É´‰øùÂ≠òÂÆå‰∫Ü:', _0xaebf); showSuccessMessage('üíæ Âà§ÂÆö„É´„Éº„É´„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü'); } catch (error) { console.error('Âà§ÂÆö„É´„Éº„É´‰øùÂ≠ò„Ç®„É©„Éº:', error); showError('Âà§ÂÆö„É´„Éº„É´„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'); } } function editColorSetting(name) { const setting = _0x8c9d[name]; if (!setting) return; const colorEditModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="colorSettingModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%;"> <h3 style="margin-bottom: 20px; color: ${setting.color};">${name} „ÅÆË®≠ÂÆöÁ∑®ÈõÜ</h3> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">Ëâ≤Áõ∏ÁØÑÂõ≤ÔºàHÔºâ:</label> <div style="margin-top: 5px;"> <input type="number" id="hueMin" value="${setting.hue.min}" min="0" max="360" style="width: 80px; padding: 4px;"> ¬∞„Äú <input type="number" id="hueMax" value="${setting.hue.max}" min="0" max="360" style="width: 80px; padding: 4px; margin-left: 5px;"> ¬∞ </div> </div> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">ÂΩ©Â∫¶ÊúÄÂ∞èÔºàSÔºâ:</label> <div style="margin-top: 5px;"> <input type="number" id="satMin" value="${setting.saturation.min}" min="0" max="100" style="width: 80px; padding: 4px;"> %‰ª•‰∏ä </div> </div> <div style="margin-bottom: 20px;"> <label style="font-weight: bold;">ÊòéÂ∫¶ÁØÑÂõ≤ÔºàVÔºâ:</label> <div style="margin-top: 5px;"> <input type="number" id="brightMin" value="${setting.brightness.min}" min="0" max="100" style="width: 80px; padding: 4px;"> %„Äú <input type="number" id="brightMax" value="${setting.brightness.max}" min="0" max="100" style="width: 80px; padding: 4px; margin-left: 5px;"> % </div> </div> <div style="text-align: right;"> <button onclick="closeColorModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px;">„Ç≠„É£„É≥„Çª„É´</button> <button onclick="saveColorSetting('${name}')" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px;">‰øùÂ≠ò</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', colorEditModalHtml); } function closeColorModal() { const modal = document.getElementById('colorSettingModal'); if (modal) { modal.remove(); } } function closeColorSettingModal() { const modal = document.getElementById('colorSettingModal'); if (modal) { modal.remove(); } } function saveColorSettingChanges(colorType) { const hueMin = parseInt(document.getElementById('hueMin').value); const hueMax = parseInt(document.getElementById('hueMax').value); const satMin = parseInt(document.getElementById('satMin').value); const lightMin = parseInt(document.getElementById('lightMin').value); const lightMax = parseInt(document.getElementById('lightMax').value); if (hueMin < 0 || hueMin > 360 || hueMax < 0 || hueMax > 360 || hueMin > hueMax) { alert('Ëâ≤Áõ∏„ÅÆÁØÑÂõ≤„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà0-360Â∫¶„ÄÅÊúÄÂ∞èÂÄ§ ‚â§ ÊúÄÂ§ßÂÄ§Ôºâ'); return; } if (satMin < 0 || satMin > 100) { alert('ÂΩ©Â∫¶ÊúÄÂ∞èÂÄ§„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà0-100%Ôºâ'); return; } if (lightMin < 0 || lightMin > 100 || lightMax < 0 || lightMax > 100 || lightMin > lightMax) { alert('ÊòéÂ∫¶„ÅÆÁØÑÂõ≤„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà0-100%„ÄÅÊúÄÂ∞èÂÄ§ ‚â§ ÊúÄÂ§ßÂÄ§Ôºâ'); return; } COLOR_SETTINGS[colorType] = { hueMin: hueMin, hueMax: hueMax, satMin: satMin, lightMin: lightMin, lightMax: lightMax }; localStorage.setItem('COLOR_SETTINGS', JSON.stringify(COLOR_SETTINGS)); closeColorSettingModal(); updateColorSettingsCards(); console.log(`${colorType} „ÅÆË®≠ÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü:`, COLOR_SETTINGS[colorType]); } function saveColorSetting(name) { const hueMin = parseInt(document.getElementById('hueMin').value) || _0x8c9d[name].hue.min; const hueMax = parseInt(document.getElementById('hueMax').value) || _0x8c9d[name].hue.max; const satMin = parseInt(document.getElementById('satMin').value) || _0x8c9d[name].saturation.min; const brightMin = parseInt(document.getElementById('brightMin').value) || _0x8c9d[name].brightness.min; const brightMax = parseInt(document.getElementById('brightMax').value) || _0x8c9d[name].brightness.max; if (hueMin < 0 || hueMin > 360 || hueMax < 0 || hueMax > 360 || hueMin > hueMax) { showError('Ëâ≤Áõ∏„ÅÆÁØÑÂõ≤„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà0-360Â∫¶„ÄÅÊúÄÂ∞èÂÄ§ ‚â§ ÊúÄÂ§ßÂÄ§Ôºâ'); return; } if (satMin < 0 || satMin > 100) { showError('ÂΩ©Â∫¶ÊúÄÂ∞èÂÄ§„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà0-100%Ôºâ'); return; } if (brightMin < 0 || brightMin > 100 || brightMax < 0 || brightMax > 100 || brightMin > brightMax) { showError('ÊòéÂ∫¶„ÅÆÁØÑÂõ≤„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà0-100%„ÄÅÊúÄÂ∞èÂÄ§ ‚â§ ÊúÄÂ§ßÂÄ§Ôºâ'); return; } _0x8c9d[name].hue.min = hueMin; _0x8c9d[name].hue.max = hueMax; _0x8c9d[name].saturation.min = satMin; _0x8c9d[name].brightness.min = brightMin; _0x8c9d[name].brightness.max = brightMax; closeColorModal(); updateColorSettingsCards(); showSuccessMessage(`‚úÖ ${name}„ÅÆË®≠ÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`); } function editJudgmentRule(level) { console.log('üîß editJudgmentRuleÂëº„Å≥Âá∫„Åó:', level); const rule = _0xaebf[level]; console.log('üìã „É´„Éº„É´ÊÉÖÂ†±:', rule); if (!rule) { console.error('‚ùå „É´„Éº„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', level); return; } console.log('üìã rule.conditions:', rule.conditions); const condition = (rule.conditions && rule.conditions[0]) || { colorSetting: 'Á∑ëÁ≥ª', operator: '>=', threshold: 50 }; console.log('üéØ ‰ΩøÁî®„Åô„ÇãÊù°‰ª∂:', condition); const simpleJudgmentModalHtml = ` <div onclick="closeJudgmentRuleModal()" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="judgmentRuleModal"> <div onclick="event.stopPropagation()" style="background: white; padding: 20px; border-radius: 12px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto; position: relative;"> <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ --> <button onclick="closeJudgmentRuleModal()" style="position: absolute; top: 10px; right: 10px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;"> ‚úï </button> <h3 style="margin-bottom: 20px; color: #4CAF50; font-size: 18px; padding-right: 40px;">${rule.name} („Ç´„É©„Éº${level}) „ÅÆÂà§ÂÆö„É´„Éº„É´Á∑®ÈõÜ</h3> <div style="margin-bottom: 25px;"> <label style="font-weight: bold; display: block; margin-bottom: 8px;">ÂÑ™ÂÖàÂ∫¶:</label> <input type="number" id="priority_${level}" value="${rule.priority}" style="padding: 8px; width: 100px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;" min="1" max="10"> <div style="color: #666; font-size: 12px; margin-top: 5px;">Êï∞ÂÄ§„ÅåÂ∞è„Åï„ÅÑ„Åª„Å©ÂÑ™ÂÖà„Åï„Çå„Çã</div> </div> <div style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 8px;"> <h4 style="margin-bottom: 15px; font-size: 16px;">Âà§ÂÆöÊù°‰ª∂</h4> <div class="conditions-container"> <div class="condition-item" id="condition_0" style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #e0e0e0; margin-bottom: 15px;"> <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;"> <div style="font-weight: bold; color: #333;">Êù°‰ª∂ 1</div> <button onclick="removeCondition(0)" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer; ${rule.conditions && rule.conditions.length <= 1 ? 'display: none;' : ''}"> ‚úï ÂâäÈô§ </button> </div> <div style="margin-bottom: 15px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">Ëâ≤Ë®≠ÂÆö:</label> <select id="colorSetting_0" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <option value="Á∑ëÁ≥ª" ${condition.colorSetting === 'Á∑ëÁ≥ª' ? 'selected' : ''}>Á∑ëÁ≥ª</option> <option value="ÈªÑÁ∑ëÁ≥ª" ${condition.colorSetting === 'ÈªÑÁ∑ëÁ≥ª' ? 'selected' : ''}>ÈªÑÁ∑ëÁ≥ª</option> <option value="ÈªÑËâ≤Á≥ª" ${condition.colorSetting === 'ÈªÑËâ≤Á≥ª' ? 'selected' : ''}>ÈªÑËâ≤Á≥ª</option> <option value="ÊñëÁÇπÁ≥ª" ${condition.colorSetting === 'ÊñëÁÇπÁ≥ª' ? 'selected' : ''}>ÊñëÁÇπÁ≥ª</option> <option value="Ë§êËâ≤Á≥ª" ${condition.colorSetting === 'Ë§êËâ≤Á≥ª' ? 'selected' : ''}>Ë§êËâ≤Á≥ª</option> </select> </div> <div style="margin-bottom: 15px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">ÊºîÁÆóÂ≠ê:</label> <select id="operator_0" onchange="toggleRangeInputsForCondition(0)" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <option value=">=" ${condition.operator === '>=' ? 'selected' : ''}>‰ª•‰∏ä (>=)</option> <option value="<=" ${condition.operator === '<=' ? 'selected' : ''}>‰ª•‰∏ã (<=)</option> <option value=">" ${condition.operator === '>' ? 'selected' : ''}>„Çà„ÇäÂ§ß„Åç„ÅÑ (>)</option> <option value="<" ${condition.operator === '<' ? 'selected' : ''}>„Çà„ÇäÂ∞è„Åï„ÅÑ (<)</option> <option value="range" ${condition.operator === 'range' ? 'selected' : ''}>ÁØÑÂõ≤ (ÁØÑÂõ≤ÂÜÖ)</option> </select> </div> <div id="thresholdInput_0" style="margin-bottom: 10px; ${condition.operator === 'range' ? 'display: none;' : ''}"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">ÈñæÂÄ§(%):</label> <input type="number" id="threshold_0" value="${condition.threshold}" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> </div> <div id="rangeInputs_0" style="margin-bottom: 10px; ${condition.operator === 'range' ? '' : 'display: none;'}"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">ÁØÑÂõ≤(%):</label> <div style="display: flex; align-items: center; gap: 8px;"> <input type="number" id="rangeMin_0" value="${condition.min || 0}" style="padding: 8px; width: 80px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> <span>%„Äú</span> <input type="number" id="rangeMax_0" value="${condition.max || 100}" style="padding: 8px; width: 80px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> <span>%</span> </div> </div> </div> </div> <button onclick="addSimpleCondition(${level})" style="margin-top: 15px; background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;"> ‚ûï Êù°‰ª∂„ÇíËøΩÂä† </button> </div> <div style="display: flex; gap: 10px; justify-content: center;"> <button onclick="saveSimpleJudgmentRule(${level})" style="background: #28a745; color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;"> üíæ ‰øùÂ≠ò </button> <button onclick="closeJudgmentRuleModal()" style="background: #6c757d; color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;"> ‚ùå „Ç≠„É£„É≥„Çª„É´ </button> </div> </div> </div> `; console.log('üé≠ „É¢„Éº„ÉÄ„É´HTMLÁîüÊàêÂÆå‰∫Ü'); document.body.insertAdjacentHTML('beforeend', simpleJudgmentModalHtml); console.log('‚úÖ „É¢„Éº„ÉÄ„É´„ÇíDOM„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü'); return; let conditionsHtml = ''; rule.conditions.forEach((condition, index) => { conditionsHtml += ` <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"> <div style="margin-bottom: 10px; font-weight: bold;">Êù°‰ª∂ ${index + 1}</div> <div style="margin-bottom: 10px;"> <label>Ëâ≤Ë®≠ÂÆö:</label> <select id="colorSetting_${level}_${index}" style="margin-left: 10px; padding: 4px;"> <option value="Á∑ëÁ≥ª" ${condition.colorSetting === 'Á∑ëÁ≥ª' ? 'selected' : ''}>Á∑ëÁ≥ª</option> <option value="ÈªÑÁ∑ëÁ≥ª" ${condition.colorSetting === 'ÈªÑÁ∑ëÁ≥ª' ? 'selected' : ''}>ÈªÑÁ∑ëÁ≥ª</option> <option value="ÈªÑËâ≤Á≥ª" ${condition.colorSetting === 'ÈªÑËâ≤Á≥ª' ? 'selected' : ''}>ÈªÑËâ≤Á≥ª</option> <option value="ÊñëÁÇπÁ≥ª" ${condition.colorSetting === 'ÊñëÁÇπÁ≥ª' ? 'selected' : ''}>ÊñëÁÇπÁ≥ª</option> <option value="Ë§êËâ≤Á≥ª" ${condition.colorSetting === 'Ë§êËâ≤Á≥ª' ? 'selected' : ''}>Ë§êËâ≤Á≥ª</option> </select> </div> <div style="margin-bottom: 10px;"> <label>ÊºîÁÆóÂ≠ê:</label> <select id="operator_${level}_${index}" style="margin-left: 10px; padding: 4px;" onchange="toggleRangeInputs(${level}, ${index})"> <option value=">=" ${condition.operator === '>=' ? 'selected' : ''}>‰ª•‰∏ä (>=)</option> <option value="<=" ${condition.operator === '<=' ? 'selected' : ''}>‰ª•‰∏ã (<=)</option> <option value=">" ${condition.operator === '>' ? 'selected' : ''}>„Çà„ÇäÂ§ß„Åç„ÅÑ (>)</option> <option value="<" ${condition.operator === '<' ? 'selected' : ''}>„Çà„ÇäÂ∞è„Åï„ÅÑ (<)</option> <option value="==" ${condition.operator === '==' ? 'selected' : ''}>Á≠â„Åó„ÅÑ (==)</option> <option value="range" ${condition.operator === 'range' ? 'selected' : ''}>ÁØÑÂõ≤ÂÜÖ (range)</option> </select> </div> <div id="thresholdInput_${level}_${index}" style="margin-bottom: 10px; ${condition.operator === 'range' ? 'display: none;' : ''}"> <label>ÈñæÂÄ§(%):</label> <input type="number" id="threshold_${level}_${index}" value="${condition.threshold || 50}" style="margin-left: 10px; padding: 4px; width: 80px;" min="0" max="100"> </div> <div id="rangeInputs_${level}_${index}" style="margin-bottom: 10px; ${condition.operator === 'range' ? '' : 'display: none;'}"> <label>ÁØÑÂõ≤:</label> <input type="number" id="rangeMin_${level}_${index}" value="${condition.min || 0}" style="margin-left: 10px; padding: 4px; width: 60px;" min="0" max="100"> %„Äú <input type="number" id="rangeMax_${level}_${index}" value="${condition.max || 100}" style="margin-left: 5px; padding: 4px; width: 60px;" min="0" max="100"> % </div> <button onclick="removeCondition(${level}, ${index})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Êù°‰ª∂ÂâäÈô§</button> </div> `; }); const judgmentModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="judgmentRuleModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto;"> <h3 style="margin-bottom: 20px; color: #1976d2;">„Ç´„É©„Éº${level} (${rule.name}) „ÅÆÁ∑®ÈõÜ</h3> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">ÂÑ™ÂÖàÂ∫¶:</label> <input type="number" id="priority_${level}" value="${rule.priority}" style="margin-left: 10px; padding: 4px; width: 80px;" min="1" max="10"> </div> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">„Ç´„É©„ÉºÂêç:</label> <input type="text" id="ruleName_${level}" value="${rule.name}" style="margin-left: 10px; padding: 4px; width: 200px;"> </div> <div style="margin-bottom: 15px;"> <label style="font-weight: bold;">Âà§ÂÆöÊù°‰ª∂:</label> <div id="conditionsContainer_${level}" style="margin-top: 10px;"> ${conditionsHtml} </div> <button onclick="addCondition(${level})" style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 4px; margin-top: 10px;">Êù°‰ª∂ËøΩÂä†</button> </div> <div style="text-align: right;"> <button onclick="closeJudgmentRuleModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px;">„Ç≠„É£„É≥„Çª„É´</button> <button onclick="saveJudgmentRule(${level})" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px;">‰øùÂ≠ò</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', judgmentModalHtml); } function closeJudgmentRuleModal() { const modal = document.getElementById('judgmentRuleModal'); if (modal) { modal.remove(); } } function toggleRangeInputs() { toggleRangeInputsForCondition(0); } function toggleRangeInputsForCondition(conditionIndex) { const operator = document.getElementById(`operator_${conditionIndex}`); const thresholdInput = document.getElementById(`thresholdInput_${conditionIndex}`); const rangeInputs = document.getElementById(`rangeInputs_${conditionIndex}`); if (!operator || !thresholdInput || !rangeInputs) return; if (operator.value === 'range') { thresholdInput.style.display = 'none'; rangeInputs.style.display = 'block'; } else { thresholdInput.style.display = 'block'; rangeInputs.style.display = 'none'; } } function removeCondition(conditionIndex) { const conditionElement = document.getElementById(`condition_${conditionIndex}`); if (conditionElement) { const conditionsContainer = document.querySelector('.conditions-container'); const totalConditions = conditionsContainer.children.length; if (totalConditions <= 1) { alert('ÊúÄ‰Ωé1„Å§„ÅÆÊù°‰ª∂„ÅØÂøÖË¶Å„Åß„Åô„ÄÇ'); return; } conditionElement.remove(); console.log('‚úÖ Êù°‰ª∂„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü:', conditionIndex); renumberConditions(); } } function renumberConditions() { const conditionsContainer = document.querySelector('.conditions-container'); const conditionItems = conditionsContainer.children; Array.from(conditionItems).forEach((item, index) => { const titleElement = item.querySelector('div:first-child div:first-child'); if (titleElement) { titleElement.textContent = `Êù°‰ª∂ ${index + 1}`; } const deleteButton = item.querySelector('button[onclick*="removeCondition"]'); if (deleteButton) { if (conditionItems.length <= 1) { deleteButton.style.display = 'none'; } else { deleteButton.style.display = 'block'; } } }); console.log(`üìã Êù°‰ª∂Áï™Âè∑„ÇíÊåØ„ÇäÁõ¥„Åó„Åæ„Åó„Åü„ÄÇÁèæÂú®„ÅÆÊù°‰ª∂Êï∞: ${conditionItems.length}`); } function saveJudgmentRule(level) { const priority = parseInt(document.getElementById(`priority_${level}`).value) || 1; const name = document.getElementById(`ruleName_${level}`).value.trim() || `„Ç´„É©„Éº${level}`; const conditionsContainer = document.querySelector('.conditions-container'); const conditionItems = conditionsContainer ? conditionsContainer.querySelectorAll('.condition-item') : []; const newConditions = []; console.log(`üîç Êù°‰ª∂ÂèéÈõÜÈñãÂßã - Êù°‰ª∂Êï∞: ${conditionItems.length}`); conditionItems.forEach((item, index) => { const conditionId = item.id.replace('condition_', ''); const colorSetting = document.getElementById(`colorSetting_${conditionId}`)?.value; const operator = document.getElementById(`operator_${conditionId}`)?.value; console.log(`üîç Êù°‰ª∂${index + 1} - ID: ${conditionId}, Ëâ≤Ë®≠ÂÆö: ${colorSetting}, ÊºîÁÆóÂ≠ê: ${operator}`); if (!colorSetting || !operator) { console.warn(`‚ö†Ô∏è Êù°‰ª∂${index + 1}„Çí„Çπ„Ç≠„ÉÉ„Éó - Ëâ≤Ë®≠ÂÆö„Åæ„Åü„ÅØ„Ç™„Éö„É¨„Éº„Çø„Éº„ÅåÊú™Ë®≠ÂÆö`); return; } const condition = { colorSetting: colorSetting, operator: operator }; if (operator === 'range') { const minInput = document.getElementById(`rangeMin_${conditionId}`); const maxInput = document.getElementById(`rangeMax_${conditionId}`); condition.min = parseFloat(minInput?.value) || 0; condition.max = parseFloat(maxInput?.value) || 100; console.log(`üìä ÁØÑÂõ≤Êù°‰ª∂ - ÊúÄÂ∞è: ${condition.min}%, ÊúÄÂ§ß: ${condition.max}%`); } else { const thresholdInput = document.getElementById(`threshold_${conditionId}`); condition.threshold = parseFloat(thresholdInput?.value) || 0; console.log(`üìä ÈñæÂÄ§Êù°‰ª∂ - ÂÄ§: ${condition.threshold}%`); } newConditions.push(condition); console.log(`‚úÖ Êù°‰ª∂${index + 1}„ÇíËøΩÂä†:`, condition); }); if (priority < 1 || priority > 10) { showError('ÂÑ™ÂÖàÂ∫¶„ÅØ1-10„ÅÆÁØÑÂõ≤„ÅßË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } if (name.length === 0) { showError('„Ç´„É©„ÉºÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } if (newConditions.length === 0) { showError('ÊúÄ‰Ωé1„Å§„ÅÆÊù°‰ª∂„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } _0xaebf[level] = { level: level, name: name, priority: priority, conditions: newConditions }; try { localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); console.log(`üìù „Ç´„É©„Éº${level}„É´„Éº„É´Êõ¥Êñ∞‰øùÂ≠ò:`, _0xaebf[level]); } catch (error) { console.error('Âà§ÂÆö„É´„Éº„É´‰øùÂ≠ò„Ç®„É©„Éº:', error); showError('Âà§ÂÆö„É´„Éº„É´„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'); return; } closeJudgmentRuleModal(); updateJudgmentRulesCards(); setTimeout(() => { updateJudgmentRulesCards(); console.log('üîÑ ÈÅÖÂª∂ÁîªÈù¢Êõ¥Êñ∞ÂÆå‰∫Ü'); }, 200); showSuccessMessage(`‚úÖ „Ç´„É©„Éº${level} (${name}) „ÅÆ„É´„Éº„É´„ÇíÊõ¥Êñ∞„Éª‰øùÂ≠ò„Åó„Åæ„Åó„Åü`); } function toggleRangeInputs(level, index) { const operator = document.getElementById(`operator_${level}_${index}`).value; const thresholdInput = document.getElementById(`thresholdInput_${level}_${index}`); const rangeInputs = document.getElementById(`rangeInputs_${level}_${index}`); if (operator === 'range') { thresholdInput.style.display = 'none'; rangeInputs.style.display = 'block'; } else { thresholdInput.style.display = 'block'; rangeInputs.style.display = 'none'; } } function addCondition(level) { const rule = _0xaebf[level]; const newIndex = rule.conditions.length; const conditionHtml = ` <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"> <div style="margin-bottom: 10px; font-weight: bold;">Êù°‰ª∂ ${newIndex + 1}</div> <div style="margin-bottom: 10px;"> <label>Ëâ≤Ë®≠ÂÆö:</label> <select id="colorSetting_${level}_${newIndex}" style="margin-left: 10px; padding: 4px;"> <option value="Á∑ëÁ≥ª">Á∑ëÁ≥ª</option> <option value="ÈªÑÁ∑ëÁ≥ª">ÈªÑÁ∑ëÁ≥ª</option> <option value="ÈªÑËâ≤Á≥ª">ÈªÑËâ≤Á≥ª</option> <option value="ÊñëÁÇπÁ≥ª">ÊñëÁÇπÁ≥ª</option> <option value="Ë§êËâ≤Á≥ª">Ë§êËâ≤Á≥ª</option> </select> </div> <div style="margin-bottom: 10px;"> <label>ÊºîÁÆóÂ≠ê:</label> <select id="operator_${level}_${newIndex}" style="margin-left: 10px; padding: 4px;" onchange="toggleRangeInputs(${level}, ${newIndex})"> <option value=">=">‰ª•‰∏ä (>=)</option> <option value="<=">‰ª•‰∏ã (<=)</option> <option value=">">„Çà„ÇäÂ§ß„Åç„ÅÑ (>)</option> <option value="<">„Çà„ÇäÂ∞è„Åï„ÅÑ (<)</option> <option value="==">Á≠â„Åó„ÅÑ (==)</option> <option value="range">ÁØÑÂõ≤ÂÜÖ (range)</option> </select> </div> <div id="thresholdInput_${level}_${newIndex}" style="margin-bottom: 10px;"> <label>ÈñæÂÄ§(%):</label> <input type="number" id="threshold_${level}_${newIndex}" value="50" style="margin-left: 10px; padding: 4px; width: 80px;" min="0" max="100"> </div> <div id="rangeInputs_${level}_${newIndex}" style="margin-bottom: 10px; display: none;"> <label>ÁØÑÂõ≤:</label> <input type="number" id="rangeMin_${level}_${newIndex}" value="0" style="margin-left: 10px; padding: 4px; width: 60px;" min="0" max="100"> %„Äú <input type="number" id="rangeMax_${level}_${newIndex}" value="100" style="margin-left: 5px; padding: 4px; width: 60px;" min="0" max="100"> % </div> <button onclick="removeCondition(${level}, ${newIndex})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Êù°‰ª∂ÂâäÈô§</button> </div> `; const container = document.getElementById(`conditionsContainer_${level}`); container.insertAdjacentHTML('beforeend', conditionHtml); rule.conditions.push({ colorSetting: "Á∑ëÁ≥ª", operator: ">=", threshold: 50 }); } function importColorSettingsCSV() { const input = document.createElement('input'); input.type = 'file'; input.accept = '.csv'; input.onchange = function(e) { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const csv = e.target.result; const lines = csv.split('\n'); if (lines.length < 2) { showError('CSV„Éï„Ç°„Ç§„É´„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Éá„Éº„Çø„Åå‰∏çË∂≥Ôºâ'); return; } const headers = lines[0].split(',').map(h => h.trim()); if (!headers.includes('Ë®≠ÂÆöÂêç') || !headers.includes('Ëâ≤Áõ∏ÊúÄÂ∞è') || !headers.includes('Ëâ≤Áõ∏ÊúÄÂ§ß') || !headers.includes('ÂΩ©Â∫¶ÊúÄÂ∞è') || !headers.includes('ÊòéÂ∫¶ÊúÄÂ∞è') || !headers.includes('ÊòéÂ∫¶ÊúÄÂ§ß')) { showError('CSV„Éï„Ç°„Ç§„É´„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàÂøÖË¶Å„Å™ÂàóÔºöË®≠ÂÆöÂêç„ÄÅËâ≤Áõ∏ÊúÄÂ∞è„ÄÅËâ≤Áõ∏ÊúÄÂ§ß„ÄÅÂΩ©Â∫¶ÊúÄÂ∞è„ÄÅÊòéÂ∫¶ÊúÄÂ∞è„ÄÅÊòéÂ∫¶ÊúÄÂ§ßÔºâ'); return; } let importCount = 0; for (let i = 1; i < lines.length; i++) { const line = lines[i].trim(); if (!line) continue; const values = line.split(',').map(v => v.trim()); if (values.length < headers.length) continue; const settingName = values[headers.indexOf('Ë®≠ÂÆöÂêç')]; const hueMin = values[headers.indexOf('Ëâ≤Áõ∏ÊúÄÂ∞è')]; const hueMax = values[headers.indexOf('Ëâ≤Áõ∏ÊúÄÂ§ß')]; const satMin = values[headers.indexOf('ÂΩ©Â∫¶ÊúÄÂ∞è')]; const brightMin = values[headers.indexOf('ÊòéÂ∫¶ÊúÄÂ∞è')]; const brightMax = values[headers.indexOf('ÊòéÂ∫¶ÊúÄÂ§ß')]; if (!_0x8c9d[settingName]) continue; try { const hueMinValue = parseInt(hueMin); const hueMaxValue = parseInt(hueMax); const satMinValue = parseInt(satMin); const brightMinValue = parseInt(brightMin); const brightMaxValue = parseInt(brightMax); if (!isNaN(hueMinValue) && !isNaN(hueMaxValue)) { _0x8c9d[settingName].hue.min = hueMinValue; _0x8c9d[settingName].hue.max = hueMaxValue; } if (!isNaN(satMinValue)) { _0x8c9d[settingName].saturation.min = satMinValue; } if (!isNaN(brightMinValue) && !isNaN(brightMaxValue)) { _0x8c9d[settingName].brightness.min = brightMinValue; _0x8c9d[settingName].brightness.max = brightMaxValue; } importCount++; } catch (error) { console.error(`Ëâ≤Ë®≠ÂÆö„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº (${settingName}):`, error); } } if (importCount > 0) { localStorage.setItem('bananaReporter_colorSettings', JSON.stringify(_0x8c9d)); updateColorSettingsCards(); showSuccessMessage(`‚úÖ Ëâ≤Ë®≠ÂÆö„ÇíCSV„Åã„Çâ„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü (${importCount}‰ª∂)`); console.log('üì• Ëâ≤Ë®≠ÂÆö„Ç§„É≥„Éù„Éº„ÉàÂÆå‰∫Ü:', _0x8c9d); } else { showError('„Ç§„É≥„Éù„Éº„ÉàÂèØËÉΩ„Å™„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü'); } } catch (error) { console.error('CSV„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº:', error); showError('CSV„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'); } }; reader.readAsText(file); }; input.click(); } function importJudgmentRulesCSV() { console.log('üì• Âà§ÂÆö„É´„Éº„É´CSV„Ç§„É≥„Éù„Éº„ÉàÈñãÂßã'); const input = document.createElement('input'); input.type = 'file'; input.accept = '.csv'; input.onchange = function(e) { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const csv = e.target.result; const lines = csv.split('\n'); if (lines.length < 2) { showError('CSV„Éï„Ç°„Ç§„É´„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Éá„Éº„Çø„Åå‰∏çË∂≥Ôºâ'); return; } const headers = lines[0].split(',').map(h => h.trim()); if (!headers.includes('„Ç´„É©„Éº') || !headers.includes('„Ç´„É©„ÉºÂêç') || !headers.includes('ÂÑ™ÂÖàÂ∫¶') || !headers.includes('Ëâ≤Ë®≠ÂÆö') || !headers.includes('ÊºîÁÆóÂ≠ê') || !headers.includes('ÈñæÂÄ§')) { showError('CSV„Éï„Ç°„Ç§„É´„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàÂøÖË¶Å„Å™ÂàóÔºö„Ç´„É©„Éº„ÄÅ„Ç´„É©„ÉºÂêç„ÄÅÂÑ™ÂÖàÂ∫¶„ÄÅËâ≤Ë®≠ÂÆö„ÄÅÊºîÁÆóÂ≠ê„ÄÅÈñæÂÄ§Ôºâ'); return; } let importCount = 0; const tempRules = {}; console.log('üì• CSVËß£ÊûêÈñãÂßã - Á∑èË°åÊï∞:', lines.length); for (let i = 1; i < lines.length; i++) { const line = lines[i].trim(); if (!line) continue; const values = line.split(',').map(v => v.trim()); if (values.length < headers.length) continue; const colorLevel = values[headers.indexOf('„Ç´„É©„Éº')]; const colorName = values[headers.indexOf('„Ç´„É©„ÉºÂêç')]; const priority = values[headers.indexOf('ÂÑ™ÂÖàÂ∫¶')]; const colorType = values[headers.indexOf('Ëâ≤Ë®≠ÂÆö')]; const operator = values[headers.indexOf('ÊºîÁÆóÂ≠ê')]; const threshold = values[headers.indexOf('ÈñæÂÄ§')]; const rangeMin = values[headers.indexOf('ÁØÑÂõ≤ÊúÄÂ∞è')]; const rangeMax = values[headers.indexOf('ÁØÑÂõ≤ÊúÄÂ§ß')]; console.log(`üìã Ë°å${i}: „Ç´„É©„Éº=${colorLevel}, ÂêçÂâç=${colorName}, ÂÑ™ÂÖàÂ∫¶=${priority}, Ëâ≤Ë®≠ÂÆö=${colorType}`); const levelMatch = colorLevel.match(/(\d+)/); if (!levelMatch) { console.warn(`‚ö†Ô∏è Ë°å${i}: „Ç´„É©„Éº„É¨„Éô„É´Ëß£ÊûêÂ§±Êïó - ${colorLevel}`); continue; } const level = parseInt(levelMatch[1]); if (level < 2 || level > 9) { console.warn(`‚ö†Ô∏è Ë°å${i}: „Ç´„É©„Éº„É¨„Éô„É´ÁØÑÂõ≤Â§ñ - ${level}`); continue; } if (!colorType || !operator) { console.warn(`‚ö†Ô∏è Ë°å${i}: Ëâ≤Ë®≠ÂÆö„Åæ„Åü„ÅØÊºîÁÆóÂ≠ê„ÅåÊú™Ë®≠ÂÆö`); continue; } try { const priorityNum = parseInt(priority) || (tempRules[level] ? tempRules[level].priority : 1); const name = colorName || (tempRules[level] ? tempRules[level].name : `„Ç´„É©„Éº${level}`); let condition = { colorSetting: colorType, operator: operator }; if (operator === 'range') { condition.min = parseInt(rangeMin) || 0; condition.max = parseInt(rangeMax) || 100; } else { condition.threshold = parseInt(threshold) || 50; } if (tempRules[level]) { tempRules[level].conditions.push(condition); console.log(`‚ûï „Ç´„É©„Éº${level}„Å´Êù°‰ª∂ËøΩÂä†:`, condition); } else { tempRules[level] = { level: level, name: name, priority: priorityNum, conditions: [condition] }; console.log(`üÜï „Ç´„É©„Éº${level}Êñ∞Ë¶è‰ΩúÊàê:`, tempRules[level]); } importCount++; } catch (error) { console.error(`Âà§ÂÆö„É´„Éº„É´„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº („Ç´„É©„Éº${level}):`, error); } } Object.keys(tempRules).forEach(level => { _0xaebf[level] = tempRules[level]; console.log(`‚úÖ „Ç´„É©„Éº${level}ÊúÄÁµÇÁ¢∫ÂÆö:`, _0xaebf[level]); }); if (importCount > 0) { localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); updateJudgmentRulesCards(); showSuccessMessage(`‚úÖ Âà§ÂÆö„É´„Éº„É´„ÇíCSV„Åã„Çâ„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü (${importCount}‰ª∂)`); console.log('üì• Âà§ÂÆö„É´„Éº„É´„Ç§„É≥„Éù„Éº„ÉàÂÆå‰∫Ü:', _0xaebf); } else { showError('„Ç§„É≥„Éù„Éº„ÉàÂèØËÉΩ„Å™„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü'); } } catch (error) { console.error('Âà§ÂÆö„É´„Éº„É´CSV„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº:', error); showError('CSV„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'); } }; reader.readAsText(file); }; input.click(); } function resetColorSettingsToDefault() { if (confirm('Ëâ≤Ë®≠ÂÆö„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åô„ÅãÔºü')) { const defaultColorSettings = { "Á∑ëÁ≥ª": { name: "Á∑ëÁ≥ª", hue: { min: 70, max: 150 }, saturation: { min: 40 }, brightness: { min: 20, max: 80 }, color: "#4CAF50" }, "ÈªÑÁ∑ëÁ≥ª": { name: "ÈªÑÁ∑ëÁ≥ª", hue: { min: 50, max: 100 }, saturation: { min: 25 }, brightness: { min: 40, max: 90 }, color: "#8BC34A" }, "ÈªÑËâ≤Á≥ª": { name: "ÈªÑËâ≤Á≥ª", hue: { min: 30, max: 70 }, saturation: { min: 40 }, brightness: { min: 60, max: 100 }, color: "#FFEB3B" }, "ÊñëÁÇπÁ≥ª": { name: "ÊñëÁÇπÁ≥ª", hue: { min: 20, max: 50 }, saturation: { min: 50 }, brightness: { min: 60, max: 95 }, color: "#FF9800" }, "Ë§êËâ≤Á≥ª": { name: "Ë§êËâ≤Á≥ª", hue: { min: 0, max: 30 }, saturation: { min: 30 }, brightness: { min: 20, max: 70 }, color: "#795548" } }; Object.keys(_0x8c9d).forEach(key => delete _0x8c9d[key]); Object.assign(_0x8c9d, defaultColorSettings); localStorage.setItem('bananaReporter_colorSettings', JSON.stringify(_0x8c9d)); updateColorSettingsCards(); showSuccessMessage('‚úÖ Ëâ≤Ë®≠ÂÆö„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åó„Åü'); console.log('üîÑ Ëâ≤Ë®≠ÂÆö„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åó„Åü:', _0x8c9d); } } function resetJudgmentRulesToDefault() { if (confirm('Âà§ÂÆö„É´„Éº„É´„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åô„ÅãÔºü')) { Object.keys(_0xaebf).forEach(key => delete _0xaebf[key]); const defaultRules = { 2: { level: 2, name: "„Ç™„Éº„É´„Ç∞„É™„Éº„É≥", priority: 8, conditions: [ { colorSetting: "Á∑ëÁ≥ª", operator: ">=", threshold: 60 } ] }, 3: { level: 3, name: "„É©„Ç§„Éà„Ç∞„É™„Éº„É≥", priority: 7, conditions: [ { colorSetting: "Á∑ëÁ≥ª", operator: ">=", threshold: 40 } ] }, 4: { level: 4, name: "„Éè„Éº„Éï„Ç∞„É™„Éº„É≥", priority: 6, conditions: [ { colorSetting: "ÈªÑÁ∑ëÁ≥ª", operator: ">=", threshold: 40 } ] }, 5: { level: 5, name: "„Ç∞„É™„Éº„É≥„ÉÅ„ÉÉ„Éó", priority: 5, conditions: [ { colorSetting: "ÈªÑÁ∑ëÁ≥ª", operator: ">=", threshold: 25 } ] }, 6: { level: 6, name: "„Éï„É´„Ç§„Ç®„É≠„Éº", priority: 4, conditions: [ { colorSetting: "ÈªÑËâ≤Á≥ª", operator: ">=", threshold: 50 } ] }, 7: { level: 7, name: "„Çπ„Çø„Éº", priority: 3, conditions: [ { colorSetting: "ÊñëÁÇπÁ≥ª", operator: ">=", threshold: 30 } ] }, 8: { level: 8, name: "„Ç´„É©„Éº8", priority: 2, conditions: [ { colorSetting: "ÊñëÁÇπÁ≥ª", operator: ">=", threshold: 15 } ] }, 9: { level: 9, name: "„Ç´„É©„Éº9", priority: 1, conditions: [ { colorSetting: "Ë§êËâ≤Á≥ª", operator: ">=", threshold: 20 } ] } }; Object.assign(_0xaebf, defaultRules); localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); updateJudgmentRulesCards(); showSuccessMessage('‚úÖ Âà§ÂÆö„É´„Éº„É´„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åó„Åü'); console.log('üîÑ Âà§ÂÆö„É´„Éº„É´„ÇíÂàùÊúüÂÄ§„Å´Êàª„Åó„Åæ„Åó„Åü:', _0xaebf); } } function loadMasterDataFromStorage() { try { const saved = localStorage.getItem('bananaReporter_masterData'); if (saved) { const savedData = JSON.parse(saved); Object.assign(MasterData, savedData); AppState.storeData = { ...MasterData.stores }; AppState.productData = [...MasterData.products]; AppState.claimTypeData = [...MasterData.claimTypes]; console.log('‚úÖ ‰øùÂ≠ò„Åï„Çå„Åü„Éû„Çπ„Çø„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü'); } } catch (error) { console.error('„Éû„Çπ„Çø„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', error); } try { const savedRules = localStorage.getItem('bananaReporter_judgmentRules'); if (savedRules) { const parsedRules = JSON.parse(savedRules); Object.assign(_0xaebf, parsedRules); console.log('‚úÖ ‰øùÂ≠ò„Åï„Çå„ÅüÂà§ÂÆö„É´„Éº„É´„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü'); } } catch (error) { console.error('Âà§ÂÆö„É´„Éº„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', error); } try { const savedColorSettings = localStorage.getItem('bananaReporter_colorSettings'); if (savedColorSettings) { const parsedColorSettings = JSON.parse(savedColorSettings); Object.assign(_0x8c9d, parsedColorSettings); console.log('‚úÖ ‰øùÂ≠ò„Åï„Çå„ÅüËâ≤Ë®≠ÂÆö„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü:', _0x8c9d); } } catch (error) { console.error('Ëâ≤Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', error); } } document.addEventListener('DOMContentLoaded', function() { console.log('üçå „Éê„Éä„Éä„É¨„Éù„Éº„Çø„Éº v8.2 ÂÆåÂÖ®Áµ±ÂêàÁâà Ëµ∑Âãï'); loadMasterDataFromStorage(); setupEventListeners(); console.log('‚úÖ ÂàùÊúüÂåñÂÆå‰∫Ü'); }); function addNewColorLevel() { const level = prompt('Êñ∞„Åó„ÅÑ„Ç´„É©„Éº„É¨„Éô„É´Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà1-20Ôºâ:', '10'); if (!level || isNaN(level) || level < 1 || level > 20) { alert('ÊúâÂäπ„Å™„É¨„Éô„É´Áï™Âè∑Ôºà1-20Ôºâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return; } if (_0xaebf[level]) { alert(`„Ç´„É©„Éº${level}„ÅØÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô„ÄÇ`); return; } const name = prompt(`„Ç´„É©„Éº${level}„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:`, `„Ç´„É©„Éº${level}`); if (!name) return; _0xaebf[level] = { level: parseInt(level), name: name.trim(), priority: parseInt(level), conditions: [{ colorSetting: 'Á∑ëÁ≥ª', operator: '>=', threshold: 50 }] }; updateJudgmentRulesCards(); showSuccessMessage(`‚úÖ „Ç´„É©„Éº${level} (${name}) „ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`); } function duplicateRule(level) { const sourceRule = _0xaebf[level]; if (!sourceRule) return; const newLevel = prompt('Ë§áË£ΩÂÖà„ÅÆ„Ç´„É©„Éº„É¨„Éô„É´Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', (parseInt(level) + 1).toString()); if (!newLevel || isNaN(newLevel)) { alert('ÊúâÂäπ„Å™„É¨„Éô„É´Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return; } if (_0xaebf[newLevel]) { if (!confirm(`„Ç´„É©„Éº${newLevel}„ÅØÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô„ÄÇ‰∏äÊõ∏„Åç„Åó„Åæ„Åô„ÅãÔºü`)) { return; } } _0xaebf[newLevel] = { level: parseInt(newLevel), name: sourceRule.name + '„ÅÆ„Ç≥„Éî„Éº', priority: sourceRule.priority + 1, conditions: JSON.parse(JSON.stringify(sourceRule.conditions)) }; updateJudgmentRulesCards(); showSuccessMessage(`‚úÖ „Ç´„É©„Éº${level}„Çí„Ç´„É©„Éº${newLevel}„Å´Ë§áË£Ω„Åó„Åæ„Åó„Åü`); } function deleteRule(level) { const rule = _0xaebf[level]; if (!rule) return; if (confirm(`„Ç´„É©„Éº${level} (${rule.name}) „ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ`)) { delete _0xaebf[level]; updateJudgmentRulesCards(); showSuccessMessage(`‚úÖ „Ç´„É©„Éº${level}„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`); } } function testRule(level) { const rule = _0xaebf[level]; if (!rule) return; const testRuleModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="testRuleModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%;"> <h3 style="margin-bottom: 20px; color: #1976d2;">üß™ „Ç´„É©„Éº${level} „É´„Éº„É´„ÉÜ„Çπ„Éà</h3> <div style="margin-bottom: 15px;"> <h5>${rule.name} (ÂÑ™ÂÖàÂ∫¶: ${rule.priority})</h5> </div> <div style="margin-bottom: 20px;"> <h6>Âà§ÂÆöÊù°‰ª∂:</h6> ${rule.conditions.map((cond, i) => `<div style="margin: 5px 0; padding: 8px; background: #f8f9fa; border-radius: 4px;"> Êù°‰ª∂${i+1}: ${cond.colorSetting} ${cond.operator} ${cond.threshold || (cond.min + '„Äú' + cond.max)}% </div>` ).join('')} </div> <div style="margin-bottom: 20px;"> <h6>„ÉÜ„Çπ„ÉàÁî®„ÅÆËâ≤Ëß£ÊûêÁµêÊûú„ÇíÂÖ•Âäõ:</h6> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;"> <div><label>Á∑ëÁ≥ª (%):</label><input type="number" id="testGreen" value="30" min="0" max="100" style="width: 60px; padding: 4px;"></div> <div><label>ÈªÑÁ∑ëÁ≥ª (%):</label><input type="number" id="testYellowGreen" value="25" min="0" max="100" style="width: 60px; padding: 4px;"></div> <div><label>ÈªÑËâ≤Á≥ª (%):</label><input type="number" id="testYellow" value="20" min="0" max="100" style="width: 60px; padding: 4px;"></div> <div><label>ÊñëÁÇπÁ≥ª (%):</label><input type="number" id="testSpot" value="15" min="0" max="100" style="width: 60px; padding: 4px;"></div> <div><label>Ë§êËâ≤Á≥ª (%):</label><input type="number" id="testBrown" value="10" min="0" max="100" style="width: 60px; padding: 4px;"></div> </div> </div> <div style="text-align: center; margin-bottom: 20px;"> <button onclick="runRuleTest(${level})" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px;">üß™ „ÉÜ„Çπ„ÉàÂÆüË°å</button> </div> <div id="testResult" style="margin-bottom: 20px; padding: 10px; border-radius: 4px; min-height: 40px;"></div> <div style="text-align: right;"> <button onclick="closeTestModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px;">Èñâ„Åò„Çã</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', testRuleModalHtml); } function runRuleTest(level) { const rule = _0xaebf[level]; const testData = { 'Á∑ëÁ≥ª': parseFloat(document.getElementById('testGreen').value) || 0, 'ÈªÑÁ∑ëÁ≥ª': parseFloat(document.getElementById('testYellowGreen').value) || 0, 'ÈªÑËâ≤Á≥ª': parseFloat(document.getElementById('testYellow').value) || 0, 'ÊñëÁÇπÁ≥ª': parseFloat(document.getElementById('testSpot').value) || 0, 'Ë§êËâ≤Á≥ª': parseFloat(document.getElementById('testBrown').value) || 0 }; let allConditionsMet = true; let resultHtml = '<h6>„ÉÜ„Çπ„ÉàÁµêÊûú:</h6>'; rule.conditions.forEach((condition, index) => { const value = testData[condition.colorSetting]; let conditionMet = false; switch(condition.operator) { case '>=': conditionMet = value >= condition.threshold; break; case '<=': conditionMet = value <= condition.threshold; break; case '>': conditionMet = value > condition.threshold; break; case '<': conditionMet = value < condition.threshold; break; case '==': conditionMet = value == condition.threshold; break; case 'range': conditionMet = value >= condition.min && value <= condition.max; break; } const icon = conditionMet ? '‚úÖ' : '‚ùå'; const bgColor = conditionMet ? '#d4edda' : '#f8d7da'; resultHtml += ` <div style="margin: 5px 0; padding: 8px; background: ${bgColor}; border-radius: 4px;"> ${icon} Êù°‰ª∂${index+1}: ${condition.colorSetting} ${value}% ${condition.operator} ${condition.threshold || (condition.min + '„Äú' + condition.max)}% ‚Üí ${conditionMet ? 'Ê∫Ä„Åü„Åô' : 'Ê∫Ä„Åü„Åï„Å™„ÅÑ'} </div> `; if (!conditionMet) allConditionsMet = false; }); const finalResult = allConditionsMet ? '‚úÖ ÂêàÊ†º' : '‚ùå ‰∏çÂêàÊ†º'; const finalBgColor = allConditionsMet ? '#d1ecf1' : '#f5c6cb'; resultHtml += ` <div style="margin-top: 15px; padding: 12px; background: ${finalBgColor}; border-radius: 4px; text-align: center; font-weight: bold; font-size: 16px;"> ÊúÄÁµÇÂà§ÂÆö: ${finalResult} </div> `; document.getElementById('testResult').innerHTML = resultHtml; } function closeTestModal() { const modal = document.getElementById('testRuleModal'); if (modal) modal.remove(); } function showRulePreview() { let previewHtml = '<h4>üìã ÂÖ®„Ç´„É©„ÉºÂà§ÂÆö„É´„Éº„É´‰∏ÄË¶ß</h4>'; const sortedRules = Object.values(_0xaebf).sort((a, b) => a.priority - b.priority); previewHtml += '<table style="width: 100%; border-collapse: collapse; margin-top: 15px;">'; previewHtml += '<tr style="background: #f8f9fa; border: 1px solid #dee2e6;"><th style="padding: 8px; border: 1px solid #dee2e6;">ÂÑ™ÂÖàÂ∫¶</th><th style="padding: 8px; border: 1px solid #dee2e6;">„Ç´„É©„Éº</th><th style="padding: 8px; border: 1px solid #dee2e6;">ÂêçÂâç</th><th style="padding: 8px; border: 1px solid #dee2e6;">Êù°‰ª∂</th></tr>'; sortedRules.forEach(rule => { const conditionsText = rule.conditions.map(cond => `${cond.colorSetting} ${cond.operator} ${cond.threshold || (cond.min + '„Äú' + cond.max)}%` ).join(' „Åã„Å§ '); previewHtml += ` <tr style="border: 1px solid #dee2e6;"> <td style="padding: 8px; border: 1px solid #dee2e6; text-align: center;">${rule.priority}</td> <td style="padding: 8px; border: 1px solid #dee2e6; text-align: center;">„Ç´„É©„Éº${rule.level}</td> <td style="padding: 8px; border: 1px solid #dee2e6;">${rule.name}</td> <td style="padding: 8px; border: 1px solid #dee2e6; font-size: 12px;">${conditionsText}</td> </tr> `; }); previewHtml += '</table>'; const previewModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="previewModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto;"> ${previewHtml} <div style="text-align: right; margin-top: 20px;"> <button onclick="closePreviewModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px;">Èñâ„Åò„Çã</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', testRuleModalHtml); } function closePreviewModal() { const modal = document.getElementById('previewModal'); if (modal) modal.remove(); } function sortRulesByPriority() { if (confirm('ÂÖ®„Å¶„ÅÆ„É´„Éº„É´„ÇíÂÑ™ÂÖàÂ∫¶È†Ü„Åß‰∏¶„Å≥Êõø„Åà„Åæ„Åô„ÅãÔºü')) { updateJudgmentRulesCards(); showSuccessMessage('‚úÖ „É´„Éº„É´„ÇíÂÑ™ÂÖàÂ∫¶È†Ü„Åß‰∏¶„Å≥Êõø„Åà„Åæ„Åó„Åü'); } } function validateAllRules() { let issues = []; const priorities = []; Object.values(_0xaebf).forEach(rule => { if (priorities.includes(rule.priority)) { issues.push(`‚ö†Ô∏è ÂÑ™ÂÖàÂ∫¶${rule.priority}„ÅåÈáçË§á„Åó„Å¶„ÅÑ„Åæ„Åô (${rule.name})`); } priorities.push(rule.priority); rule.conditions.forEach((condition, index) => { if (condition.operator === 'range') { if (!condition.min && condition.min !== 0 || !condition.max && condition.max !== 0) { issues.push(`‚ö†Ô∏è ${rule.name} Êù°‰ª∂${index+1}: ÁØÑÂõ≤„ÅÆË®≠ÂÆö„Åå‰∏çÊ≠£„Åß„Åô`); } else if (condition.min >= condition.max) { issues.push(`‚ö†Ô∏è ${rule.name} Êù°‰ª∂${index+1}: ÁØÑÂõ≤„ÅÆÊúÄÂ∞èÂÄ§„ÅåÊúÄÂ§ßÂÄ§‰ª•‰∏ä„Åß„Åô`); } } else { if (!condition.threshold && condition.threshold !== 0) { issues.push(`‚ö†Ô∏è ${rule.name} Êù°‰ª∂${index+1}: ÈóæÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì`); } } }); if (!rule.conditions || rule.conditions.length === 0) { issues.push(`‚ö†Ô∏è ${rule.name}: Âà§ÂÆöÊù°‰ª∂„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì`); } }); let resultHtml = '<h4>üîç „É´„Éº„É´Ê§úË®ºÁµêÊûú</h4>'; if (issues.length === 0) { resultHtml += '<div style="color: #28a745; font-weight: bold;">‚úÖ ÂÖ®„Å¶„ÅÆ„É´„Éº„É´„ÅåÊ≠£Â∏∏„Åß„Åô</div>'; } else { resultHtml += '<div style="color: #dc3545; font-weight: bold;">‚ùå ‰ª•‰∏ã„ÅÆÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü:</div><ul style="margin-top: 10px;">'; issues.forEach(issue => { resultHtml += `<li style="margin: 5px 0;">${issue}</li>`; }); resultHtml += '</ul>'; } const validationModalHtml = ` <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; justify-content: center; align-items: center;" id="validationModal"> <div style="background: white; padding: 20px; border-radius: 8px; max-width: 600px; width: 90%;"> ${resultHtml} <div style="text-align: right; margin-top: 20px;"> <button onclick="closeValidationModal()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px;">Èñâ„Åò„Çã</button> </div> </div> </div> `; document.body.insertAdjacentHTML('beforeend', validationModalHtml); } function closeValidationModal() { const modal = document.getElementById('validationModal'); if (modal) modal.remove(); } function saveSimpleJudgmentRule(level) { const priority = parseInt(document.getElementById(`priority_${level}`).value) || 1; const conditionsContainer = document.querySelector('.conditions-container'); const conditionItems = conditionsContainer.children; const conditions = []; Array.from(conditionItems).forEach((item, index) => { const itemId = item.id.replace('condition_', ''); const colorSetting = document.getElementById(`colorSetting_${itemId}`)?.value; const operator = document.getElementById(`operator_${itemId}`)?.value; if (!colorSetting || !operator) { console.warn(`‚ö†Ô∏è Êù°‰ª∂${index + 1}„ÅÆ„Éá„Éº„Çø„Åå‰∏çÂÆåÂÖ®:`, {colorSetting, operator}); return; } let condition = { colorSetting: colorSetting, operator: operator }; if (operator === 'range') { condition.min = parseInt(document.getElementById(`rangeMin_${itemId}`)?.value) || 0; condition.max = parseInt(document.getElementById(`rangeMax_${itemId}`)?.value) || 100; } else { condition.threshold = parseInt(document.getElementById(`threshold_${itemId}`)?.value) || 50; } conditions.push(condition); console.log(`‚úÖ Êù°‰ª∂${index + 1}„ÇíÂèéÈõÜ:`, condition); }); if (conditions.length === 0) { showError('ÊúÄ‰Ωé1„Å§„ÅÆÊù°‰ª∂„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } _0xaebf[level].priority = priority; _0xaebf[level].conditions = conditions; localStorage.setItem('bananaReporter_judgmentRules', JSON.stringify(_0xaebf)); closeJudgmentRuleModal(); updateJudgmentRulesCards(); showSuccessMessage(`‚úÖ „Ç´„É©„Éº${level}„ÅÆ„É´„Éº„É´„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`); } function addSimpleCondition(level) { const conditionsContainer = document.querySelector('#judgmentRuleModal .conditions-container'); if (!conditionsContainer) { console.error('‚ùå conditions-container„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'); return; } const conditionIndex = Date.now(); const conditionCount = conditionsContainer.children.length; const conditionNumber = conditionCount + 1; const newConditionHtml = ` <div class="condition-item" id="condition_${conditionIndex}" style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #e0e0e0; margin-bottom: 15px;"> <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;"> <div style="font-weight: bold; color: #333;">Êù°‰ª∂ ${conditionNumber}</div> <button onclick="removeCondition(${conditionIndex})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;"> ‚úï ÂâäÈô§ </button> </div> <div style="margin-bottom: 15px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">Ëâ≤Ë®≠ÂÆö:</label> <select id="colorSetting_${conditionIndex}" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <option value="Á∑ëÁ≥ª">Á∑ëÁ≥ª</option> <option value="ÈªÑÁ∑ëÁ≥ª">ÈªÑÁ∑ëÁ≥ª</option> <option value="ÈªÑËâ≤Á≥ª">ÈªÑËâ≤Á≥ª</option> <option value="ÊñëÁÇπÁ≥ª">ÊñëÁÇπÁ≥ª</option> <option value="Ë§êËâ≤Á≥ª">Ë§êËâ≤Á≥ª</option> </select> </div> <div style="margin-bottom: 15px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">ÊºîÁÆóÂ≠ê:</label> <select id="operator_${conditionIndex}" onchange="toggleRangeInputsForCondition(${conditionIndex})" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;"> <option value=">=">‰ª•‰∏ä (>=)</option> <option value="<=">‰ª•‰∏ã (<=)</option> <option value=">">„Çà„ÇäÂ§ß„Åç„ÅÑ (>)</option> <option value="<">„Çà„ÇäÂ∞è„Åï„ÅÑ (<)</option> <option value="range">ÁØÑÂõ≤ (ÁØÑÂõ≤ÂÜÖ)</option> </select> </div> <div id="thresholdInput_${conditionIndex}" style="margin-bottom: 10px;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">ÈñæÂÄ§(%):</label> <input type="number" id="threshold_${conditionIndex}" value="50" style="padding: 8px; width: 100%; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> </div> <div id="rangeInputs_${conditionIndex}" style="margin-bottom: 10px; display: none;"> <label style="display: block; margin-bottom: 5px; font-weight: 500;">ÁØÑÂõ≤(%):</label> <div style="display: flex; align-items: center; gap: 8px;"> <input type="number" id="rangeMin_${conditionIndex}" value="0" style="padding: 8px; width: 80px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> <span>%„Äú</span> <input type="number" id="rangeMax_${conditionIndex}" value="100" style="padding: 8px; width: 80px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" min="0" max="100"> <span>%</span> </div> </div> </div> `; conditionsContainer.insertAdjacentHTML('beforeend', newConditionHtml); console.log('‚úÖ Êñ∞„Åó„ÅÑÊù°‰ª∂„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü:', conditionIndex + 1); } </script> </body> </html>